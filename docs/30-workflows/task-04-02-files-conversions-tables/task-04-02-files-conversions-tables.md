# CONV-04-02: files/conversions ãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£… - ã‚¿ã‚¹ã‚¯å®Ÿè¡Œä»•æ§˜æ›¸

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å…ƒã®æŒ‡ç¤º

```
@docs/30-workflows/completed-tasks/task-04-02-files-conversions-tables.md ã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¦ã»ã—ã„ã§ã™ã€‚
```

## ãƒ¡ã‚¿æƒ…å ±

| é …ç›®         | å†…å®¹                                   |
| ------------ | -------------------------------------- |
| ã‚¿ã‚¹ã‚¯ID     | CONV-04-02                             |
| Worktreeãƒ‘ã‚¹ | `.worktrees/task-{timestamp}`          |
| ãƒ–ãƒ©ãƒ³ãƒå   | `task-{timestamp}`                     |
| ã‚¿ã‚¹ã‚¯å     | files/conversions ãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…         |
| åˆ†é¡         | å®Ÿè£…                                   |
| å¯¾è±¡æ©Ÿèƒ½     | RAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ |
| å„ªå…ˆåº¦       | é«˜                                     |
| è¦‹ç©ã‚‚ã‚Šè¦æ¨¡ | ä¸­è¦æ¨¡                                 |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹   | æœªå®Ÿæ–½                                 |
| ä½œæˆæ—¥       | 2025-12-25                             |

---

## ã‚¿ã‚¹ã‚¯æ¦‚è¦

### ç›®çš„

Drizzle ORMã‚’ä½¿ç”¨ã—ã¦ã€RAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ãƒ»å¤‰æ›å±¥æ­´ç®¡ç†ã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ`files`ã€`conversions`ã€`extractedMetadata`ï¼‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ã¨å¤‰æ›å‡¦ç†ã®ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚’å¯èƒ½ã«ã™ã‚‹åŸºç›¤ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚

### èƒŒæ™¯

- CONV-04-01ã§Drizzle ORMã®åŸºç›¤ãŒç¢ºç«‹ã•ã‚ŒãŸ
- RAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ»å¤‰æ›æ©Ÿèƒ½ã®æ°¸ç¶šåŒ–ãŒå¿…è¦
- ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹é‡è¤‡æ¤œå‡ºãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹
- å¤‰æ›å±¥æ­´ã®è¿½è·¡ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãŒå¿…è¦

### æœ€çµ‚ã‚´ãƒ¼ãƒ«

- `packages/shared/src/db/schema/`é…ä¸‹ã«ã€`files.ts`ã€`conversions.ts`ã€`extracted-metadata.ts`ã€`relations.ts`ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«å®Ÿè¡Œå¯èƒ½ã§ã‚ã‚‹
- å‹å®šç¾©ãŒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã€ä»–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰åˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹
- å˜ä½“ãƒ†ã‚¹ãƒˆãŒã™ã¹ã¦æˆåŠŸã—ã¦ã„ã‚‹

### æˆæœç‰©ä¸€è¦§

| ç¨®åˆ¥             | æˆæœç‰©                        | é…ç½®å…ˆ                                                   |
| ---------------- | ----------------------------- | -------------------------------------------------------- |
| ç’°å¢ƒ             | Git Worktreeç’°å¢ƒ              | `.worktrees/task-{timestamp}`                            |
| ã‚¹ã‚­ãƒ¼ãƒ         | filesãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©             | `packages/shared/src/db/schema/files.ts`                 |
| ã‚¹ã‚­ãƒ¼ãƒ         | conversionsãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©       | `packages/shared/src/db/schema/conversions.ts`           |
| ã‚¹ã‚­ãƒ¼ãƒ         | extractedMetadataãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾© | `packages/shared/src/db/schema/extracted-metadata.ts`    |
| ã‚¹ã‚­ãƒ¼ãƒ         | ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©              | `packages/shared/src/db/schema/relations.ts`             |
| è¨­å®š             | ã‚¹ã‚­ãƒ¼ãƒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ›´æ–°      | `packages/shared/src/db/schema/index.ts`                 |
| ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | SQLãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«   | `packages/shared/drizzle/migrations/*.sql`               |
| ãƒ†ã‚¹ãƒˆ           | ã‚¹ã‚­ãƒ¼ãƒå˜ä½“ãƒ†ã‚¹ãƒˆ            | `packages/shared/src/db/schema/__tests__/*.test.ts`      |
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ     | ã‚¿ã‚¹ã‚¯å®Œäº†å ±å‘Š                | `docs/30-workflows/task-04-02-files-conversions-tables/` |
| PR               | GitHub Pull Request           | GitHub UI                                                |

---

## å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«

æœ¬ä»•æ§˜æ›¸ã®ã‚³ãƒãƒ³ãƒ‰é¸å®šã¯ä»¥ä¸‹ã‚’å‚ç…§ï¼š

- `docs/00-requirements/master_system_design.md` - ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶
- `.claude/commands/ai/command_list.md` - /ai:ã‚³ãƒãƒ³ãƒ‰å®šç¾©
- `.kamui/prompt/merge-prompt.txt` - Git/PRãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- `docs/30-workflows/completed-tasks/task-04-02-files-conversions-tables.md` - å…ƒã‚¿ã‚¹ã‚¯å®šç¾©

---

## ã‚¿ã‚¹ã‚¯åˆ†è§£ã‚µãƒãƒªãƒ¼

| ID     | ãƒ•ã‚§ãƒ¼ã‚º | ã‚µãƒ–ã‚¿ã‚¹ã‚¯å                  | è²¬å‹™                            | ä¾å­˜   |
| ------ | -------- | ----------------------------- | ------------------------------- | ------ |
| T--1-1 | Phase -1 | Git Worktreeç’°å¢ƒä½œæˆãƒ»åˆæœŸåŒ–  | ç‹¬ç«‹ã—ãŸé–‹ç™ºç’°å¢ƒã®æº–å‚™          | ãªã—   |
| T-00-1 | Phase 0  | è¦ä»¶å®šç¾©ãƒ»ä»•æ§˜ç¢ºèª            | ã‚¿ã‚¹ã‚¯è¦ä»¶ã®æ˜ç¢ºåŒ–              | T--1-1 |
| T-01-1 | Phase 1  | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ      | ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ãƒ»ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆ  | T-00-1 |
| T-02-1 | Phase 2  | è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒˆ            | è¨­è¨ˆå¦¥å½“æ€§ã®æ¤œè¨¼                | T-01-1 |
| T-03-1 | Phase 3  | ã‚¹ã‚­ãƒ¼ãƒå˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ        | ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆé–‹ç™º            | T-02-1 |
| T-04-1 | Phase 4  | filesãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…             | filesã‚¹ã‚­ãƒ¼ãƒå®Ÿè£…               | T-03-1 |
| T-04-2 | Phase 4  | conversionsãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…       | conversionsã‚¹ã‚­ãƒ¼ãƒå®Ÿè£…         | T-04-1 |
| T-04-3 | Phase 4  | extractedMetadataãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£… | extractedMetadataã‚¹ã‚­ãƒ¼ãƒå®Ÿè£…   | T-04-2 |
| T-04-4 | Phase 4  | ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©å®Ÿè£…          | ãƒ†ãƒ¼ãƒ–ãƒ«é–“ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…      | T-04-3 |
| T-04-5 | Phase 4  | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ          | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³SQLãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ | T-04-4 |
| T-05-1 | Phase 5  | ã‚³ãƒ¼ãƒ‰ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°        | ã‚³ãƒ¼ãƒ‰å“è³ªæ”¹å–„                  | T-04-5 |
| T-06-1 | Phase 6  | å“è³ªä¿è¨¼ãƒã‚§ãƒƒã‚¯              | Lint/å‹ãƒã‚§ãƒƒã‚¯/ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ      | T-05-1 |
| T-07-1 | Phase 7  | æœ€çµ‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒˆ            | åŒ…æ‹¬çš„ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼            | T-06-1 |
| T-08-1 | Phase 8  | æ‰‹å‹•ãƒ†ã‚¹ãƒˆæ¤œè¨¼                | æ‰‹å‹•å‹•ä½œç¢ºèª                    | T-07-1 |
| T-09-1 | Phase 9  | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°              | ä»•æ§˜æ›¸ãƒ»READMEæ›´æ–°              | T-08-1 |
| T-10-1 | Phase 10 | PRä½œæˆãƒ»CIç¢ºèª                | ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ              | T-09-1 |

**ç·ã‚µãƒ–ã‚¿ã‚¹ã‚¯æ•°**: 16å€‹

---

## å®Ÿè¡Œãƒ•ãƒ­ãƒ¼å›³

```mermaid
graph TD
    START[ã‚¿ã‚¹ã‚¯é–‹å§‹] --> T--1[Phase -1: ç’°å¢ƒæº–å‚™]
    T--1 --> T-00[Phase 0: è¦ä»¶å®šç¾©]
    T-00 --> T-01[Phase 1: è¨­è¨ˆ]
    T-01 --> T-02[Phase 2: è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒˆ]
    T-02 --> T-03[Phase 3: ãƒ†ã‚¹ãƒˆä½œæˆ]
    T-03 --> T-04[Phase 4: å®Ÿè£…]
    T-04 --> T-05[Phase 5: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°]
    T-05 --> T-06[Phase 6: å“è³ªä¿è¨¼]
    T-06 --> T-07[Phase 7: æœ€çµ‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒˆ]
    T-07 --> T-08[Phase 8: æ‰‹å‹•ãƒ†ã‚¹ãƒˆ]
    T-08 --> T-09[Phase 9: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°]
    T-09 --> T-10[Phase 10: PRä½œæˆãƒ»CIç¢ºèª]
    T-10 --> END[ãƒãƒ¼ã‚¸æº–å‚™å®Œäº†]

    T-02 -->|MAJOR| T-01
    T-02 -->|MAJOR: è¦ä»¶| T-00
    T-07 -->|MAJOR| T-05
    T-07 -->|MAJOR: å®Ÿè£…| T-04
    T-07 -->|MAJOR: ãƒ†ã‚¹ãƒˆ| T-03
    T-07 -->|MAJOR: è¨­è¨ˆ| T-01
    T-07 -->|CRITICAL| T-00
```

---

## Phase -1: ç’°å¢ƒæº–å‚™ï¼ˆGit Worktreeä½œæˆï¼‰

### T--1-1: Git Worktreeç’°å¢ƒä½œæˆãƒ»åˆæœŸåŒ–

#### ç›®çš„

ã‚¿ã‚¹ã‚¯å®Ÿè£…ç”¨ã®ç‹¬ç«‹ã—ãŸGit Worktreeç’°å¢ƒã‚’ä½œæˆã—ã€æœ¬ä½“ãƒ–ãƒ©ãƒ³ãƒã«å½±éŸ¿ã‚’ä¸ãˆãšã«é–‹ç™ºã‚’é€²ã‚ã‚‹ã€‚

#### èƒŒæ™¯

è¤‡æ•°ã‚¿ã‚¹ã‚¯ã®ä¸¦è¡Œé–‹ç™ºã‚„å®Ÿé¨“çš„ãªå¤‰æ›´ã®ãŸã‚ã€å„ã‚¿ã‚¹ã‚¯ã”ã¨ã«ç‹¬ç«‹ã—ãŸWorktreeã§ä½œæ¥­ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚‹ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€æœ¬ä½“ãƒ–ãƒ©ãƒ³ãƒã‚’ä¿è­·ã—ã€ã‚¿ã‚¹ã‚¯é–“ã®å¹²æ¸‰ã‚’é˜²ãã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

Git Worktreeç’°å¢ƒã®ä½œæˆã¨åˆæœŸåŒ–ã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### Claude Code ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰

> âš ï¸ ä»¥ä¸‹ã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚³ãƒãƒ³ãƒ‰ã§ã¯ãªãã€Claude Codeå†…ã§å®Ÿè¡Œã™ã‚‹ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã§ã™

```
# ç¾æ™‚ç‚¹ã§ã¯å°‚ç”¨ã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã¯å­˜åœ¨ã—ã¾ã›ã‚“
# ä»¥ä¸‹ã®Bashã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„
```

- **å‚ç…§**: `.claude/commands/ai/command_list.md`

#### å®Ÿè¡Œæ‰‹é †

**1. ã‚¿ã‚¹ã‚¯è­˜åˆ¥å­ã®ç”Ÿæˆ**

```bash
TASK_ID="task-$(date +%Y%m%d-%H%M%S)"
echo "Generated Task ID: $TASK_ID"
```

**2. Git Worktreeã®ä½œæˆ**

```bash
WORKTREE_PATH=".worktrees/$TASK_ID"
git worktree add "$WORKTREE_PATH" -b "$TASK_ID"
```

**3. Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ç§»å‹•**

```bash
cd "$WORKTREE_PATH"
pwd  # ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºèª
```

**4. ç’°å¢ƒç¢ºèª**

```bash
# ãƒ–ãƒ©ãƒ³ãƒç¢ºèª
git branch --show-current

# GitçŠ¶æ…‹ç¢ºèª
git status

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pnpm install

# ãƒ“ãƒ«ãƒ‰ç¢ºèª
pnpm --filter @repo/shared build
```

#### æˆæœç‰©

| æˆæœç‰©           | ãƒ‘ã‚¹                          | å†…å®¹                             |
| ---------------- | ----------------------------- | -------------------------------- |
| Git Worktreeç’°å¢ƒ | `.worktrees/task-{timestamp}` | ç‹¬ç«‹ã—ãŸä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª         |
| æ–°è¦ãƒ–ãƒ©ãƒ³ãƒ     | `task-{timestamp}`            | ã‚¿ã‚¹ã‚¯å°‚ç”¨ãƒ–ãƒ©ãƒ³ãƒ               |
| åˆæœŸåŒ–æ¸ˆã¿ç’°å¢ƒ   | -                             | ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»ãƒ“ãƒ«ãƒ‰å®Œäº† |

#### å®Œäº†æ¡ä»¶

- [ ] Git WorktreeãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] æ–°è¦ãƒ–ãƒ©ãƒ³ãƒãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ï¼ˆ`git branch --show-current`ã§ç¢ºèªï¼‰
- [ ] Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ç§»å‹•æ¸ˆã¿
- [ ] ä¾å­˜é–¢ä¿‚ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ï¼ˆ`node_modules/`ãŒå­˜åœ¨ï¼‰
- [ ] ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã™ã‚‹ï¼ˆ`pnpm --filter @repo/shared build`ãŒæˆåŠŸï¼‰
- [ ] GitçŠ¶æ…‹ãŒã‚¯ãƒªãƒ¼ãƒ³ã§ã‚ã‚‹ï¼ˆ`git status`ã§æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ãªã—ï¼‰

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: ãªã—ï¼ˆæœ€åˆã®ãƒ•ã‚§ãƒ¼ã‚ºï¼‰
- **å¾Œç¶š**: Phase 0ï¼ˆè¦ä»¶å®šç¾©ï¼‰

#### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

**å•é¡Œ: Worktreeä½œæˆå¤±æ•—**

```bash
# åŸå› ç¢ºèª
git worktree list  # æ—¢å­˜Worktreeç¢ºèª

# å¯¾ç­–: æ—¢å­˜ã®Worktreeã‚’å‰Šé™¤
git worktree remove <worktree-path>
```

**å•é¡Œ: ãƒ“ãƒ«ãƒ‰å¤±æ•—**

```bash
# åŸå› ç¢ºèª
pnpm why <package-name>  # ä¾å­˜é–¢ä¿‚ç¢ºèª

# å¯¾ç­–: ä¾å­˜é–¢ä¿‚å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules pnpm-lock.yaml
pnpm install
```

**å•é¡Œ: æœ¬ä½“ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æˆ»ã‚ŠãŸã„**

```bash
# æœ¬ä½“ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹ã‚’ç¢ºèª
git worktree list

# æœ¬ä½“ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd /Users/dm/dev/dev/å€‹äººé–‹ç™º/AIWorkflowOrchestrator
```

---

## Phase 0: è¦ä»¶å®šç¾©

### T-00-1: è¦ä»¶å®šç¾©ãƒ»ä»•æ§˜ç¢ºèª

#### ç›®çš„

å…ƒã®ã‚¿ã‚¹ã‚¯å®šç¾©ï¼ˆ`docs/30-workflows/completed-tasks/task-04-02-files-conversions-tables.md`ï¼‰ã‚’ç¢ºèªã—ã€å®Ÿè£…ã™ã¹ãä»•æ§˜ã‚’æ˜ç¢ºåŒ–ã™ã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

ã‚¿ã‚¹ã‚¯è¦ä»¶ã®ç¢ºèªã¨æ˜ç¢ºåŒ–ã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### Claude Code ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

> âš ï¸ ä»¥ä¸‹ã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚³ãƒãƒ³ãƒ‰ã§ã¯ãªãã€Claude Codeå†…ã§å®Ÿè¡Œã™ã‚‹ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã§ã™
> âš ï¸ Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª (`.worktrees/task-{timestamp}`) å†…ã§å®Ÿè¡Œã—ã¦ãã ã•ã„

```
/ai:write-spec CONV-04-02
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°**:

- `feature-name`: CONV-04-02

**å®Ÿè¡Œå†…å®¹**:

- å…ƒã®ã‚¿ã‚¹ã‚¯å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€å®Ÿè£…ä»•æ§˜ã‚’è©³ç´°åŒ–
- ã‚¹ã‚³ãƒ¼ãƒ—ã®æ˜ç¢ºåŒ–ï¼ˆå«ã‚€ã‚‚ã®ãƒ»å«ã¾ãªã„ã‚‚ã®ï¼‰
- å—ã‘å…¥ã‚ŒåŸºæº–ã®å®šç¾©
- æŠ€è¡“åˆ¶ç´„ã®ç¢ºèªï¼ˆDrizzle ORM 0.39.xã€SQLiteã€Tursoå¯¾å¿œï¼‰

#### æˆæœç‰©

| æˆæœç‰©     | ãƒ‘ã‚¹                                                                                | å†…å®¹             |
| ---------- | ----------------------------------------------------------------------------------- | ---------------- |
| è©³ç´°ä»•æ§˜æ›¸ | `docs/30-workflows/task-04-02-files-conversions-tables/task-step00-requirements.md` | å®Ÿè£…è¦ä»¶ã®è©³ç´°åŒ– |

#### å®Œäº†æ¡ä»¶

- [ ] å®Ÿè£…ã™ã¹ããƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ãŒæ˜ç¢ºã«ãªã£ã¦ã„ã‚‹
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ãŒæ˜ç¢ºã«ãªã£ã¦ã„ã‚‹
- [ ] å—ã‘å…¥ã‚ŒåŸºæº–ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] æŠ€è¡“åˆ¶ç´„ãŒç¢ºèªã•ã‚Œã¦ã„ã‚‹

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T--1-1ï¼ˆç’°å¢ƒæº–å‚™å®Œäº†ï¼‰
- **å¾Œç¶š**: Phase 1ï¼ˆè¨­è¨ˆï¼‰

---

## Phase 1: è¨­è¨ˆ

### T-01-1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ

#### ç›®çš„

`files`ã€`conversions`ã€`extractedMetadata`ãƒ†ãƒ¼ãƒ–ãƒ«ã®è©³ç´°è¨­è¨ˆã‚’è¡Œã„ã€é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥ãƒ»ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»åˆ¶ç´„ã‚’å®šç¾©ã™ã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### Claude Code ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

> âš ï¸ Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§å®Ÿè¡Œã—ã¦ãã ã•ã„

```
/ai:design-database files conversions extractedMetadata
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°**:

- `table-name`: files conversions extractedMetadata

**å®Ÿè¡Œå†…å®¹**:

- 3ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆfiles, conversions, extractedMetadataï¼‰ã®è©³ç´°è¨­è¨ˆ
- ã‚«ãƒ©ãƒ å®šç¾©ã€ãƒ‡ãƒ¼ã‚¿å‹ã€åˆ¶ç´„ã®æ±ºå®š
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥ã®ç­–å®šï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰
- å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã®è¨­è¨ˆï¼ˆCASCADE DELETEï¼‰
- ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©ï¼ˆ1:Nã€1:1ï¼‰
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®è€ƒæ…®

#### æˆæœç‰©

| æˆæœç‰©           | ãƒ‘ã‚¹                                                                          | å†…å®¹             |
| ---------------- | ----------------------------------------------------------------------------- | ---------------- |
| è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | `docs/30-workflows/task-04-02-files-conversions-tables/task-step01-design.md` | ã‚¹ã‚­ãƒ¼ãƒè©³ç´°è¨­è¨ˆ |
| ERå›³ï¼ˆMermaidï¼‰  | ä¸Šè¨˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…                                                            | ãƒ†ãƒ¼ãƒ–ãƒ«é–¢ä¿‚å›³   |

#### å®Œäº†æ¡ä»¶

- [ ] å„ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ å®šç¾©ãŒå®Œæˆã—ã¦ã„ã‚‹
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥ãŒæ˜ç¢ºã«ãªã£ã¦ã„ã‚‹
- [ ] å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©ãŒæ˜ç¢ºã«ãªã£ã¦ã„ã‚‹
- [ ] ERå›³ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶ãŒæº€ãŸã•ã‚Œã‚‹è¨­è¨ˆã«ãªã£ã¦ã„ã‚‹

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-00-1ï¼ˆè¦ä»¶å®šç¾©å®Œäº†ï¼‰
- **å¾Œç¶š**: Phase 2ï¼ˆè¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰

---

## Phase 2: è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒˆ

### T-02-1: è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒˆ

#### ç›®çš„

å®Ÿè£…é–‹å§‹å‰ã«ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆã®å¦¥å½“æ€§ã‚’æ¤œè¨¼ã—ã€å•é¡Œã‚’æ—©æœŸç™ºè¦‹ã™ã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨å¦¥å½“æ€§æ¤œè¨¼ã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### Claude Code ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

> âš ï¸ Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§å®Ÿè¡Œã—ã¦ãã ã•ã„

```
/ai:review-architecture database-schema
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°**:

- `scope`: database-schema

**å®Ÿè¡Œå†…å®¹**:

- ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼
- æ­£è¦åŒ–ãƒ¬ãƒ™ãƒ«ã®å¦¥å½“æ€§ç¢ºèª
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥ã®è©•ä¾¡
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å½±éŸ¿ã®åˆ†æ
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ï¼ˆSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ç­‰ï¼‰
- ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹æº–æ‹ ç¢ºèª

#### ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹

- **æ­£è¦åŒ–**: é©åˆ‡ãªæ­£è¦åŒ–ãƒ¬ãƒ™ãƒ«ã‹ï¼ˆç¬¬3æ­£è¦å½¢ï¼‰
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: æ¤œç´¢æ€§èƒ½ã«å¿…è¦ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
- **åˆ¶ç´„**: å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã€NOT NULLåˆ¶ç´„ãŒé©åˆ‡ã‹
- **å‘½åè¦å‰‡**: snake_caseã§ä¸€è²«ã—ã¦ã„ã‚‹ã‹
- **å‹é¸æŠ**: é©åˆ‡ãªSQLiteå‹ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹
- **ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: 1:Nã€1:1é–¢ä¿‚ãŒæ­£ã—ãè¨­è¨ˆã•ã‚Œã¦ã„ã‚‹ã‹

#### ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœåˆ¤å®š

- **PASS**: å…¨ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹ã§å•é¡Œãªã— â†’ Phase 3ã¸é€²è¡Œ
- **MINOR**: è»½å¾®ãªæŒ‡æ‘˜ã‚ã‚Š â†’ æŒ‡æ‘˜å¯¾å¿œå¾ŒPhase 3ã¸é€²è¡Œ
- **MAJOR**: é‡å¤§ãªå•é¡Œã‚ã‚Š â†’ Phase 1ï¼ˆè¨­è¨ˆï¼‰ã¸æˆ»ã‚‹

#### æˆæœç‰©

| æˆæœç‰©           | ãƒ‘ã‚¹                                                                                 | å†…å®¹             |
| ---------------- | ------------------------------------------------------------------------------------ | ---------------- |
| ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ | `docs/30-workflows/task-04-02-files-conversions-tables/task-step02-design-review.md` | è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ |

#### å®Œäº†æ¡ä»¶

- [ ] å…¨ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹ã§ãƒã‚§ãƒƒã‚¯å®Œäº†
- [ ] æŒ‡æ‘˜äº‹é …ã¸ã®å¯¾å¿œå®Œäº†ï¼ˆMINORä»¥ä¸‹ï¼‰
- [ ] ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-01-1ï¼ˆè¨­è¨ˆå®Œäº†ï¼‰
- **å¾Œç¶š**: Phase 3ï¼ˆãƒ†ã‚¹ãƒˆä½œæˆï¼‰ã¾ãŸã¯Phase 1ï¼ˆè¨­è¨ˆï¼‰ã¸æˆ»ã‚‹

---

## Phase 3: ãƒ†ã‚¹ãƒˆä½œæˆ (TDD: Red)

### T-03-1: ã‚¹ã‚­ãƒ¼ãƒå˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ

#### ç›®çš„

å®Ÿè£…å‰ã«ã‚¹ã‚­ãƒ¼ãƒã®ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã—ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã‚’æ˜ç¢ºåŒ–ã™ã‚‹ï¼ˆTDD: Redï¼‰ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ä½œæˆã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### Claude Code ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

> âš ï¸ Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§å®Ÿè¡Œã—ã¦ãã ã•ã„

```
/ai:generate-unit-tests packages/shared/src/db/schema
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°**:

- `target-file`: packages/shared/src/db/schema

**å®Ÿè¡Œå†…å®¹**:

- ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã®ãƒ†ã‚¹ãƒˆä½œæˆ
- ã‚¤ãƒ³ã‚µãƒ¼ãƒˆãƒ»ã‚¯ã‚¨ãƒªã®ãƒ†ã‚¹ãƒˆ
- åˆ¶ç´„é•åã®ãƒ†ã‚¹ãƒˆï¼ˆNOT NULLã€å¤–éƒ¨ã‚­ãƒ¼ï¼‰
- ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆ
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã®ãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆå¯¾è±¡

1. **filesãƒ†ãƒ¼ãƒ–ãƒ«**:
   - ãƒ¬ã‚³ãƒ¼ãƒ‰æŒ¿å…¥ã®æˆåŠŸ
   - ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ï¼ˆhashï¼‰ã®ãƒ†ã‚¹ãƒˆ
   - NOT NULLåˆ¶ç´„ã®ãƒ†ã‚¹ãƒˆ
   - è«–ç†å‰Šé™¤ï¼ˆsoftDeleteï¼‰ã®ãƒ†ã‚¹ãƒˆ

2. **conversionsãƒ†ãƒ¼ãƒ–ãƒ«**:
   - ãƒ¬ã‚³ãƒ¼ãƒ‰æŒ¿å…¥ã®æˆåŠŸ
   - å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ï¼ˆfileIdï¼‰ã®ãƒ†ã‚¹ãƒˆ
   - CASCADE DELETEã®ãƒ†ã‚¹ãƒˆ
   - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ENUMã®ãƒ†ã‚¹ãƒˆ

3. **extractedMetadataãƒ†ãƒ¼ãƒ–ãƒ«**:
   - ãƒ¬ã‚³ãƒ¼ãƒ‰æŒ¿å…¥ã®æˆåŠŸ
   - å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ï¼ˆconversionIdï¼‰ã®ãƒ†ã‚¹ãƒˆ
   - 1:1åˆ¶ç´„ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰ã®ãƒ†ã‚¹ãƒˆ
   - JSONå‹ã‚«ãƒ©ãƒ ã®ãƒ†ã‚¹ãƒˆ

4. **ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**:
   - files â†’ conversionsï¼ˆ1:Nï¼‰ã®ãƒ†ã‚¹ãƒˆ
   - conversions â†’ extractedMetadataï¼ˆ1:1ï¼‰ã®ãƒ†ã‚¹ãƒˆ
   - JOIN ã‚¯ã‚¨ãƒªã®ãƒ†ã‚¹ãƒˆ

#### æ¤œè¨¼

```bash
# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦Redï¼ˆå¤±æ•—ï¼‰ã‚’ç¢ºèª
pnpm --filter @repo/shared test:run
```

ãƒ†ã‚¹ãƒˆãŒ**å¤±æ•—ã™ã‚‹**ã“ã¨ã‚’ç¢ºèªï¼ˆã¾ã å®Ÿè£…ã—ã¦ã„ãªã„ãŸã‚ï¼‰ã€‚

#### æˆæœç‰©

| æˆæœç‰©     | ãƒ‘ã‚¹                                                                 | å†…å®¹                            |
| ---------- | -------------------------------------------------------------------- | ------------------------------- |
| å˜ä½“ãƒ†ã‚¹ãƒˆ | `packages/shared/src/db/schema/__tests__/files.test.ts`              | filesã‚¹ã‚­ãƒ¼ãƒãƒ†ã‚¹ãƒˆ             |
| å˜ä½“ãƒ†ã‚¹ãƒˆ | `packages/shared/src/db/schema/__tests__/conversions.test.ts`        | conversionsã‚¹ã‚­ãƒ¼ãƒãƒ†ã‚¹ãƒˆ       |
| å˜ä½“ãƒ†ã‚¹ãƒˆ | `packages/shared/src/db/schema/__tests__/extracted-metadata.test.ts` | extractedMetadataã‚¹ã‚­ãƒ¼ãƒãƒ†ã‚¹ãƒˆ |
| å˜ä½“ãƒ†ã‚¹ãƒˆ | `packages/shared/src/db/schema/__tests__/relations.test.ts`          | ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ              |

#### å®Œäº†æ¡ä»¶

- [ ] å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ†ã‚¹ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã§Redï¼ˆå¤±æ•—ï¼‰ãŒç¢ºèªã§ãã¦ã„ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒååˆ†ã§ã‚ã‚‹ï¼ˆä¸»è¦ãªãƒ‘ã‚¹ã‚’ã‚«ãƒãƒ¼ï¼‰

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-02-1ï¼ˆè¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†ï¼‰
- **å¾Œç¶š**: Phase 4ï¼ˆå®Ÿè£…ï¼‰

---

## Phase 4: å®Ÿè£… (TDD: Green)

### T-04-1: filesãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…

#### ç›®çš„

`files`ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã‚’å®Ÿè£…ã™ã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

filesãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### Claude Code ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

> âš ï¸ Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§å®Ÿè¡Œã—ã¦ãã ã•ã„

```
/ai:create-db-schema files
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°**:

- `table-name`: files

**å®Ÿè£…å†…å®¹**:

- `packages/shared/src/db/schema/files.ts`ã®ä½œæˆ
- ã‚«ãƒ©ãƒ å®šç¾©ï¼ˆid, name, path, mimeType, category, size, hash, encoding, lastModified, metadata, timestamps, softDeleteï¼‰
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å®šç¾©ï¼ˆhashIdx, pathIdx, mimeTypeIdx, categoryIdx, createdAtIdxï¼‰
- å‹å®šç¾©ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆFile, NewFileï¼‰

#### æ¤œè¨¼

```bash
# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦Greenï¼ˆæˆåŠŸï¼‰ã‚’ç¢ºèª
pnpm --filter @repo/shared test:run files.test.ts
```

#### æˆæœç‰©

| æˆæœç‰©       | ãƒ‘ã‚¹                                     | å†…å®¹              |
| ------------ | ---------------------------------------- | ----------------- |
| ã‚¹ã‚­ãƒ¼ãƒå®šç¾© | `packages/shared/src/db/schema/files.ts` | filesãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾© |

#### å®Œäº†æ¡ä»¶

- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] å…¨ã‚«ãƒ©ãƒ ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] å‹å®šç¾©ãŒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-03-1ï¼ˆãƒ†ã‚¹ãƒˆä½œæˆå®Œäº†ï¼‰
- **å¾Œç¶š**: T-04-2ï¼ˆconversionsãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…ï¼‰

---

### T-04-2: conversionsãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…

#### ç›®çš„

`conversions`ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã‚’å®Ÿè£…ã™ã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

conversionsãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### Claude Code ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

> âš ï¸ Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§å®Ÿè¡Œã—ã¦ãã ã•ã„

```
/ai:create-db-schema conversions
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°**:

- `table-name`: conversions

**å®Ÿè£…å†…å®¹**:

- `packages/shared/src/db/schema/conversions.ts`ã®ä½œæˆ
- ã‚«ãƒ©ãƒ å®šç¾©ï¼ˆid, fileId, status, converterId, inputHash, outputHash, duration, inputSize, outputSize, error, errorDetails, timestampsï¼‰
- å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ï¼ˆfileId â†’ files.id, CASCADE DELETEï¼‰
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å®šç¾©ï¼ˆfileIdIdx, statusIdx, inputHashIdx, createdAtIdx, fileStatusIdxï¼‰
- å‹å®šç¾©ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆConversion, NewConversionï¼‰

#### æ¤œè¨¼

```bash
# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦Greenï¼ˆæˆåŠŸï¼‰ã‚’ç¢ºèª
pnpm --filter @repo/shared test:run conversions.test.ts
```

#### æˆæœç‰©

| æˆæœç‰©       | ãƒ‘ã‚¹                                           | å†…å®¹                    |
| ------------ | ---------------------------------------------- | ----------------------- |
| ã‚¹ã‚­ãƒ¼ãƒå®šç¾© | `packages/shared/src/db/schema/conversions.ts` | conversionsãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾© |

#### å®Œäº†æ¡ä»¶

- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] å…¨ã‚«ãƒ©ãƒ ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] å‹å®šç¾©ãŒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-04-1ï¼ˆfilesãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…å®Œäº†ï¼‰
- **å¾Œç¶š**: T-04-3ï¼ˆextractedMetadataãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…ï¼‰

---

### T-04-3: extractedMetadataãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…

#### ç›®çš„

`extractedMetadata`ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã‚’å®Ÿè£…ã™ã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

extractedMetadataãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### Claude Code ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

> âš ï¸ Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§å®Ÿè¡Œã—ã¦ãã ã•ã„

```
/ai:create-db-schema extractedMetadata
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°**:

- `table-name`: extractedMetadata

**å®Ÿè£…å†…å®¹**:

- `packages/shared/src/db/schema/extracted-metadata.ts`ã®ä½œæˆ
- ã‚«ãƒ©ãƒ å®šç¾©ï¼ˆid, conversionId, title, author, language, wordCount, lineCount, charCount, codeBlocks, headers, links, custom, timestampsï¼‰
- å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ï¼ˆconversionId â†’ conversions.id, CASCADE DELETEï¼‰
- ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆconversionIdIdxï¼‰
- å‹å®šç¾©ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆExtractedMetadata, NewExtractedMetadataï¼‰

#### æ¤œè¨¼

```bash
# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦Greenï¼ˆæˆåŠŸï¼‰ã‚’ç¢ºèª
pnpm --filter @repo/shared test:run extracted-metadata.test.ts
```

#### æˆæœç‰©

| æˆæœç‰©       | ãƒ‘ã‚¹                                                  | å†…å®¹                          |
| ------------ | ----------------------------------------------------- | ----------------------------- |
| ã‚¹ã‚­ãƒ¼ãƒå®šç¾© | `packages/shared/src/db/schema/extracted-metadata.ts` | extractedMetadataãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾© |

#### å®Œäº†æ¡ä»¶

- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] å…¨ã‚«ãƒ©ãƒ ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] å‹å®šç¾©ãŒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-04-2ï¼ˆconversionsãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…å®Œäº†ï¼‰
- **å¾Œç¶š**: T-04-4ï¼ˆãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©å®Ÿè£…ï¼‰

---

### T-04-4: ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©å®Ÿè£…

#### ç›®çš„

ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Drizzle ORMã§å®šç¾©ã™ã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©ã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### å®Ÿè£…å†…å®¹

- `packages/shared/src/db/schema/relations.ts`ã®ä½œæˆ
- filesRelationså®šç¾©ï¼ˆfiles â†’ conversions 1:Nï¼‰
- conversionsRelationså®šç¾©ï¼ˆconversions â†’ file 1:1ã€conversions â†’ extractedMetadata 1:1ï¼‰
- extractedMetadataRelationså®šç¾©ï¼ˆextractedMetadata â†’ conversion 1:1ï¼‰

#### æ¤œè¨¼

```bash
# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦Greenï¼ˆæˆåŠŸï¼‰ã‚’ç¢ºèª
pnpm --filter @repo/shared test:run relations.test.ts
```

#### æˆæœç‰©

| æˆæœç‰©           | ãƒ‘ã‚¹                                         | å†…å®¹                   |
| ---------------- | -------------------------------------------- | ---------------------- |
| ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© | `packages/shared/src/db/schema/relations.ts` | ãƒ†ãƒ¼ãƒ–ãƒ«é–“ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ |

#### å®Œäº†æ¡ä»¶

- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] å…¨ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-04-3ï¼ˆextractedMetadataãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…å®Œäº†ï¼‰
- **å¾Œç¶š**: T-04-5ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆï¼‰

---

### T-04-5: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ

#### ç›®çš„

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã€å®Ÿéš›ã®DBä½œæˆã‚’å¯èƒ½ã«ã™ã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### Claude Code ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

> âš ï¸ Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§å®Ÿè¡Œã—ã¦ãã ã•ã„

```
/ai:create-migration create_files_conversions_tables
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°**:

- `migration-name`: create_files_conversions_tables

**å®Ÿè¡Œå†…å®¹**:

- Drizzle ORMã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
- ç”Ÿæˆã•ã‚ŒãŸSQLãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œãƒ†ã‚¹ãƒˆ

#### æ¤œè¨¼

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ
pnpm --filter @repo/shared db:generate

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒï¼‰
pnpm --filter @repo/shared db:migrate

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª
pnpm --filter @repo/shared db:studio
```

#### æˆæœç‰©

| æˆæœç‰©                   | ãƒ‘ã‚¹                                       | å†…å®¹                |
| ------------------------ | ------------------------------------------ | ------------------- |
| ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ« | `packages/shared/drizzle/migrations/*.sql` | SQLãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ |
| ã‚¹ã‚­ãƒ¼ãƒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ›´æ–° | `packages/shared/src/db/schema/index.ts`   | ãƒãƒ¬ãƒ«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ  |

#### å®Œäº†æ¡ä»¶

- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡ŒãŒæˆåŠŸã™ã‚‹
- [ ] `schema/index.ts`ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹
- [ ] Drizzle Studioã§ãƒ†ãƒ¼ãƒ–ãƒ«ãŒç¢ºèªã§ãã‚‹

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-04-4ï¼ˆãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©å®Œäº†ï¼‰
- **å¾Œç¶š**: Phase 5ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼‰

---

## Phase 5: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° (TDD: Refactor)

### T-05-1: ã‚³ãƒ¼ãƒ‰ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

#### ç›®çš„

å‹•ä½œã‚’å¤‰ãˆãšã«ã‚³ãƒ¼ãƒ‰å“è³ªã‚’æ”¹å–„ã™ã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

ã‚³ãƒ¼ãƒ‰å“è³ªæ”¹å–„ã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### Claude Code ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

> âš ï¸ Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§å®Ÿè¡Œã—ã¦ãã ã•ã„

```
/ai:refactor packages/shared/src/db/schema
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°**:

- `target-file`: packages/shared/src/db/schema

**å®Ÿè¡Œå†…å®¹**:

- ã‚³ãƒ¡ãƒ³ãƒˆã®è¿½åŠ ãƒ»æ”¹å–„
- å‘½åè¦å‰‡ã®çµ±ä¸€
- é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤
- å‹å®šç¾©ã®æ”¹å–„
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚³ãƒ¡ãƒ³ãƒˆï¼ˆJSDocï¼‰ã®è¿½åŠ 

#### æ¤œè¨¼

```bash
# ãƒ†ã‚¹ãƒˆã‚’å†å®Ÿè¡Œã—ã¦ç¶™ç¶šæˆåŠŸã‚’ç¢ºèª
pnpm --filter @repo/shared test:run
```

#### æˆæœç‰©

| æˆæœç‰©                     | ãƒ‘ã‚¹                                 | å†…å®¹               |
| -------------------------- | ------------------------------------ | ------------------ |
| ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ¸ˆã¿ã‚³ãƒ¼ãƒ‰ | `packages/shared/src/db/schema/*.ts` | å“è³ªæ”¹å–„æ¸ˆã¿ã‚³ãƒ¼ãƒ‰ |

#### å®Œäº†æ¡ä»¶

- [ ] ã‚³ãƒ¼ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆãŒé©åˆ‡ã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹
- [ ] JSDocã‚³ãƒ¡ãƒ³ãƒˆãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹
- [ ] å‘½åè¦å‰‡ãŒçµ±ä¸€ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆãŒç¶™ç¶šã—ã¦æˆåŠŸã™ã‚‹

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-04-5ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆå®Œäº†ï¼‰
- **å¾Œç¶š**: Phase 6ï¼ˆå“è³ªä¿è¨¼ï¼‰

---

## Phase 6: å“è³ªä¿è¨¼

### T-06-1: å“è³ªä¿è¨¼ãƒã‚§ãƒƒã‚¯

#### ç›®çš„

å®šç¾©ã•ã‚ŒãŸå“è³ªåŸºæº–ã‚’ã™ã¹ã¦æº€ãŸã™ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

å“è³ªåŸºæº–ã®æ¤œè¨¼ã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### å®Ÿè¡Œå†…å®¹

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’é †æ¬¡å®Ÿè¡Œï¼š

**1. Lint ãƒã‚§ãƒƒã‚¯**

```bash
pnpm --filter @repo/shared lint
```

**2. å‹ãƒã‚§ãƒƒã‚¯**

```bash
pnpm --filter @repo/shared typecheck
```

**3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**

```bash
pnpm --filter @repo/shared test:run
```

**4. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**

```bash
pnpm --filter @repo/shared test:coverage
```

#### å“è³ªã‚²ãƒ¼ãƒˆ

- [ ] **Lint**: ã‚¨ãƒ©ãƒ¼ãƒ»è­¦å‘ŠãŒã‚¼ãƒ­
- [ ] **å‹ãƒã‚§ãƒƒã‚¯**: å‹ã‚¨ãƒ©ãƒ¼ãŒã‚¼ãƒ­
- [ ] **ãƒ†ã‚¹ãƒˆ**: å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸ
- [ ] **ã‚«ãƒãƒ¬ãƒƒã‚¸**: 80%ä»¥ä¸Šï¼ˆç†æƒ³ã¯90%ä»¥ä¸Šï¼‰

#### æˆæœç‰©

| æˆæœç‰©       | ãƒ‘ã‚¹                                                                                  | å†…å®¹             |
| ------------ | ------------------------------------------------------------------------------------- | ---------------- |
| å“è³ªãƒ¬ãƒãƒ¼ãƒˆ | `docs/30-workflows/task-04-02-files-conversions-tables/task-step06-quality-report.md` | å“è³ªãƒã‚§ãƒƒã‚¯çµæœ |

#### å®Œäº†æ¡ä»¶

- [ ] å…¨å“è³ªã‚²ãƒ¼ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¦ã„ã‚‹
- [ ] å“è³ªãƒ¬ãƒãƒ¼ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-05-1ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®Œäº†ï¼‰
- **å¾Œç¶š**: Phase 7ï¼ˆæœ€çµ‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰

---

## Phase 7: æœ€çµ‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒˆ

### T-07-1: æœ€çµ‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒˆ

#### ç›®çš„

å®Ÿè£…å®Œäº†å¾Œã€å…¨ä½“çš„ãªå“è³ªãƒ»æ•´åˆæ€§ã‚’æ¤œè¨¼ã™ã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

åŒ…æ‹¬çš„ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### Claude Code ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

> âš ï¸ Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§å®Ÿè¡Œã—ã¦ãã ã•ã„

```
/ai:code-review-complete packages/shared/src/db/schema
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°**:

- `target-path`: packages/shared/src/db/schema

**å®Ÿè¡Œå†…å®¹**:

- ã‚³ãƒ¼ãƒ‰å“è³ªãƒ¬ãƒ“ãƒ¥ãƒ¼
- ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
- ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹æº–æ‹ ç¢ºèª
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå…¨æ€§ç¢ºèª

#### ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœåˆ¤å®š

- **PASS**: å…¨ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹ã§å•é¡Œãªã— â†’ Phase 8ã¸é€²è¡Œ
- **MINOR**: è»½å¾®ãªæŒ‡æ‘˜ã‚ã‚Š â†’ Phase 5å†…ã§ä¿®æ­£å¾ŒPhase 8ã¸é€²è¡Œ
- **MAJOR**: é‡å¤§ãªå•é¡Œã‚ã‚Š â†’ å½±éŸ¿ç¯„å›²ã«å¿œã˜ãŸé©åˆ‡ãªãƒ•ã‚§ãƒ¼ã‚ºã¸æˆ»ã‚‹

#### æˆæœç‰©

| æˆæœç‰©               | ãƒ‘ã‚¹                                                                                | å†…å®¹             |
| -------------------- | ----------------------------------------------------------------------------------- | ---------------- |
| æœ€çµ‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ | `docs/30-workflows/task-04-02-files-conversions-tables/task-step07-final-review.md` | æœ€çµ‚ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ |

#### å®Œäº†æ¡ä»¶

- [ ] å…¨ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹ã§ãƒã‚§ãƒƒã‚¯å®Œäº†
- [ ] æŒ‡æ‘˜äº‹é …ã¸ã®å¯¾å¿œå®Œäº†ï¼ˆMINORä»¥ä¸‹ï¼‰
- [ ] ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-06-1ï¼ˆå“è³ªä¿è¨¼å®Œäº†ï¼‰
- **å¾Œç¶š**: Phase 8ï¼ˆæ‰‹å‹•ãƒ†ã‚¹ãƒˆï¼‰ã¾ãŸã¯é©åˆ‡ãªãƒ•ã‚§ãƒ¼ã‚ºã¸æˆ»ã‚‹

---

## Phase 8: æ‰‹å‹•ãƒ†ã‚¹ãƒˆæ¤œè¨¼

### T-08-1: æ‰‹å‹•ãƒ†ã‚¹ãƒˆæ¤œè¨¼

#### ç›®çš„

è‡ªå‹•ãƒ†ã‚¹ãƒˆã§ã¯æ¤œè¨¼ã§ããªã„å®Ÿç’°å¢ƒå‹•ä½œã‚’æ‰‹å‹•ã§ç¢ºèªã™ã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

æ‰‹å‹•ãƒ†ã‚¹ãƒˆå®Ÿæ–½ã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### æ‰‹å‹•ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

| No  | ã‚«ãƒ†ã‚´ãƒª       | ãƒ†ã‚¹ãƒˆé …ç›®                    | å‰ææ¡ä»¶                                  | æ“ä½œæ‰‹é †                            | æœŸå¾…çµæœ                                       | å®Ÿè¡Œçµæœ | å‚™è€ƒ |
| --- | -------------- | ----------------------------- | ----------------------------------------- | ----------------------------------- | ---------------------------------------------- | -------- | ---- |
| 1   | æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ     | filesãƒ†ãƒ¼ãƒ–ãƒ«æŒ¿å…¥             | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ¸ˆã¿                  | Drizzle Studioã§filesã«ãƒ¬ã‚³ãƒ¼ãƒ‰æŒ¿å…¥ | æ­£å¸¸ã«æŒ¿å…¥ã•ã‚Œã‚‹                               |          |      |
| 2   | æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ     | conversionsãƒ†ãƒ¼ãƒ–ãƒ«æŒ¿å…¥       | filesã«ãƒ¬ã‚³ãƒ¼ãƒ‰å­˜åœ¨                       | conversionsã«ãƒ¬ã‚³ãƒ¼ãƒ‰æŒ¿å…¥           | æ­£å¸¸ã«æŒ¿å…¥ã•ã‚Œã‚‹                               |          |      |
| 3   | æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ     | extractedMetadataãƒ†ãƒ¼ãƒ–ãƒ«æŒ¿å…¥ | conversionsã«ãƒ¬ã‚³ãƒ¼ãƒ‰å­˜åœ¨                 | extractedMetadataã«ãƒ¬ã‚³ãƒ¼ãƒ‰æŒ¿å…¥     | æ­£å¸¸ã«æŒ¿å…¥ã•ã‚Œã‚‹                               |          |      |
| 4   | åˆ¶ç´„ãƒ†ã‚¹ãƒˆ     | ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„                  | -                                         | åŒä¸€hashã®filesãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æŒ¿å…¥       | ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹                                   |          |      |
| 5   | åˆ¶ç´„ãƒ†ã‚¹ãƒˆ     | å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„                  | -                                         | å­˜åœ¨ã—ãªã„fileIdã§conversionsã«æŒ¿å…¥ | ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹                                   |          |      |
| 6   | CASCADE DELETE | filesãƒ¬ã‚³ãƒ¼ãƒ‰å‰Šé™¤             | filesâ†’conversionsâ†’extractedMetadataãŒå­˜åœ¨ | filesãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤                 | é–¢é€£conversions, extractedMetadataã‚‚å‰Šé™¤ã•ã‚Œã‚‹ |          |      |
| 7   | ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³   | JOIN ã‚¯ã‚¨ãƒª                   | é–¢é€£ãƒ¬ã‚³ãƒ¼ãƒ‰å­˜åœ¨                          | files + conversions ã‚’JOIN          | æ­£ã—ãJOINã•ã‚Œã‚‹                               |          |      |
| 8   | è«–ç†å‰Šé™¤       | softDelete                    | filesã«ãƒ¬ã‚³ãƒ¼ãƒ‰å­˜åœ¨                       | deleted_atã‚’è¨­å®š                    | ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒè«–ç†å‰Šé™¤ã•ã‚Œã‚‹                       |          |      |

#### æ¤œè¨¼æ‰‹é †

```bash
# Drizzle Studioã‚’èµ·å‹•
pnpm --filter @repo/shared db:studio

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ†ãƒ¼ãƒ–ãƒ«æ“ä½œã‚’å®Ÿæ–½
# https://local.drizzle.studio ã«ã‚¢ã‚¯ã‚»ã‚¹
```

#### æˆæœç‰©

| æˆæœç‰©         | ãƒ‘ã‚¹                                                                                       | å†…å®¹               |
| -------------- | ------------------------------------------------------------------------------------------ | ------------------ |
| æ‰‹å‹•ãƒ†ã‚¹ãƒˆçµæœ | `docs/30-workflows/task-04-02-files-conversions-tables/task-step08-manual-test-results.md` | æ‰‹å‹•ãƒ†ã‚¹ãƒˆçµæœå ±å‘Š |

#### å®Œäº†æ¡ä»¶

- [ ] å…¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒå®Ÿæ–½ã•ã‚Œã¦ã„ã‚‹
- [ ] å…¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒæˆåŠŸã—ã¦ã„ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆçµæœãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-07-1ï¼ˆæœ€çµ‚ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†ï¼‰
- **å¾Œç¶š**: Phase 9ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ï¼‰

---

## Phase 9: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

### T-09-1: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

#### ç›®çš„

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æœ€æ–°ã®å®Ÿè£…å†…å®¹ã«æ›´æ–°ã™ã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### Claude Code ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

> âš ï¸ Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§å®Ÿè¡Œã—ã¦ãã ã•ã„

```
/ai:update-all-docs
```

**å®Ÿè¡Œå†…å®¹**:

- `docs/00-requirements/`ã®ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
- skillsã‚’æ›´æ–°
- `packages/shared/README.md`ã®æ›´æ–°ï¼ˆã‚¹ã‚­ãƒ¼ãƒèª¬æ˜ï¼‰
- ã‚¿ã‚¹ã‚¯å®Œäº†å ±å‘Šæ›¸ã®ä½œæˆ
- å¤‰æ›´å±¥æ­´ã®è¨˜éŒ²

#### æˆæœç‰©

| æˆæœç‰©             | ãƒ‘ã‚¹                                                                              | å†…å®¹                               |
| ------------------ | --------------------------------------------------------------------------------- | ---------------------------------- |
| ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸æ›´æ–° | `docs/00-requirements/master_system_design.md`                                    | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã‚»ã‚¯ã‚·ãƒ§ãƒ³æ›´æ–° |
| READMEæ›´æ–°         | `packages/shared/README.md`                                                       | ã‚¹ã‚­ãƒ¼ãƒä½¿ç”¨æ–¹æ³•è¿½åŠ                |
| ã‚¿ã‚¹ã‚¯å®Œäº†å ±å‘Š     | `docs/30-workflows/task-04-02-files-conversions-tables/task-completion-report.md` | ã‚¿ã‚¹ã‚¯å®Œäº†ã‚µãƒãƒªãƒ¼                 |

#### å®Œäº†æ¡ä»¶

- [ ] å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¿ã‚¹ã‚¯å®Œäº†å ±å‘ŠãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] å¤‰æ›´å†…å®¹ãŒæ­£ç¢ºã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-08-1ï¼ˆæ‰‹å‹•ãƒ†ã‚¹ãƒˆå®Œäº†ï¼‰
- **å¾Œç¶š**: Phase 10ï¼ˆPRä½œæˆï¼‰

---

## Phase 10: PRä½œæˆãƒ»CIç¢ºèª

### T-10-1: PRä½œæˆãƒ»CIç¢ºèª

#### ç›®çš„

GitHub Pull Requestã‚’ä½œæˆã—ã€CIé€šéã‚’ç¢ºèªã—ã¦ãƒãƒ¼ã‚¸æº–å‚™ã‚’æ•´ãˆã‚‹ã€‚

#### è²¬å‹™ï¼ˆå˜ä¸€è²¬å‹™ï¼‰

PRä½œæˆã¨CIç¢ºèªã®ã¿ã‚’æ‹…å½“ã™ã‚‹ã€‚

#### Claude Code ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

> âš ï¸ Worktreeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§å®Ÿè¡Œã—ã¦ãã ã•ã„

```
/ai:create-pr main
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°**:

- `base-branch`: main

**å®Ÿè¡Œå†…å®¹**:

1. **å¤‰æ›´ã®ã‚³ãƒŸãƒƒãƒˆ**

```bash
git add .
git commit -m "$(cat <<'EOF'
feat(db): files/conversions ãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…

- filesãƒ†ãƒ¼ãƒ–ãƒ«: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†
- conversionsãƒ†ãƒ¼ãƒ–ãƒ«: å¤‰æ›å±¥æ­´è¿½è·¡
- extractedMetadataãƒ†ãƒ¼ãƒ–ãƒ«: æŠ½å‡ºãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
- ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©: 1:N, 1:1é–¢ä¿‚
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
- å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè£…

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Sonnet 4.5 (1M context) <noreply@anthropic.com>
EOF
)"
```

2. **ãƒ–ãƒ©ãƒ³ãƒã®ãƒ—ãƒƒã‚·ãƒ¥**

```bash
git push -u origin task-{timestamp}
```

3. **PRä½œæˆ**

```bash
gh pr create --title "feat(db): files/conversions ãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…" --body "$(cat <<'EOF'
## æ¦‚è¦
RAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ãƒ»å¤‰æ›å±¥æ­´ç®¡ç†ã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

## å¤‰æ›´å†…å®¹
- âœ… filesãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…
- âœ… conversionsãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…
- âœ… extractedMetadataãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…
- âœ… ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©å®Ÿè£…
- âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
- âœ… å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸90%ä»¥ä¸Šï¼‰

## ãƒ†ã‚¹ãƒˆ
- [x] å˜ä½“ãƒ†ã‚¹ãƒˆ: ã™ã¹ã¦æˆåŠŸ
- [x] å‹ãƒã‚§ãƒƒã‚¯: ã‚¨ãƒ©ãƒ¼ãªã—
- [x] Lint: ã‚¨ãƒ©ãƒ¼ãªã—
- [x] æ‰‹å‹•ãƒ†ã‚¹ãƒˆ: ã™ã¹ã¦æˆåŠŸ

## é–¢é€£Issue
- ã‚¿ã‚¹ã‚¯ID: CONV-04-02

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
EOF
)"
```

4. **CIç¢ºèª**

```bash
# CIçŠ¶æ…‹ç¢ºèª
gh pr checks

# CIå®Œäº†ã¾ã§å¾…æ©Ÿï¼ˆ5åˆ†é–“éš”ã§ãƒã‚§ãƒƒã‚¯ï¼‰
while true; do
  STATUS=$(gh pr checks --json state --jq '.[].state' | sort -u)
  if [[ "$STATUS" == "SUCCESS" ]]; then
    echo "âœ… CIæˆåŠŸ: ãƒãƒ¼ã‚¸æº–å‚™å®Œäº†"
    break
  elif [[ "$STATUS" =~ "FAILURE" ]]; then
    echo "âŒ CIå¤±æ•—: ä¿®æ­£ãŒå¿…è¦"
    break
  else
    echo "â³ CIå®Ÿè¡Œä¸­..."
    sleep 300
  fi
done
```

#### æˆæœç‰©

| æˆæœç‰©       | ãƒ‘ã‚¹           | å†…å®¹       |
| ------------ | -------------- | ---------- |
| Pull Request | GitHub UI      | PRãƒšãƒ¼ã‚¸   |
| CIçµæœ       | GitHub Actions | CIå®Ÿè¡Œçµæœ |

#### å®Œäº†æ¡ä»¶

- [ ] ã‚³ãƒŸãƒƒãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ–ãƒ©ãƒ³ãƒãŒãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¦ã„ã‚‹
- [ ] PRãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] CIãŒã™ã¹ã¦æˆåŠŸã—ã¦ã„ã‚‹ï¼ˆâœ… ãƒãƒ¼ã‚¯ï¼‰
- [ ] ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆãŒå­˜åœ¨ã—ãªã„

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®é€šçŸ¥

```
ğŸ‰ ã‚¿ã‚¹ã‚¯ CONV-04-02 å®Œäº†ã—ã¾ã—ãŸï¼

âœ… PRä½œæˆå®Œäº†: {PR_URL}
âœ… CIãƒã‚§ãƒƒã‚¯: ã™ã¹ã¦æˆåŠŸ
âœ… ãƒãƒ¼ã‚¸æº–å‚™å®Œäº†

ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾Œã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒãƒ¼ã‚¸ã§ãã¾ã™:
gh pr merge {PR_NUMBER} --squash --delete-branch
```

#### ä¾å­˜é–¢ä¿‚

- **å‰æ**: T-09-1ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°å®Œäº†ï¼‰
- **å¾Œç¶š**: ãªã—ï¼ˆã‚¿ã‚¹ã‚¯å®Œäº†ï¼‰

---

## å®Œäº†æ¡ä»¶ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### æ©Ÿèƒ½è¦ä»¶

- [ ] filesãƒ†ãƒ¼ãƒ–ãƒ«ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] conversionsãƒ†ãƒ¼ãƒ–ãƒ«ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] extractedMetadataãƒ†ãƒ¼ãƒ–ãƒ«ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«å®Ÿè¡Œã§ãã‚‹
- [ ] é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ï¼ˆCASCADE DELETEï¼‰ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹

### å“è³ªè¦ä»¶

- [ ] Lintã‚¨ãƒ©ãƒ¼ãŒã‚¼ãƒ­
- [ ] å‹ã‚¨ãƒ©ãƒ¼ãŒã‚¼ãƒ­
- [ ] å…¨ãƒ†ã‚¹ãƒˆãŒæˆåŠŸ
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Š
- [ ] æ‰‹å‹•ãƒ†ã‚¹ãƒˆãŒã™ã¹ã¦æˆåŠŸ
- [ ] CIãŒã™ã¹ã¦æˆåŠŸ

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¦ä»¶

- [ ] ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸ãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹
- [ ] README.mdãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¿ã‚¹ã‚¯å®Œäº†å ±å‘ŠãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] å„ãƒ•ã‚§ãƒ¼ã‚ºã®æˆæœç‰©ãŒæƒã£ã¦ã„ã‚‹

---

## æ¤œè¨¼æ–¹æ³•

### è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm --filter @repo/shared test:run

# ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
pnpm --filter @repo/shared test:coverage

# Lint
pnpm --filter @repo/shared lint

# å‹ãƒã‚§ãƒƒã‚¯
pnpm --filter @repo/shared typecheck
```

### æ‰‹å‹•ç¢ºèª

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
pnpm --filter @repo/shared db:migrate

# Drizzle Studioèµ·å‹•
pnpm --filter @repo/shared db:studio
```

---

## ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

| ãƒªã‚¹ã‚¯               | å½±éŸ¿åº¦ | ç™ºç”Ÿç¢ºç‡ | å¯¾ç­–                                           |
| -------------------- | ------ | -------- | ---------------------------------------------- |
| ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•— | é«˜     | ä½       | äº‹å‰ã«ãƒ†ã‚¹ãƒˆç’°å¢ƒã§å®Ÿè¡Œã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã‚’æº–å‚™ |
| å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„é•å     | ä¸­     | ä¸­       | å˜ä½“ãƒ†ã‚¹ãƒˆã§åˆ¶ç´„ã‚’ç¶²ç¾…çš„ã«ãƒ†ã‚¹ãƒˆ               |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–   | ä¸­     | ä½       | ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥ã‚’æ…é‡ã«è¨­è¨ˆã€EXPLAINã§ç¢ºèª    |
| å‹å®šç¾©ã®ä¸æ•´åˆ       | ä½     | ä½       | å‹ãƒã‚§ãƒƒã‚¯ã‚’å³æ ¼ã«å®Ÿæ–½                         |
| ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ä¸è¶³ | ä¸­     | ä¸­       | Phase 3ã§ç¶²ç¾…çš„ãªãƒ†ã‚¹ãƒˆã‚’ä½œæˆ                  |

---

## å‚ç…§æƒ…å ±

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/00-requirements/master_system_design.md` - ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸
- `docs/30-workflows/completed-tasks/task-04-02-files-conversions-tables.md` - å…ƒã‚¿ã‚¹ã‚¯å®šç¾©
- `packages/shared/src/db/schema/common.ts` - å…±é€šã‚«ãƒ©ãƒ å®šç¾©ï¼ˆCONV-04-01ï¼‰

### å‚è€ƒè³‡æ–™

- [Drizzle ORM Documentation](https://orm.drizzle.team/)
- [SQLite Documentation](https://www.sqlite.org/docs.html)
- [Turso Documentation](https://docs.turso.tech/)

---

## å‚™è€ƒ

### æŠ€è¡“çš„ãªè£œè¶³

- **hashã‚«ãƒ©ãƒ **: SHA-256ãƒãƒƒã‚·ãƒ¥ï¼ˆ64æ–‡å­—ï¼‰ã§é‡è¤‡ãƒ•ã‚¡ã‚¤ãƒ«æ¤œå‡ºã«ä½¿ç”¨
- **conversionsãƒ†ãƒ¼ãƒ–ãƒ«**: å¤‰æ›ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦æ©Ÿèƒ½ï¼ˆinputHashãŒä¸€è‡´ã™ã‚Œã°å†åˆ©ç”¨ï¼‰
- **extractedMetadata**: 1:1é–¢ä¿‚ã§conversionsã«ç´ã¥ãï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰
- **è«–ç†å‰Šé™¤**: filesãƒ†ãƒ¼ãƒ–ãƒ«ã®ã¿ã«é©ç”¨ï¼ˆdeleted_atã‚«ãƒ©ãƒ ï¼‰

### å¾Œç¶šã‚¿ã‚¹ã‚¯

- CONV-04-03: content_chunks ãƒ†ãƒ¼ãƒ–ãƒ« + FTS5å®Ÿè£…
- CONV-04-04: DiskANN ãƒ™ã‚¯ãƒˆãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å®Ÿè£…
- CONV-04-05: ãƒŠãƒ¬ãƒƒã‚¸ã‚°ãƒ©ãƒ•ãƒ†ãƒ¼ãƒ–ãƒ«å®Ÿè£…
- CONV-04-06: Repository ãƒ‘ã‚¿ãƒ¼ãƒ³å®Ÿè£…
