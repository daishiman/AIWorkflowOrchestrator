# チャット履歴永続化機能 - タスク指示書

## メタ情報

| 項目             | 内容                   |
| ---------------- | ---------------------- |
| タスクID         | TASK-CHAT-HISTORY-001  |
| タスク名         | チャット履歴永続化機能 |
| 分類             | 新規機能               |
| 対象機能         | チャット               |
| 優先度           | 高                     |
| 見積もり規模     | 中規模                 |
| ステータス       | 未実施                 |
| 発見元           | ユーザー要望           |
| 発見日           | 2025-12-11             |
| 発見エージェント | .claude/agents/product-manager.md       |

---

## 1. なぜこのタスクが必要か（Why）

### 1.1 背景

チャットでのやり取りは重要な知識や成果物を含むことが多い。履歴を永続化することで、過去の会話を参照したり、ワークスペースと連携して成果物を管理できるようになる。

### 1.2 問題点・課題

- チャット履歴が保存されない
- 過去の会話を参照できない
- 有用なやり取りが失われる
- セッション間で情報が引き継がれない

### 1.3 放置した場合の影響

- 知識の蓄積ができない
- 同じ質問を繰り返す必要がある
- 作業の連続性が損なわれる

---

## 2. 何を達成するか（What）

### 2.1 目的

チャット履歴をローカルに保存し、過去の会話を検索・参照できるようにする。

### 2.2 最終ゴール

- チャット履歴の自動保存
- 履歴一覧・検索機能
- 過去の会話の再開・継続
- 履歴のエクスポート（Markdown/JSON）
- ワークスペースへの履歴連携

### 2.3 スコープ

#### 含むもの

**保存機能**

- チャットセッションの自動保存
- メタデータ（日時、使用LLM、タイトル）の保存
- システムプロンプトの保存
- 添付ファイル情報の保存

**履歴管理**

- 履歴一覧表示（サイドバー）
- 日付/キーワード検索
- タイトル編集
- 履歴の削除
- お気に入り/ピン留め

**エクスポート**

- Markdown形式でのエクスポート
- JSON形式でのエクスポート
- 選択範囲のエクスポート

#### 含まないもの

- クラウド同期
- 複数デバイス間の履歴共有
- 履歴の暗号化（将来対応）

### 2.4 成果物

- 履歴保存ロジック
- 履歴一覧UI
- 検索機能
- エクスポート機能
- 関連するユニットテスト

---

## 3. 主要な使用エージェント

- **.claude/agents/db-architect.md**: 履歴データスキーマ設計
- **.claude/agents/ui-designer.md**: 履歴一覧UIの設計
- **.claude/agents/logic-dev.md**: 保存・検索ロジック
- **.claude/agents/repo-dev.md**: データアクセス層

---

## 4. 完了条件チェックリスト

- [ ] チャット履歴が自動保存される
- [ ] 履歴一覧が表示される
- [ ] キーワードで履歴を検索できる
- [ ] 過去の会話を再開できる
- [ ] 履歴をMarkdown/JSONでエクスポートできる
- [ ] 履歴を削除できる

---

## 5. 備考

### レビュー指摘の原文

```
チャットの履歴を保存してほしいです。
```

### 関連タスク

- TASK-CHAT-WS-EXPORT-001: チャット成果物のワークスペース連携
