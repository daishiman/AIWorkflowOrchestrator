# マルチフォーマットファイルプレビュー機能 - タスク指示書

## メタ情報

| 項目             | 内容                                     |
| ---------------- | ---------------------------------------- |
| タスクID         | TASK-FILE-PREVIEW-001                    |
| タスク名         | マルチフォーマットファイルプレビュー機能 |
| 分類             | 新規機能                                 |
| 対象機能         | エディター・ワークスペース               |
| 優先度           | 中                                       |
| 見積もり規模     | 大規模                                   |
| ステータス       | 未実施                                   |
| 発見元           | ユーザー要望                             |
| 発見日           | 2025-12-11                               |
| 発見エージェント | @product-manager                         |

---

## 1. なぜこのタスクが必要か（Why）

### 1.1 背景

現在のエディター機能はテキストファイルの表示・編集に限定されている。しかし、実際のワークフローでは画像、PDF、CSV、Excelなど様々な形式のファイルを確認する必要がある。外部アプリケーションを開かずにアプリ内でプレビューできれば、作業効率が大幅に向上する。

### 1.2 問題点・課題

- テキスト以外のファイルを開くと外部アプリケーションが必要
- ワークフロー内でファイルの内容を確認するのに手間がかかる
- 画像やPDFの内容確認のためにコンテキストスイッチが発生
- CSV/Excelデータの簡易確認ができない
- ファイル形式ごとに異なるアプリを起動する必要がある

### 1.3 放置した場合の影響

- ユーザーの作業効率が低下する
- ワークフローの中断が頻繁に発生する
- ファイル内容の確認に時間がかかる
- 競合製品と比較して機能的に劣る
- ユーザー体験（UX）の悪化

---

## 2. 何を達成するか（What）

### 2.1 目的

エディター領域で様々な形式のファイルをプレビュー表示できるようにし、外部アプリケーションを開かずにファイル内容を確認できるようにする。

### 2.2 最終ゴール

- 主要な画像形式（PNG, JPG, GIF, SVG, WebP, ICO）のプレビュー表示
- PDFファイルのプレビュー表示（ページナビゲーション付き）
- CSV/TSVファイルのテーブル表示
- Excel（.xlsx, .xls）ファイルの簡易表示
- その他一般的なファイル形式のサポート
- ファイル形式に応じた最適なUIでの表示

### 2.3 スコープ

#### 含むもの

**画像ファイル**

- PNG, JPG, JPEG, GIF, WebP, SVG, ICO, BMP, TIFF
- ズーム機能（拡大・縮小）
- 実際のサイズ表示
- 画像情報（サイズ、形式）の表示

**ドキュメントファイル**

- PDF（ページナビゲーション、ズーム）
- Markdown（レンダリング表示）

**データファイル**

- CSV, TSV（テーブル表示、ソート機能）
- Excel（.xlsx, .xls）（シート選択、テーブル表示）
- JSON（シンタックスハイライト、折りたたみ）
- YAML（シンタックスハイライト）

**その他**

- フォントファイル（.ttf, .otf, .woff）- サンプルテキスト表示
- 動画ファイル（.mp4, .webm）- プレビュー再生
- 音声ファイル（.mp3, .wav）- 再生プレイヤー

#### 含まないもの

- ファイルの編集機能（プレビューのみ）
- 3Dモデルファイルのプレビュー
- 圧縮ファイル内のプレビュー
- 大規模ファイル（100MB以上）のフル表示
- クラウドストレージ連携

### 2.4 成果物

- ファイルプレビューコンポーネント群
- ファイル形式判定ロジック
- プレビューレンダラー（形式別）
- 関連するユニットテスト・E2Eテスト
- 技術ドキュメント

---

## 3. どのように実行するか（How）

### 3.1 前提条件

- プロジェクトの開発環境がセットアップ済み
- React/TypeScriptの基本的な知識
- Electronアプリケーションの構造理解
- ファイルシステムアクセスの理解

### 3.2 依存タスク

- なし（独立したタスク）

### 3.3 必要な知識・スキル

- React/TypeScript
- Electron（ファイルシステムアクセス）
- Canvas API（画像操作）
- PDF.js（PDFレンダリング）
- データ処理ライブラリ（csv-parse, xlsx）
- UI/UXデザイン

### 3.4 推奨アプローチ

1. ファイル形式判定システムの設計
2. プラグインアーキテクチャの設計（拡張可能な構造）
3. 基本的な画像プレビューから段階的に実装
4. PDF、CSV、Excelの順に実装
5. パフォーマンス最適化（大きなファイルの遅延読み込み）

---

## 4. 実行手順

### Phase構成

```
Phase 0: 要件定義（サポートするファイル形式の決定）
Phase 1: 設計（アーキテクチャ・コンポーネント設計）
Phase 2: 設計レビューゲート
Phase 3: テスト作成（TDD: Red）
Phase 4: 実装（TDD: Green）
Phase 5: リファクタリング（TDD: Refactor）
Phase 6: 品質保証
Phase 7: 最終レビューゲート
Phase 8: 手動テスト検証
Phase 9: ドキュメント更新
```

### Phase 0: 要件定義

#### 目的

サポートするファイル形式と各形式の表示要件を明確化する。

#### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:gather-requirements file-preview-multi-format
```

- **参照**: `.claude/commands/ai/command_list.md`

#### 使用エージェントリスト（動的選定）

- **エージェント**: @req-analyst, @product-manager
- **選定理由**: @req-analyst は要件の収集・分析に特化、@product-manager はユーザー価値の観点から優先順位を判断
- **代替候補**: @ui-designer（UI要件の観点）
- **参照**: `.claude/agents/agent_list.md`

#### 活用スキルリスト（動的選定）

| スキル名                  | 活用方法                 | 選定理由                      |
| ------------------------- | ------------------------ | ----------------------------- |
| requirements-engineering  | ファイル形式別要件の定義 | 検証可能な要件の明確化        |
| use-case-modeling         | ユーザーシナリオの特定   | 実際の使用シーンを把握        |
| prioritization-frameworks | 実装優先度の決定         | MVPとして何を最初に実装するか |

- **参照**: `.claude/skills/skill_list.md`

#### 成果物

| 成果物           | パス                                                       | 内容                   |
| ---------------- | ---------------------------------------------------------- | ---------------------- |
| ファイル形式要件 | docs/30-workflows/file-preview/task-step00-requirements.md | サポート形式と表示要件 |
| 優先度マトリクス | docs/30-workflows/file-preview/task-step00-priority.md     | 実装優先順位           |

#### 完了条件

- [ ] サポートするファイル形式が決定されている
- [ ] 各形式の表示要件が明確になっている
- [ ] 実装優先順位が決定されている
- [ ] パフォーマンス要件が定義されている

---

### Phase 1: 設計

#### T-01-1: プラグインアーキテクチャ設計

##### 目的

拡張可能なファイルプレビューアーキテクチャを設計する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:design-architecture file-preview-plugin
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @arch-police, @electron-architect
- **選定理由**: @arch-police はクリーンアーキテクチャの観点、@electron-architect はElectronでのファイルアクセスパターン設計
- **代替候補**: @logic-dev（プラグイン実装観点）
- **参照**: `.claude/agents/agent_list.md`

##### 活用スキルリスト（動的選定）

| スキル名                      | 活用方法                   | 選定理由                   |
| ----------------------------- | -------------------------- | -------------------------- |
| clean-architecture-principles | レイヤー分離の設計         | 疎結合なプラグイン構造     |
| plugin-architecture           | プラグインパターン設計     | 拡張可能な構造             |
| factory-patterns              | プレビューレンダラーの生成 | 形式に応じたレンダラー選択 |

- **参照**: `.claude/skills/skill_list.md`

##### 成果物

| 成果物             | パス                                                       | 内容               |
| ------------------ | ---------------------------------------------------------- | ------------------ |
| アーキテクチャ設計 | docs/30-workflows/file-preview/task-step01-architecture.md | プラグイン構造設計 |

##### 完了条件

- [ ] プラグインインターフェースが設計されている
- [ ] ファイル形式判定ロジックが設計されている
- [ ] レンダラー選択パターンが決定されている

---

#### T-01-2: コンポーネント設計

##### 目的

各ファイル形式のプレビューコンポーネントを設計する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:create-component FilePreview organism
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @ui-designer
- **選定理由**: UI/UX設計とコンポーネント構造に特化
- **代替候補**: @frontend-tester（テスト可能性の観点）
- **参照**: `.claude/agents/agent_list.md`

##### 活用スキルリスト（動的選定）

| スキル名                       | 活用方法                   | 選定理由               |
| ------------------------------ | -------------------------- | ---------------------- |
| component-composition-patterns | コンポーネント構造設計     | 再利用可能な設計       |
| accessibility-wcag             | アクセシブルなプレビューUI | 誰でも使えるUI         |
| progressive-disclosure         | 段階的な情報表示           | 大量情報の効果的な表示 |

- **参照**: `.claude/skills/skill_list.md`

##### 成果物

| 成果物             | パス                                                     | 内容                       |
| ------------------ | -------------------------------------------------------- | -------------------------- |
| コンポーネント設計 | docs/30-workflows/file-preview/task-step01-components.md | 各プレビューコンポーネント |

##### 完了条件

- [ ] ImagePreviewコンポーネントが設計されている
- [ ] PDFPreviewコンポーネントが設計されている
- [ ] DataTablePreviewコンポーネントが設計されている
- [ ] 共通のプレビューツールバーが設計されている

---

### Phase 2: 設計レビューゲート

#### 目的

実装前に設計の妥当性を検証する。

#### レビュー参加エージェント（動的選定）

| エージェント       | レビュー観点         | 選定理由                   |
| ------------------ | -------------------- | -------------------------- |
| @arch-police       | アーキテクチャ整合性 | プラグイン構造の妥当性     |
| @electron-security | セキュリティ         | ファイルアクセスの安全性   |
| @ui-designer       | UI/UX                | プレビュー表示の使いやすさ |
| @sre-observer      | パフォーマンス       | 大きなファイルの処理負荷   |

- **参照**: `.claude/agents/agent_list.md`

#### レビューチェックリスト

**アーキテクチャ整合性** (@arch-police)

- [ ] プラグイン構造が拡張可能か
- [ ] 既存のコンポーネントと整合しているか
- [ ] 依存関係が適切に管理されているか

**セキュリティ** (@electron-security)

- [ ] ファイルアクセスが安全に行われるか
- [ ] 悪意のあるファイルへの対策があるか
- [ ] サンドボックス内での実行が考慮されているか

**UI/UX** (@ui-designer)

- [ ] 各形式のプレビューが直感的に使えるか
- [ ] ズーム・ナビゲーションが使いやすいか
- [ ] ローディング状態が適切に表示されるか

**パフォーマンス** (@sre-observer)

- [ ] 大きなファイルの遅延読み込みが考慮されているか
- [ ] メモリ使用量が適切に管理されているか
- [ ] 仮想スクロールが検討されているか

#### 完了条件

- [ ] 設計レビューがPASS
- [ ] セキュリティ要件が満たされている
- [ ] 指摘事項が対応済み

---

### Phase 3: テスト作成 (TDD: Red)

#### T-03-1: ファイル形式判定のテスト作成

##### 目的

ファイル形式判定ロジックのテストを先に作成する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:generate-unit-tests packages/shared/utils/fileTypeDetector.ts
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @unit-tester
- **選定理由**: TDD原則に基づくテスト作成に特化
- **代替候補**: @logic-dev（ロジック設計観点）
- **参照**: `.claude/agents/agent_list.md`

##### TDD検証: Red状態確認

```bash
pnpm --filter @repo/shared test:run
```

- [ ] テストが失敗することを確認（Red状態）

##### 完了条件

- [ ] ファイル形式判定のテストケースが作成済み
- [ ] 各形式（画像、PDF、CSV等）のテストがある
- [ ] テストがRed状態であることを確認

---

#### T-03-2: プレビューコンポーネントのテスト作成

##### 目的

各プレビューコンポーネントのテストを先に作成する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:generate-component-tests apps/desktop/src/renderer/components/organisms/FilePreview
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @frontend-tester
- **選定理由**: Reactコンポーネントのテストに特化
- **代替候補**: @e2e-tester（統合テスト観点）
- **参照**: `.claude/agents/agent_list.md`

##### TDD検証: Red状態確認

```bash
pnpm --filter @repo/desktop test:run
```

- [ ] テストが失敗することを確認（Red状態）

##### 完了条件

- [ ] プレビューコンポーネントのテストケースが作成済み
- [ ] テストがRed状態であることを確認

---

### Phase 4: 実装 (TDD: Green)

#### T-04-1: ファイル形式判定ロジック実装

##### 目的

ファイル形式を判定するロジックを実装する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:implement-business-logic file-type-detector
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @logic-dev
- **選定理由**: ビジネスロジックの実装に特化
- **代替候補**: @schema-def（型定義観点）
- **参照**: `.claude/agents/agent_list.md`

##### TDD検証: Green状態確認

```bash
pnpm --filter @repo/shared test:run
```

- [ ] テストが成功することを確認（Green状態）

##### 完了条件

- [ ] MIMEタイプ判定が実装されている
- [ ] 拡張子判定が実装されている
- [ ] マジックバイト判定が実装されている（オプション）

---

#### T-04-2: 画像プレビューコンポーネント実装

##### 目的

画像ファイルのプレビューコンポーネントを実装する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:create-component ImagePreview molecule
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @ui-designer
- **選定理由**: UIコンポーネントの実装に特化
- **代替候補**: @electron-ui-dev（Electron固有のUI実装）
- **参照**: `.claude/agents/agent_list.md`

##### 活用スキルリスト（動的選定）

| スキル名              | 活用方法         | 選定理由             |
| --------------------- | ---------------- | -------------------- |
| canvas-api-patterns   | 画像の描画・操作 | ズーム・パン機能     |
| react-hooks-patterns  | 状態管理         | ズームレベル等の状態 |
| tailwind-css-patterns | スタイリング     | 一貫したデザイン     |

- **参照**: `.claude/skills/skill_list.md`

##### 完了条件

- [ ] 画像表示が動作する
- [ ] ズーム機能が動作する
- [ ] 画像情報（サイズ、形式）が表示される

---

#### T-04-3: PDFプレビューコンポーネント実装

##### 目的

PDFファイルのプレビューコンポーネントを実装する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:create-component PDFPreview molecule
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @ui-designer, @logic-dev
- **選定理由**: @ui-designer はUI実装、@logic-dev はPDF.js連携ロジック
- **代替候補**: @dep-mgr（ライブラリ選定観点）
- **参照**: `.claude/agents/agent_list.md`

##### 活用スキルリスト（動的選定）

| スキル名            | 活用方法               | 選定理由              |
| ------------------- | ---------------------- | --------------------- |
| pdfjs-integration   | PDF.jsライブラリの活用 | PDFレンダリング       |
| pagination-patterns | ページナビゲーション   | 複数ページの操作      |
| virtualization      | 仮想スクロール         | 大きなPDFの効率的表示 |

- **参照**: `.claude/skills/skill_list.md`

##### 完了条件

- [ ] PDF表示が動作する
- [ ] ページナビゲーションが動作する
- [ ] ズーム機能が動作する

---

#### T-04-4: データテーブルプレビューコンポーネント実装

##### 目的

CSV/Excelファイルのテーブル表示コンポーネントを実装する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:create-component DataTablePreview molecule
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @ui-designer, @logic-dev
- **選定理由**: @ui-designer はテーブルUI、@logic-dev はデータパース処理
- **代替候補**: @db-architect（データ構造観点）
- **参照**: `.claude/agents/agent_list.md`

##### 活用スキルリスト（動的選定）

| スキル名       | 活用方法               | 選定理由           |
| -------------- | ---------------------- | ------------------ |
| xlsx-library   | Excelファイルのパース  | Excel形式対応      |
| csv-parsing    | CSVファイルのパース    | CSV形式対応        |
| virtual-scroll | 仮想スクロールテーブル | 大量行の効率的表示 |

- **参照**: `.claude/skills/skill_list.md`

##### 完了条件

- [ ] CSV表示が動作する
- [ ] Excel表示が動作する
- [ ] シート選択が動作する（Excel）
- [ ] 列ソートが動作する

---

#### T-04-5: メディアプレビューコンポーネント実装

##### 目的

動画/音声ファイルのプレビューコンポーネントを実装する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:create-component MediaPreview molecule
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @ui-designer
- **選定理由**: メディアプレイヤーUIの実装
- **代替候補**: @electron-ui-dev（Electron特有のメディア処理）
- **参照**: `.claude/agents/agent_list.md`

##### 完了条件

- [ ] 動画再生が動作する
- [ ] 音声再生が動作する
- [ ] 再生コントロールが動作する

---

#### T-04-6: プレビューコンテナ統合

##### 目的

各プレビューコンポーネントを統合するコンテナコンポーネントを実装する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:create-component FilePreviewContainer organism
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @ui-designer, @state-manager
- **選定理由**: @ui-designer はコンテナUI、@state-manager はプレビュー状態管理
- **代替候補**: @router-dev（ファイル選択のルーティング）
- **参照**: `.claude/agents/agent_list.md`

##### TDD検証: Green状態確認

```bash
pnpm --filter @repo/desktop test:run
```

- [ ] テストが成功することを確認（Green状態）

##### 完了条件

- [ ] ファイル形式に応じた適切なプレビューが表示される
- [ ] エラー時のフォールバック表示が動作する
- [ ] ローディング状態が表示される

---

### Phase 5: リファクタリング (TDD: Refactor)

#### 目的

コード品質を改善する。

#### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:refactor apps/desktop/src/renderer/components/organisms/FilePreview
```

- **参照**: `.claude/commands/ai/command_list.md`

#### 使用エージェントリスト（動的選定）

- **エージェント**: @code-quality
- **選定理由**: コード品質改善に特化
- **代替候補**: @arch-police（構造改善観点）
- **参照**: `.claude/agents/agent_list.md`

#### TDD検証: 継続Green確認

```bash
pnpm test:all
```

- [ ] リファクタリング後もテストが成功することを確認

#### 完了条件

- [ ] 共通ロジックが抽出されている
- [ ] 適切な抽象化が行われている
- [ ] テストが継続してGreen状態

---

### Phase 6: 品質保証

#### 目的

品質基準を満たすことを検証する。

#### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:lint --fix
/ai:analyze-code-quality apps/desktop/src/renderer/components/organisms/FilePreview
/ai:security-audit file-access
```

- **参照**: `.claude/commands/ai/command_list.md`

#### 使用エージェントリスト（動的選定）

- **エージェント**: @code-quality, @electron-security
- **選定理由**: @code-quality は品質検証、@electron-security はファイルアクセスのセキュリティ検証
- **代替候補**: @sre-observer（パフォーマンス観点）
- **参照**: `.claude/agents/agent_list.md`

#### 完了条件

- [ ] Lintエラーなし
- [ ] 型エラーなし
- [ ] テストカバレッジ80%以上
- [ ] セキュリティ脆弱性なし

---

### Phase 7: 最終レビューゲート

#### 目的

実装の総合的な品質を検証する。

#### レビュー参加エージェント（動的選定）

| エージェント       | レビュー観点       | 選定理由                       |
| ------------------ | ------------------ | ------------------------------ |
| @code-quality      | コード品質         | 実装品質の確認                 |
| @arch-police       | アーキテクチャ遵守 | プラグイン構造の確認           |
| @electron-security | セキュリティ       | ファイルアクセスの安全性確認   |
| @ui-designer       | UI/UX              | プレビュー表示の使いやすさ確認 |
| @sre-observer      | パフォーマンス     | 大きなファイル処理の確認       |

- **参照**: `.claude/agents/agent_list.md`

#### 完了条件

- [ ] 最終レビューがPASS
- [ ] 全ての指摘事項が対応済み

---

### Phase 8: 手動テスト検証

#### 目的

実際のファイルでプレビュー機能を確認する。

#### 手動テストケース

| No  | カテゴリ       | テスト項目                 | 前提条件       | 操作手順                    | 期待結果                           | 実行結果 | 備考 |
| --- | -------------- | -------------------------- | -------------- | --------------------------- | ---------------------------------- | -------- | ---- |
| 1   | 画像           | PNG画像のプレビュー        | アプリ起動済み | PNGファイルを選択           | 画像が表示される                   | -        | -    |
| 2   | 画像           | 大きな画像のズーム         | 画像表示中     | ズームイン/アウト           | 適切に拡大/縮小される              | -        | -    |
| 3   | 画像           | SVG画像のプレビュー        | アプリ起動済み | SVGファイルを選択           | SVGが正しく表示される              | -        | -    |
| 4   | PDF            | PDFのプレビュー            | アプリ起動済み | PDFファイルを選択           | PDFが表示される                    | -        | -    |
| 5   | PDF            | 複数ページのナビゲーション | PDF表示中      | 次/前ページボタンをクリック | ページが切り替わる                 | -        | -    |
| 6   | CSV            | CSVのテーブル表示          | アプリ起動済み | CSVファイルを選択           | テーブル形式で表示される           | -        | -    |
| 7   | CSV            | 列ソート                   | CSV表示中      | 列ヘッダーをクリック        | その列でソートされる               | -        | -    |
| 8   | Excel          | Excelのプレビュー          | アプリ起動済み | xlsxファイルを選択          | テーブル形式で表示される           | -        | -    |
| 9   | Excel          | シート切り替え             | Excel表示中    | シートタブをクリック        | シートが切り替わる                 | -        | -    |
| 10  | 動画           | 動画のプレビュー再生       | アプリ起動済み | mp4ファイルを選択           | 動画プレイヤーが表示される         | -        | -    |
| 11  | 音声           | 音声ファイルの再生         | アプリ起動済み | mp3ファイルを選択           | 音声プレイヤーが表示される         | -        | -    |
| 12  | エラー         | サポート外ファイル         | アプリ起動済み | サポート外のファイルを選択  | 適切なエラーメッセージが表示される | -        | -    |
| 13  | パフォーマンス | 大きなCSVファイル          | アプリ起動済み | 100MB超のCSVファイルを選択  | 遅延読み込みで表示される           | -        | -    |

#### 完了条件

- [ ] 全手動テストケースがPASS

---

### Phase 9: ドキュメント更新

#### 目的

実装内容をドキュメントに反映する。

#### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:update-all-docs
```

- **参照**: `.claude/commands/ai/command_list.md`

#### 使用エージェントリスト（動的選定）

- **エージェント**: @spec-writer, @manual-writer
- **選定理由**: @spec-writer は技術仕様ドキュメント、@manual-writer はユーザー向けドキュメント
- **代替候補**: @api-doc-writer（プラグインAPI観点）
- **参照**: `.claude/agents/agent_list.md`

#### 完了条件

- [ ] docs/00-requirements/ 配下の関連ドキュメントが更新済み
- [ ] サポートファイル形式一覧が記載済み
- [ ] プレビュー機能の使用方法が記載済み

---

## 5. 完了条件チェックリスト

### 機能要件

- [ ] 画像ファイル（PNG, JPG, GIF, SVG, WebP等）がプレビューできる
- [ ] PDFファイルがプレビューできる（ページナビゲーション付き）
- [ ] CSV/TSVファイルがテーブル表示できる
- [ ] Excelファイルがプレビューできる（シート選択付き）
- [ ] 動画/音声ファイルが再生できる
- [ ] ズーム機能が動作する
- [ ] エラー時に適切なメッセージが表示される

### 品質要件

- [ ] 全テストがPASS
- [ ] Lintエラーなし
- [ ] 型エラーなし
- [ ] コードカバレッジ80%以上
- [ ] セキュリティ脆弱性なし

### パフォーマンス要件

- [ ] 大きなファイルでもUIがフリーズしない
- [ ] 遅延読み込みが実装されている
- [ ] メモリリークがない

### ドキュメント要件

- [ ] 関連ドキュメントが更新済み
- [ ] サポートファイル形式一覧が記載済み

---

## 6. 検証方法

### テストケース

1. ファイル形式判定のユニットテスト
2. 各プレビューコンポーネントのユニットテスト
3. プレビューコンテナの統合テスト
4. E2Eテスト（ファイル選択からプレビュー表示まで）

### 検証手順

1. 開発環境でアプリを起動
2. 各種形式のファイルを選択
3. プレビューが正しく表示されることを確認
4. ズーム・ナビゲーション機能を確認

---

## 7. リスクと対策

| リスク                                   | 影響度 | 発生確率 | 対策                                         |
| ---------------------------------------- | ------ | -------- | -------------------------------------------- |
| 大きなファイルでのパフォーマンス低下     | 高     | 中       | 遅延読み込み、仮想スクロール、ストリーミング |
| セキュリティリスク（悪意のあるファイル） | 高     | 低       | サンドボックス内での処理、ファイル検証       |
| ライブラリの依存関係増大                 | 中     | 高       | 必要最小限のライブラリ選定、Tree Shaking     |
| ブラウザ間の互換性                       | 中     | 中       | Electronの統一環境を活用                     |
| メモリリーク                             | 高     | 中       | コンポーネントアンマウント時のクリーンアップ |

---

## 8. 参照情報

### 関連ドキュメント

- `docs/00-requirements/04-directory-structure.md` - ディレクトリ構造
- `docs/00-requirements/16-ui-ux-guidelines.md` - UI/UXガイドライン

### 参考資料

- [PDF.js Documentation](https://mozilla.github.io/pdf.js/)
- [SheetJS (xlsx) Documentation](https://docs.sheetjs.com/)
- [React-PDF](https://react-pdf.org/)
- [Electron File System](https://www.electronjs.org/docs/latest/api/app#appgetpathname)

---

## 9. 備考

### レビュー指摘の原文（該当する場合）

```
画像やPDFなどもこのエディターの部分で表示できるようにしてほしいです。
画像、PDF、CSV、LOCKSなどなど、想定できるファイル関係がすべて表示できるようにしてほしいです。
```

### 補足事項

- Electronアプリでのファイルプレビューを想定
- 編集機能は含まない（プレビューのみ）
- 将来的にプラグインとして機能拡張可能な設計を目指す
- ファイルサイズの上限を設定する（例: 100MB）
- サポート外のファイルは外部アプリで開くオプションを提供
