# ユーザーアナリティクス・イベントトラッキング - タスク指示書

## メタ情報

| 項目             | 内容                                         |
| ---------------- | -------------------------------------------- |
| タスクID         | TASK-ANALYTICS-001                           |
| タスク名         | ユーザーアナリティクス・イベントトラッキング |
| 分類             | 新規機能                                     |
| 対象機能         | アプリケーション全体                         |
| 優先度           | 中                                           |
| 見積もり規模     | 大規模                                       |
| ステータス       | 未実施                                       |
| 発見元           | ユーザー要望                                 |
| 発見日           | 2025-12-11                                   |
| 発見エージェント | @product-manager                             |

---

## 1. なぜこのタスクが必要か（Why）

### 1.1 背景

アプリケーションの改善と新機能開発を効果的に行うためには、ユーザーの実際の行動パターンを把握することが不可欠である。現在、ユーザーがどの画面をよく利用しているか、どのような操作フローをたどっているかなどのデータが収集されていない。このデータがあれば、UI/UXの改善点を客観的に特定し、優先度の高い機能開発に注力できる。

### 1.2 問題点・課題

- ユーザーの行動パターンが把握できていない
- どの画面がよく利用されているか不明
- ユーザーの操作フロー（導線）が可視化されていない
- 機能改善の優先度判断が主観的になりがち
- UI/UXの問題点を客観的に特定できない
- 新機能開発の方向性を決めるデータがない

### 1.3 放置した場合の影響

- ユーザーニーズに合わない機能開発が行われる可能性
- UI/UXの問題が放置され、ユーザー離脱につながる
- 限られた開発リソースを効果的に配分できない
- 競合製品との差別化ポイントが不明確になる
- プロダクトの成長戦略が立てられない

---

## 2. 何を達成するか（What）

### 2.1 目的

ユーザーの行動データを収集・分析できる基盤を構築し、データドリブンなプロダクト改善を可能にする。

### 2.2 最終ゴール

- ユーザーの画面閲覧データが収集・可視化されている
- ユーザーの操作フロー（ファネル）が分析可能
- 収集したデータからUI/UXの改善点が特定できる
- 新機能開発の優先度判断に活用できるダッシュボードがある
- プライバシーに配慮した適切なデータ収集が行われている

### 2.3 スコープ

#### 含むもの

- イベントトラッキング基盤の設計・実装
- 画面閲覧（Page View）トラッキング
- ユーザー操作（クリック、フォーム入力等）トラッキング
- セッション管理とユーザージャーニー追跡
- データ保存・集計基盤
- 分析ダッシュボードUI
- プライバシーポリシー対応（オプトアウト機能）

#### 含まないもの

- 外部アナリティクスサービス（Google Analytics等）との連携
- リアルタイム分析機能（バッチ処理を優先）
- AIを使った高度な行動予測
- A/Bテスト機能

### 2.4 成果物

- イベントトラッキングSDK/ライブラリ
- トラッキングデータスキーマ
- データ保存・集計バックエンド
- 分析ダッシュボードUI
- 関連するユニットテスト・E2Eテスト
- プライバシーポリシー更新
- 技術ドキュメント

---

## 3. どのように実行するか（How）

### 3.1 前提条件

- プロジェクトの開発環境がセットアップ済み
- データベース（Supabase）の基本設定が完了
- React/TypeScriptの基本的な知識
- Electronアプリケーションの構造理解

### 3.2 依存タスク

- なし（独立したタスク）

### 3.3 必要な知識・スキル

- React/TypeScript
- Electron（メインプロセス・レンダラープロセス間通信）
- データベース設計（PostgreSQL/Supabase）
- データ集計・可視化（チャートライブラリ）
- プライバシー関連の法規制理解（GDPR、個人情報保護法）

### 3.4 推奨アプローチ

1. イベントトラッキングのアーキテクチャ設計
2. データスキーマ設計（どのイベントをどう保存するか）
3. 軽量なトラッキングSDKの実装
4. バッチ送信によるパフォーマンス最適化
5. ダッシュボードUIの段階的実装
6. プライバシー対応（オプトアウト、データ匿名化）

---

## 4. 実行手順

### Phase構成

```
Phase 0: 要件定義（収集するイベントの定義）
Phase 1: 設計（アーキテクチャ・データスキーマ設計）
Phase 2: 設計レビューゲート
Phase 3: テスト作成（TDD: Red）
Phase 4: 実装（TDD: Green）
Phase 5: リファクタリング（TDD: Refactor）
Phase 6: 品質保証
Phase 7: 最終レビューゲート
Phase 8: 手動テスト検証
Phase 9: ドキュメント更新
```

### Phase 0: 要件定義

#### 目的

収集すべきイベントを定義し、分析要件を明確化する。

#### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:gather-requirements user-analytics-tracking
```

- **参照**: `.claude/commands/ai/command_list.md`

#### 使用エージェントリスト（動的選定）

- **エージェント**: @req-analyst, @product-manager
- **選定理由**: @req-analyst は要件の収集・分析に特化、@product-manager はビジネス価値とユーザー価値の観点から要件を整理
- **代替候補**: @domain-modeler（イベントのドメインモデリング観点）
- **参照**: `.claude/agents/agent_list.md`

#### 活用スキルリスト（動的選定）

| スキル名                 | 活用方法                       | 選定理由                         |
| ------------------------ | ------------------------------ | -------------------------------- |
| requirements-engineering | 収集イベントの要件定義         | 検証可能な要件の明確化           |
| use-case-modeling        | 分析ユースケースの特定         | どんな分析をしたいかを明確にする |
| metrics-tracking         | KPIと計測指標の定義            | 収集すべきメトリクスの特定       |
| interview-techniques     | ステークホルダーへのヒアリング | 分析ニーズの把握                 |

- **参照**: `.claude/skills/skill_list.md`

#### 成果物

| 成果物         | パス                                                                   | 内容                   |
| -------------- | ---------------------------------------------------------------------- | ---------------------- |
| イベント定義書 | docs/30-workflows/user-analytics-tracking/task-step00-requirements.md  | 収集するイベントの定義 |
| 分析要件定義   | docs/30-workflows/user-analytics-tracking/task-step00-analytics-req.md | 分析したい内容の定義   |

#### 完了条件

- [ ] 収集するイベントの種類が定義されている
- [ ] 各イベントに含めるデータ項目が明確になっている
- [ ] 分析で達成したいゴールが定義されている
- [ ] プライバシー要件が整理されている

---

### Phase 1: 設計

#### T-01-1: アーキテクチャ設計

##### 目的

イベントトラッキング基盤全体のアーキテクチャを設計する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:design-architecture analytics-event-driven
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @arch-police, @electron-architect
- **選定理由**: @arch-police はクリーンアーキテクチャの観点から設計検証、@electron-architect はElectronアプリ特有のメイン/レンダラープロセス間のデータフローを設計
- **代替候補**: @sre-observer（データパイプラインの観点）
- **参照**: `.claude/agents/agent_list.md`

##### 活用スキルリスト（動的選定）

| スキル名                      | 活用方法                   | 選定理由                        |
| ----------------------------- | -------------------------- | ------------------------------- |
| clean-architecture-principles | レイヤー分離の設計         | 疎結合なトラッキング基盤        |
| event-driven-architecture     | イベント駆動の設計パターン | 柔軟なイベント収集              |
| electron-ipc-patterns         | IPC通信パターン            | メイン/レンダラー間のデータ送信 |

- **参照**: `.claude/skills/skill_list.md`

##### 成果物

| 成果物             | パス                                                                  | 内容                 |
| ------------------ | --------------------------------------------------------------------- | -------------------- |
| アーキテクチャ設計 | docs/30-workflows/user-analytics-tracking/task-step01-architecture.md | 全体アーキテクチャ図 |

##### 完了条件

- [ ] イベント収集からダッシュボード表示までのデータフローが設計されている
- [ ] Electron IPC通信パターンが決定されている
- [ ] バッチ送信の仕組みが設計されている

---

#### T-01-2: データスキーマ設計

##### 目的

イベントデータの保存スキーマを設計する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:design-database analytics_events
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @db-architect, @schema-def
- **選定理由**: @db-architect はデータベース設計の観点、@schema-def はイベントスキーマの型安全性を確保
- **代替候補**: @dba-mgr（クエリパフォーマンスの観点）
- **参照**: `.claude/agents/agent_list.md`

##### 活用スキルリスト（動的選定）

| スキル名               | 活用方法                         | 選定理由               |
| ---------------------- | -------------------------------- | ---------------------- |
| database-normalization | スキーマ正規化                   | 効率的なデータ保存     |
| indexing-strategies    | インデックス設計                 | 分析クエリの高速化     |
| zod-validation         | イベントスキーマのバリデーション | 型安全なイベントデータ |

- **参照**: `.claude/skills/skill_list.md`

##### 成果物

| 成果物           | パス                                                               | 内容                       |
| ---------------- | ------------------------------------------------------------------ | -------------------------- |
| データベース設計 | docs/30-workflows/user-analytics-tracking/task-step01-db-schema.md | テーブル・インデックス設計 |
| マイグレーション | supabase/migrations/xxx_create_analytics_tables.sql                | DBマイグレーションファイル |

##### 完了条件

- [ ] イベントテーブルのスキーマが設計されている
- [ ] セッションテーブルのスキーマが設計されている
- [ ] 適切なインデックスが設計されている
- [ ] パーティショニング戦略が検討されている

---

#### T-01-3: トラッキングSDK設計

##### 目的

アプリケーション側で使用するトラッキングSDKのAPIを設計する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:design-api analytics-tracker
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @api-doc-writer, @logic-dev
- **選定理由**: @api-doc-writer はSDK APIの設計ドキュメント作成、@logic-dev は実装観点からのAPI設計
- **代替候補**: @gateway-dev（外部連携観点）
- **参照**: `.claude/agents/agent_list.md`

##### 活用スキルリスト（動的選定）

| スキル名                         | 活用方法            | 選定理由                         |
| -------------------------------- | ------------------- | -------------------------------- |
| api-client-patterns              | SDK APIパターン設計 | 使いやすいAPI                    |
| type-safety-patterns             | 型安全なAPI設計     | TypeScriptでの型安全性           |
| api-documentation-best-practices | SDK ドキュメント    | 開発者フレンドリーなドキュメント |

- **参照**: `.claude/skills/skill_list.md`

##### 成果物

| 成果物      | パス                                                                | 内容           |
| ----------- | ------------------------------------------------------------------- | -------------- |
| SDK API設計 | docs/30-workflows/user-analytics-tracking/task-step01-sdk-design.md | SDK APIの仕様  |
| 型定義      | packages/shared/types/analytics.ts                                  | イベント型定義 |

##### 完了条件

- [ ] SDK のパブリックAPIが設計されている
- [ ] イベント型定義が作成されている
- [ ] 使用例（コードサンプル）が記載されている

---

#### T-01-4: ダッシュボードUI設計

##### 目的

分析データを可視化するダッシュボードUIを設計する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:create-page settings/analytics
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @ui-designer
- **選定理由**: ダッシュボードUIのデザインとユーザビリティ設計に特化
- **代替候補**: @frontend-tester（表示テストの観点）
- **参照**: `.claude/agents/agent_list.md`

##### 活用スキルリスト（動的選定）

| スキル名               | 活用方法                     | 選定理由             |
| ---------------------- | ---------------------------- | -------------------- |
| data-visualization     | チャート・グラフ設計         | 効果的なデータ可視化 |
| progressive-disclosure | 段階的な情報開示             | 情報過多を防ぐUI     |
| accessibility-wcag     | アクセシブルなダッシュボード | 誰でも使えるUI       |

- **参照**: `.claude/skills/skill_list.md`

##### 成果物

| 成果物           | パス                                                                      | 内容                 |
| ---------------- | ------------------------------------------------------------------------- | -------------------- |
| UI設計書         | docs/30-workflows/user-analytics-tracking/task-step01-dashboard-design.md | ダッシュボードUI設計 |
| ワイヤーフレーム | docs/30-workflows/user-analytics-tracking/wireframes/                     | 画面設計             |

##### 完了条件

- [ ] ダッシュボードのレイアウトが設計されている
- [ ] 表示するグラフ・チャートの種類が決定されている
- [ ] フィルタ・期間選択のUIが設計されている

---

### Phase 2: 設計レビューゲート

#### 目的

実装前に設計の妥当性を検証する。

#### レビュー参加エージェント（動的選定）

| エージェント  | レビュー観点               | 選定理由                             |
| ------------- | -------------------------- | ------------------------------------ |
| @arch-police  | アーキテクチャ整合性       | クリーンアーキテクチャとの整合性確認 |
| @sec-auditor  | プライバシー・セキュリティ | 個人情報の取り扱いの適切性           |
| @db-architect | データベース設計           | スキーマ・パフォーマンスの妥当性     |
| @ui-designer  | UI/UX                      | ダッシュボードの使いやすさ           |

- **参照**: `.claude/agents/agent_list.md`

#### レビューチェックリスト

**アーキテクチャ整合性** (@arch-police)

- [ ] クリーンアーキテクチャのレイヤー違反がないか
- [ ] 既存のアーキテクチャと整合しているか
- [ ] トラッキング機能が疎結合に設計されているか

**プライバシー・セキュリティ** (@sec-auditor)

- [ ] 収集するデータに個人情報が含まれていないか
- [ ] オプトアウト機能が設計されているか
- [ ] データの保存期間が定義されているか
- [ ] GDPR/個人情報保護法への対応が考慮されているか

**データベース設計** (@db-architect)

- [ ] スキーマが正規化されているか
- [ ] 適切なインデックスが設計されているか
- [ ] 大量データに対するパフォーマンスが考慮されているか

**UI/UX** (@ui-designer)

- [ ] ダッシュボードが直感的に使えるか
- [ ] 必要な情報が適切に可視化されているか

#### 完了条件

- [ ] 設計レビューがPASS
- [ ] プライバシー要件が満たされている
- [ ] 指摘事項が対応済み

---

### Phase 3: テスト作成 (TDD: Red)

#### T-03-1: トラッキングSDKのテスト作成

##### 目的

トラッキングSDKの機能テストを先に作成する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:generate-unit-tests packages/shared/analytics/tracker.ts
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @unit-tester
- **選定理由**: TDD原則に基づくテスト作成に特化
- **代替候補**: @e2e-tester（統合テスト観点）
- **参照**: `.claude/agents/agent_list.md`

##### 活用スキルリスト（動的選定）

| スキル名                | 活用方法                   | 選定理由           |
| ----------------------- | -------------------------- | ------------------ |
| tdd-principles          | Red-Green-Refactorサイクル | テスト駆動開発     |
| test-doubles            | モック・スタブの活用       | 外部依存の分離     |
| boundary-value-analysis | 境界値テスト               | エッジケースの検出 |

- **参照**: `.claude/skills/skill_list.md`

##### TDD検証: Red状態確認

```bash
pnpm --filter @repo/shared test:run
```

- [ ] テストが失敗することを確認（Red状態）

##### 完了条件

- [ ] トラッキングSDKのテストケースが作成済み
- [ ] イベント送信のモックが準備済み
- [ ] テストがRed状態であることを確認

---

#### T-03-2: ダッシュボードUIのテスト作成

##### 目的

ダッシュボードUIのコンポーネントテストを先に作成する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:generate-component-tests apps/desktop/src/renderer/views/AnalyticsDashboard
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @frontend-tester
- **選定理由**: Reactコンポーネントのテストに特化
- **代替候補**: @unit-tester（ロジックテスト観点）
- **参照**: `.claude/agents/agent_list.md`

##### TDD検証: Red状態確認

```bash
pnpm --filter @repo/desktop test:run
```

- [ ] テストが失敗することを確認（Red状態）

##### 完了条件

- [ ] ダッシュボードUIのテストケースが作成済み
- [ ] テストがRed状態であることを確認

---

### Phase 4: 実装 (TDD: Green)

#### T-04-1: トラッキングSDK実装

##### 目的

テストを通過するトラッキングSDKを実装する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:implement-business-logic analytics-tracker
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @logic-dev
- **選定理由**: ビジネスロジックの実装に特化
- **代替候補**: @electron-ui-dev（Electron固有の実装）
- **参照**: `.claude/agents/agent_list.md`

##### 活用スキルリスト（動的選定）

| スキル名               | 活用方法                   | 選定理由             |
| ---------------------- | -------------------------- | -------------------- |
| singleton-pattern      | トラッカーインスタンス管理 | グローバルトラッカー |
| queue-batch-processing | バッチ送信の実装           | パフォーマンス最適化 |
| local-storage-patterns | オフラインバッファリング   | ネットワーク障害対応 |

- **参照**: `.claude/skills/skill_list.md`

##### TDD検証: Green状態確認

```bash
pnpm --filter @repo/shared test:run
```

- [ ] テストが成功することを確認（Green状態）

##### 完了条件

- [ ] トラッキングSDKが実装されている
- [ ] イベント送信機能が動作する
- [ ] バッチ送信が実装されている
- [ ] オプトアウト機能が実装されている

---

#### T-04-2: データベースマイグレーション実装

##### 目的

イベントデータを保存するデータベーステーブルを作成する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:create-migration create_analytics_events
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @dba-mgr
- **選定理由**: マイグレーション作成とDB管理に特化
- **代替候補**: @db-architect（設計レビュー観点）
- **参照**: `.claude/agents/agent_list.md`

##### 完了条件

- [ ] マイグレーションファイルが作成されている
- [ ] マイグレーションが正常に実行できる
- [ ] ロールバックが正常に動作する

---

#### T-04-3: バックエンドAPI実装

##### 目的

イベントデータの受信・集計APIを実装する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:create-api-gateway analytics
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @gateway-dev, @repo-dev
- **選定理由**: @gateway-dev はAPI設計・実装、@repo-dev はデータアクセス層の実装
- **代替候補**: @logic-dev（ビジネスロジック観点）
- **参照**: `.claude/agents/agent_list.md`

##### 完了条件

- [ ] イベント受信APIが実装されている
- [ ] データ集計APIが実装されている
- [ ] APIのバリデーションが実装されている

---

#### T-04-4: ダッシュボードUI実装

##### 目的

分析データを可視化するダッシュボードUIを実装する。

##### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:create-page settings/analytics
```

- **参照**: `.claude/commands/ai/command_list.md`

##### 使用エージェントリスト（動的選定）

- **エージェント**: @ui-designer, @state-manager
- **選定理由**: @ui-designer はUI実装、@state-manager はダッシュボードの状態管理
- **代替候補**: @router-dev（ルーティング観点）
- **参照**: `.claude/agents/agent_list.md`

##### 活用スキルリスト（動的選定）

| スキル名              | 活用方法                 | 選定理由         |
| --------------------- | ------------------------ | ---------------- |
| react-chart-libraries | グラフコンポーネント実装 | データ可視化     |
| zustand-patterns      | ダッシュボード状態管理   | 効率的な状態管理 |
| tailwind-css-patterns | スタイリング             | 一貫したデザイン |

- **参照**: `.claude/skills/skill_list.md`

##### TDD検証: Green状態確認

```bash
pnpm --filter @repo/desktop test:run
```

- [ ] テストが成功することを確認（Green状態）

##### 完了条件

- [ ] ダッシュボードUIが実装されている
- [ ] グラフ・チャートが表示される
- [ ] フィルタ・期間選択が動作する

---

### Phase 5: リファクタリング (TDD: Refactor)

#### 目的

コード品質を改善する。

#### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:refactor packages/shared/analytics
/ai:refactor apps/desktop/src/renderer/views/AnalyticsDashboard
```

- **参照**: `.claude/commands/ai/command_list.md`

#### 使用エージェントリスト（動的選定）

- **エージェント**: @code-quality
- **選定理由**: コード品質改善に特化
- **代替候補**: @arch-police（構造改善観点）
- **参照**: `.claude/agents/agent_list.md`

#### TDD検証: 継続Green確認

```bash
pnpm test:all
```

- [ ] リファクタリング後もテストが成功することを確認

#### 完了条件

- [ ] コードの重複が削除されている
- [ ] 適切な抽象化が行われている
- [ ] テストが継続してGreen状態

---

### Phase 6: 品質保証

#### 目的

品質基準を満たすことを検証する。

#### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:lint --fix
/ai:analyze-code-quality packages/shared/analytics
/ai:security-audit analytics
```

- **参照**: `.claude/commands/ai/command_list.md`

#### 使用エージェントリスト（動的選定）

- **エージェント**: @code-quality, @sec-auditor
- **選定理由**: @code-quality は品質検証、@sec-auditor はプライバシー・セキュリティ検証
- **代替候補**: @unit-tester（テストカバレッジ観点）
- **参照**: `.claude/agents/agent_list.md`

#### 完了条件

- [ ] Lintエラーなし
- [ ] 型エラーなし
- [ ] テストカバレッジ80%以上
- [ ] セキュリティ脆弱性なし
- [ ] プライバシー要件が満たされている

---

### Phase 7: 最終レビューゲート

#### 目的

実装の総合的な品質を検証する。

#### レビュー参加エージェント（動的選定）

| エージェント  | レビュー観点               | 選定理由                       |
| ------------- | -------------------------- | ------------------------------ |
| @code-quality | コード品質                 | 実装品質の確認                 |
| @arch-police  | アーキテクチャ遵守         | 設計との整合性確認             |
| @sec-auditor  | セキュリティ・プライバシー | 個人情報保護の確認             |
| @ui-designer  | UI/UX                      | ダッシュボードの使いやすさ確認 |
| @e2e-tester   | 統合テスト                 | エンドツーエンドの動作確認     |

- **参照**: `.claude/agents/agent_list.md`

#### 完了条件

- [ ] 最終レビューがPASS
- [ ] 全ての指摘事項が対応済み
- [ ] プライバシーポリシーが更新されている

---

### Phase 8: 手動テスト検証

#### 目的

実際のユーザー操作でトラッキングとダッシュボードを確認する。

#### 手動テストケース

| No  | カテゴリ       | テスト項目                   | 前提条件             | 操作手順                 | 期待結果                               | 実行結果 | 備考 |
| --- | -------------- | ---------------------------- | -------------------- | ------------------------ | -------------------------------------- | -------- | ---- |
| 1   | イベント収集   | 画面遷移トラッキング         | アプリ起動済み       | 各画面に遷移する         | Page Viewイベントが記録される          | -        | -    |
| 2   | イベント収集   | クリックイベントトラッキング | アプリ起動済み       | ボタンをクリックする     | Clickイベントが記録される              | -        | -    |
| 3   | ダッシュボード | 画面閲覧数の表示             | イベント収集後       | ダッシュボードを開く     | 画面別の閲覧数グラフが表示される       | -        | -    |
| 4   | ダッシュボード | 期間フィルタ                 | ダッシュボード表示中 | 期間を変更する           | グラフが期間に応じて更新される         | -        | -    |
| 5   | ダッシュボード | ユーザーフロー表示           | イベント収集後       | フロー分析タブを開く     | 画面遷移のフロー図が表示される         | -        | -    |
| 6   | プライバシー   | オプトアウト機能             | 設定画面を開く       | トラッキングをオフにする | イベントが収集されなくなる             | -        | -    |
| 7   | オフライン対応 | オフライン時のバッファリング | ネットワーク切断     | アプリを操作する         | オンライン復帰後にイベントが送信される | -        | -    |

#### 完了条件

- [ ] 全手動テストケースがPASS

---

### Phase 9: ドキュメント更新

#### 目的

実装内容をドキュメントに反映する。

#### Claude Code スラッシュコマンド

> ⚠️ 以下はターミナルコマンドではなく、Claude Code内で実行するスラッシュコマンドです

```
/ai:update-all-docs
/ai:generate-api-docs packages/shared/analytics
```

- **参照**: `.claude/commands/ai/command_list.md`

#### 使用エージェントリスト（動的選定）

- **エージェント**: @spec-writer, @api-doc-writer
- **選定理由**: @spec-writer は仕様ドキュメント作成、@api-doc-writer はSDK APIドキュメント作成
- **代替候補**: @manual-writer（ユーザー向けドキュメント観点）
- **参照**: `.claude/agents/agent_list.md`

#### 完了条件

- [ ] docs/00-requirements/ 配下の関連ドキュメントが更新済み
- [ ] トラッキングSDKのAPIドキュメントが作成済み
- [ ] プライバシーポリシーが更新済み
- [ ] ダッシュボードの使用方法が記載済み

---

## 5. 完了条件チェックリスト

### 機能要件

- [ ] 画面閲覧（Page View）イベントが収集できる
- [ ] ユーザー操作（クリック等）イベントが収集できる
- [ ] セッション管理が動作する
- [ ] データがデータベースに保存される
- [ ] ダッシュボードでデータが可視化される
- [ ] 期間フィルタが動作する
- [ ] ユーザーフロー分析が表示される
- [ ] オプトアウト機能が動作する

### 品質要件

- [ ] 全テストがPASS
- [ ] Lintエラーなし
- [ ] 型エラーなし
- [ ] コードカバレッジ80%以上
- [ ] セキュリティ脆弱性なし

### プライバシー要件

- [ ] 個人情報が収集されていない
- [ ] オプトアウト機能が実装されている
- [ ] プライバシーポリシーが更新されている
- [ ] データ保存期間が設定されている

### ドキュメント要件

- [ ] 関連ドキュメントが更新済み
- [ ] SDK APIドキュメントが作成済み
- [ ] ダッシュボードの使用方法が記載済み

---

## 6. 検証方法

### テストケース

1. トラッキングSDKのユニットテスト
2. イベント送信のモックテスト
3. データベース保存のテスト
4. ダッシュボードUIのコンポーネントテスト
5. E2Eテスト（イベント収集からダッシュボード表示まで）

### 検証手順

1. 開発環境でアプリを起動
2. 各種操作を行いイベントを発生させる
3. ダッシュボードでデータが表示されることを確認
4. オプトアウト後にイベントが収集されないことを確認

---

## 7. リスクと対策

| リスク                         | 影響度 | 発生確率 | 対策                                   |
| ------------------------------ | ------ | -------- | -------------------------------------- |
| パフォーマンス低下             | 高     | 中       | バッチ送信、非同期処理の徹底           |
| プライバシー問題               | 高     | 低       | 匿名化、オプトアウト機能、法的レビュー |
| データ量の増大                 | 中     | 高       | パーティショニング、データ保存期間設定 |
| ダッシュボードのクエリ負荷     | 中     | 中       | 適切なインデックス、キャッシュ活用     |
| ネットワーク障害時のデータロス | 中     | 中       | ローカルバッファリング、リトライ機構   |

---

## 8. 参照情報

### 関連ドキュメント

- `docs/00-requirements/02-non-functional-requirements.md` - 非機能要件
- `docs/00-requirements/15-database-design.md` - データベース設計
- `docs/00-requirements/17-security-guidelines.md` - セキュリティガイドライン

### 参考資料

- [Segment Analytics Best Practices](https://segment.com/docs/)
- [GDPR対応ガイド](https://gdpr.eu/)
- [個人情報保護法ガイドライン](https://www.ppc.go.jp/)

---

## 9. 備考

### レビュー指摘の原文（該当する場合）

```
ユーザーがどの画面をよく見ているかなどのイベントごとの集計を行って、
ユーザーの操作の流れとか、そこから改善するようなデータを集めたいと思っています。
そこから新しい機能改善とかしていきたいと思っています。
UI/UXについても改善していきたいなと思っています。
```

### 補足事項

- Electronアプリでのトラッキングを想定
- プライバシーファーストの設計を重視
- 将来的に外部アナリティクスサービスとの連携も視野に入れる
- ダッシュボードは設定画面内に配置予定
