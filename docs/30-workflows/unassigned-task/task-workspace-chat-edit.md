# ワークスペースファイルのチャット編集機能 - タスク指示書

## メタ情報

| 項目             | 内容                                     |
| ---------------- | ---------------------------------------- |
| タスクID         | TASK-WS-CHAT-EDIT-001                    |
| タスク名         | ワークスペースファイルのチャット編集機能 |
| 分類             | 新規機能                                 |
| 対象機能         | ワークスペース・チャット                 |
| 優先度           | 高                                       |
| 見積もり規模     | 大規模                                   |
| ステータス       | 未実施                                   |
| 発見元           | ユーザー要望                             |
| 発見日           | 2025-12-11                               |
| 発見エージェント | .claude/agents/product-manager.md                         |

---

## 1. なぜこのタスクが必要か（Why）

### 1.1 背景

ワークスペースで開いているファイルに対して、チャットでLLMと対話しながら編集・追記できることで、AIアシスト開発の効率が大幅に向上する。ファイルのコンテキストを保持しながら、続きを書かせたり、リファクタリングを依頼したりできる。

### 1.2 問題点・課題

- ファイルの内容をチャットにコピーする必要がある
- コンテキストの維持が手動
- 生成結果をファイルに戻す作業が煩雑

### 1.3 放置した場合の影響

- AIアシスト開発の効率が低い
- ワークフローが断片化
- 競合製品と比較して機能的に劣る

---

## 2. 何を達成するか（What）

### 2.1 目的

ワークスペースで開いているファイルをチャットのコンテキストとして使用し、LLMと対話しながらファイルを編集・生成できる機能を実装する。

### 2.2 最終ゴール

- ワークスペースファイルをチャットコンテキストに追加
- ファイルの続きを書かせる機能
- ファイルの一部を選択してリファクタリング依頼
- 生成結果をファイルに直接適用
- 差分プレビュー・承認フロー

### 2.3 スコープ

#### 含むもの

**コンテキスト連携**

- 開いているファイルをチャットに添付
- 選択範囲のみを添付
- 複数ファイルの同時添付
- ファイルパスとコンテンツの自動取得

**編集指示**

- 「続きを書いて」機能
- 「この部分をリファクタリングして」機能
- 「テストを生成して」機能
- 「コメントを追加して」機能

**結果適用**

- 生成結果のプレビュー
- 差分表示（変更前/変更後）
- 承認/却下フロー
- 部分適用（選択範囲のみ）
- 直接ファイルへの書き込み

**UI/UX**

- ファイルタブからチャットへのドラッグ&ドロップ
- 右クリックメニューからの「チャットで編集」
- ショートカットキー

#### 含まないもの

- 自動コード補完（別機能）
- リアルタイム協調編集
- バージョン管理との連携

### 2.4 成果物

- ファイルコンテキスト連携ロジック
- 差分プレビューUI
- 結果適用ロジック
- 関連するユニットテスト

---

## 3. 主要な使用エージェント

- **.claude/agents/ui-designer.md**: 連携UI・差分プレビューの設計
- **.claude/agents/electron-architect.md**: ファイルシステムとチャットの連携
- **.claude/agents/logic-dev.md**: コンテキスト管理・適用ロジック
- **.claude/agents/state-manager.md**: ワークスペース・チャット状態の同期

---

## 4. 完了条件チェックリスト

- [ ] ワークスペースファイルをチャットに添付できる
- [ ] 選択範囲のみを添付できる
- [ ] 「続きを書いて」で続きが生成される
- [ ] 生成結果の差分プレビューが表示される
- [ ] 承認後にファイルに適用される
- [ ] 右クリックメニューから操作できる

---

## 5. 備考

### レビュー指摘の原文

```
ワークスペースの方で開いているファイルに対してチャットの方で続きを書かせたり、
そのチャットワークスペース側でそのLLMとのやり取りができて、
そこで成果物を追加で生成するような機能が欲しいです。
```

### 関連タスク

- TASK-CHAT-WS-EXPORT-001: チャット成果物のワークスペース連携
- TASK-RAG-CORE-001: RAGコア機能
