# MVP スコープ定義書

## 概要

本ドキュメントは、デスクトップアプリケーション MVP の機能範囲を定義する。

---

## MVP に含む機能

### 1. ファイル監視機能

| 機能             | 説明                                 |
| ---------------- | ------------------------------------ |
| ディレクトリ監視 | 指定ディレクトリのファイル変更を検知 |
| イベント検知     | add, change, unlink イベントの検知   |
| 除外パターン     | node_modules, .git 等の除外          |

### 2. データ永続化

| 機能             | 説明                                        |
| ---------------- | ------------------------------------------- |
| ワークフロー保存 | 検知したイベントを workflows テーブルに保存 |
| 実行ログ         | executions テーブルに実行履歴を保存         |
| ログ記録         | logs テーブルに詳細ログを保存               |

### 3. UI（最小構成）

| 画面             | 説明                         |
| ---------------- | ---------------------------- |
| ワークフロー一覧 | 登録されたワークフローの表示 |
| 実行ログ一覧     | 実行履歴の表示               |
| 監視制御         | 監視開始/停止ボタン          |

### 4. CI/CD

| 機能 | 説明                                          |
| ---- | --------------------------------------------- |
| CI   | push/PR 時に lint, typecheck, test を自動実行 |
| CD   | タグ作成時に macOS 向けビルド・リリース       |

---

## MVP に含まない機能（将来実装）

| 機能                        | 理由                           | 優先度 |
| --------------------------- | ------------------------------ | ------ |
| Windows/Linux ビルド        | CI コスト削減                  | 中     |
| コード署名                  | 有料証明書が必要（$99/年〜）   | 低     |
| 自動更新                    | electron-updater の運用コスト  | 低     |
| AI 連携（ワークフロー実行） | 複雑性が高い、API コストが発生 | 高     |
| Discord/LINE 連携           | 外部サービス依存               | 中     |
| クラウド同期                | バックエンド構築が必要         | 中     |
| 設定画面                    | MVP では固定設定で対応         | 中     |
| 複数ディレクトリ監視        | 単一ディレクトリで検証         | 低     |
| E2E テスト CI               | CI 時間消費が大きい            | 低     |

---

## 受け入れ基準

### AC-1: ファイル監視

```gherkin
Given アプリが起動している
When 監視対象ディレクトリにファイルを追加する
Then ファイル追加イベントが検知される
And workflows テーブルにレコードが作成される
```

### AC-2: ログ表示

```gherkin
Given ワークフローが実行された
When 実行ログ画面を表示する
Then 実行履歴が一覧表示される
And 最新のログが上部に表示される
```

### AC-3: 監視制御

```gherkin
Given アプリが起動している
When 監視開始ボタンをクリックする
Then ファイル監視が開始される
And ステータスが「監視中」に変わる

When 監視停止ボタンをクリックする
Then ファイル監視が停止される
And ステータスが「停止」に変わる
```

### AC-4: CI

```gherkin
Given コードを変更してプッシュした
When GitHub Actions が実行される
Then lint, typecheck, test が実行される
And すべて成功すると緑色のチェックマークが表示される
```

### AC-5: CD

```gherkin
Given v1.0.0 タグを作成した
When GitHub Actions が実行される
Then macOS 向けアプリがビルドされる
And GitHub Releases にアップロードされる
```

---

## 技術スコープ

### 使用技術（MVP）

| レイヤー       | 技術                     |
| -------------- | ------------------------ |
| フレームワーク | Electron + React         |
| DB             | SQLite + Drizzle ORM     |
| 状態管理       | Zustand                  |
| スタイル       | Tailwind CSS             |
| テスト         | Vitest + Testing Library |
| ビルド         | electron-builder         |
| CI/CD          | GitHub Actions           |

### 使用しない技術（将来）

| 技術             | 理由                 |
| ---------------- | -------------------- |
| Neon PostgreSQL  | クラウド連携は後回し |
| Vercel AI SDK    | AI 機能は後回し      |
| discord.js       | 外部連携は後回し     |
| Playwright（CI） | コスト削減           |
| electron-updater | 運用コスト削減       |

---

## 成功指標

| 指標             | 目標値    |
| ---------------- | --------- |
| アプリ起動時間   | 3秒以内   |
| ファイル検知遅延 | 1秒以内   |
| テストカバレッジ | 70%以上   |
| ビルドサイズ     | 100MB以下 |
| CI 実行時間      | 5分以内   |

---

## リスクと対策

| リスク                           | 対策                    |
| -------------------------------- | ----------------------- |
| SQLite 同時書き込み制限          | シングルスレッドで処理  |
| 未署名アプリの警告               | README に回避手順を記載 |
| 大量ファイル監視のパフォーマンス | 除外パターンの最適化    |
