# ワークスペースマネージャー - 機能要件定義書

## メタ情報

| 項目           | 内容         |
| -------------- | ------------ |
| ドキュメントID | FR-WS-001    |
| バージョン     | 1.0.0        |
| 作成日         | 2025-12-11   |
| 作成者         | @req-analyst |
| ステータス     | ドラフト     |
| レビュー状態   | 未レビュー   |

---

## 1. プロジェクト概要

### 1.1 目的

Mac上の任意のフォルダを複数同時に開き、ファイルツリーとして表示・編集できる「ワークスペースマネージャー」機能を実装する。VSCodeのマルチルートワークスペースに類似した機能で、複数の独立したフォルダを単一のワークスペースで管理し、RAGデータと連携した成果物生成の基盤となる。

### 1.2 スコープ

#### 含むもの

- 複数フォルダのワークスペースへの追加・削除
- フォルダの階層構造表示（ファイルツリー）
- ファイルの閲覧・編集・保存（元のファイルシステムに保存）
- ワークスペース状態の永続化（アプリ再起動後も復元）
- サイドバーUIコンポーネント

#### 含まないもの

- ファイルのコピー・移動・削除機能（将来のスコープ）
- ファイル検索機能（将来のスコープ）
- Git統合（将来のスコープ）
- RAG連携の実装（別タスク）
- クラウド同期機能（対象外）

### 1.3 ステークホルダー

| ステークホルダー | 関心事項                             |
| ---------------- | ------------------------------------ |
| エンドユーザー   | 複数フォルダの統一管理、使いやすいUI |
| 開発者           | アーキテクチャ整合性、保守性         |
| 運用者           | セキュリティ、パフォーマンス         |

---

## 2. 機能要件一覧

### 2.1 優先度サマリー

| 分類        | 件数 | 割合 |
| ----------- | ---- | ---- |
| Must have   | 6    | 46%  |
| Should have | 4    | 31%  |
| Could have  | 3    | 23%  |
| Won't have  | 0    | 0%   |

### 2.2 機能要件詳細

#### FR-001: フォルダ追加機能

| 項目         | 内容                                                        |
| ------------ | ----------------------------------------------------------- |
| ID           | FR-001                                                      |
| 名称         | フォルダ追加機能                                            |
| 優先度       | **Must have** (スコア: 18)                                  |
| 説明         | ユーザーがMac上の任意のフォルダをワークスペースに追加できる |
| ビジネス価値 | 5 (核心機能)                                                |
| 実現可能性   | 4 (Electronダイアログ使用)                                  |
| リスク       | 2 (標準的な実装)                                            |
| コスト       | 2 (1-4週間)                                                 |

**詳細要件**:

- ネイティブフォルダ選択ダイアログを表示する
- 選択されたフォルダをワークスペースに追加する
- 同一フォルダの重複追加を防止する
- 追加されたフォルダはサイドバーに表示される

---

#### FR-002: フォルダ削除機能

| 項目         | 内容                                                                 |
| ------------ | -------------------------------------------------------------------- |
| ID           | FR-002                                                               |
| 名称         | フォルダ削除機能                                                     |
| 優先度       | **Must have** (スコア: 17)                                           |
| 説明         | ユーザーがワークスペースからフォルダを削除できる（元ファイルは保持） |
| ビジネス価値 | 5 (核心機能)                                                         |
| 実現可能性   | 5 (シンプルな実装)                                                   |
| リスク       | 1 (影響なし)                                                         |
| コスト       | 1 (1週間未満)                                                        |

**詳細要件**:

- 右クリックメニューまたは削除ボタンから実行可能
- 削除前に確認ダイアログを表示する（オプション）
- ワークスペースから参照を削除するのみで、元のファイルシステムには影響しない
- 削除後、サイドバーから即座に消える

---

#### FR-003: ファイルツリー表示機能

| 項目         | 内容                                                           |
| ------------ | -------------------------------------------------------------- |
| ID           | FR-003                                                         |
| 名称         | ファイルツリー表示機能                                         |
| 優先度       | **Must have** (スコア: 19)                                     |
| 説明         | 追加されたフォルダの階層構造をサイドバーにツリー形式で表示する |
| ビジネス価値 | 5 (核心機能)                                                   |
| 実現可能性   | 5 (既存コンポーネント活用)                                     |
| リスク       | 1 (実績あり)                                                   |
| コスト       | 2 (1-4週間)                                                    |

**詳細要件**:

- 各フォルダをルートノードとして表示
- フォルダはクリックで展開/折りたたみ可能
- ファイルとフォルダを区別するアイコンを表示
- ファイル名でソートされた状態で表示
- node_modules、.git等の除外パターンに対応

---

#### FR-004: ファイル閲覧機能

| 項目         | 内容                                                           |
| ------------ | -------------------------------------------------------------- |
| ID           | FR-004                                                         |
| 名称         | ファイル閲覧機能                                               |
| 優先度       | **Must have** (スコア: 18)                                     |
| 説明         | ファイルツリーからファイルを選択し、内容をエディターで表示する |
| ビジネス価値 | 5 (核心機能)                                                   |
| 実現可能性   | 5 (既存エディター活用)                                         |
| リスク       | 1 (実績あり)                                                   |
| コスト       | 2 (1-4週間)                                                    |

**詳細要件**:

- ファイルをクリックするとエディタエリアに内容を表示
- テキストファイル（.txt, .md, .ts, .tsx, .js, .json等）に対応
- シンタックスハイライトを適用
- ファイルエンコーディングはUTF-8を基本とする
- 読み込み中はローディング状態を表示

---

#### FR-005: ファイル編集機能

| 項目         | 内容                                 |
| ------------ | ------------------------------------ |
| ID           | FR-005                               |
| 名称         | ファイル編集機能                     |
| 優先度       | **Must have** (スコア: 17)           |
| 説明         | 表示されたファイルの内容を編集できる |
| ビジネス価値 | 5 (核心機能)                         |
| 実現可能性   | 4 (既存エディター活用)               |
| リスク       | 2 (未保存状態管理が必要)             |
| コスト       | 2 (1-4週間)                          |

**詳細要件**:

- エディター内でテキストを編集可能
- 編集中（未保存）状態をタブに表示（ドット等のインジケーター）
- Undo/Redo機能をサポート
- 編集内容はメモリに保持され、保存するまでファイルには反映されない

---

#### FR-006: ファイル保存機能

| 項目         | 内容                                             |
| ------------ | ------------------------------------------------ |
| ID           | FR-006                                           |
| 名称         | ファイル保存機能                                 |
| 優先度       | **Must have** (スコア: 16)                       |
| 説明         | 編集したファイルを元のファイルシステムに保存する |
| ビジネス価値 | 5 (核心機能)                                     |
| 実現可能性   | 4 (IPC通信が必要)                                |
| リスク       | 3 (ファイル上書きの安全性)                       |
| コスト       | 2 (1-4週間)                                      |

**詳細要件**:

- Cmd+S（macOS）で保存を実行
- 保存ボタンからも実行可能
- 保存成功時は未保存インジケーターを消す
- 保存失敗時はエラーメッセージを表示
- 書き込み権限がない場合は適切なエラーを表示

---

#### FR-007: ワークスペース状態永続化

| 項目         | 内容                                             |
| ------------ | ------------------------------------------------ |
| ID           | FR-007                                           |
| 名称         | ワークスペース状態永続化                         |
| 優先度       | **Should have** (スコア: 14)                     |
| 説明         | ワークスペースの状態をアプリ再起動後も復元できる |
| ビジネス価値 | 4 (ユーザー体験向上)                             |
| 実現可能性   | 4 (electron-store使用)                           |
| リスク       | 2 (パス変更の整合性)                             |
| コスト       | 2 (1-4週間)                                      |

**詳細要件**:

- 追加されたフォルダパスの一覧を保存
- 各フォルダの展開/折りたたみ状態を保存
- 最後に選択していたファイルを保存
- アプリ起動時に前回の状態を復元
- 存在しないパスは警告を表示して除外

---

#### FR-008: フォルダ展開/折りたたみ状態の保持

| 項目         | 内容                                                  |
| ------------ | ----------------------------------------------------- |
| ID           | FR-008                                                |
| 名称         | フォルダ展開/折りたたみ状態の保持                     |
| 優先度       | **Should have** (スコア: 12)                          |
| 説明         | フォルダの展開/折りたたみ状態をセッション内で保持する |
| ビジネス価値 | 3 (UX向上)                                            |
| 実現可能性   | 5 (シンプル)                                          |
| リスク       | 1 (リスクなし)                                        |
| コスト       | 1 (1週間未満)                                         |

**詳細要件**:

- ユーザーが展開したフォルダは展開状態を維持
- 折りたたんだフォルダは折りたたみ状態を維持
- 新しく追加されたフォルダはデフォルトで折りたたみ状態

---

#### FR-009: 複数フォルダの同時表示

| 項目         | 内容                                               |
| ------------ | -------------------------------------------------- |
| ID           | FR-009                                             |
| 名称         | 複数フォルダの同時表示                             |
| 優先度       | **Should have** (スコア: 15)                       |
| 説明         | 複数の独立したフォルダを同時にサイドバーに表示する |
| ビジネス価値 | 4 (RAG連携の基盤)                                  |
| 実現可能性   | 4 (アーキテクチャ設計が必要)                       |
| リスク       | 2 (UI複雑化)                                       |
| コスト       | 3 (1-3ヶ月)                                        |

**詳細要件**:

- 各フォルダは独立したルートノードとして表示
- フォルダ間の依存関係なし
- 表示順序はドラッグ&ドロップで変更可能（Could have）
- 各フォルダの色分け表示（Could have）

---

#### FR-010: 未保存ファイルの警告

| 項目         | 内容                                                             |
| ------------ | ---------------------------------------------------------------- |
| ID           | FR-010                                                           |
| 名称         | 未保存ファイルの警告                                             |
| 優先度       | **Should have** (スコア: 13)                                     |
| 説明         | 未保存のファイルがある状態でアプリを閉じようとしたときに警告する |
| ビジネス価値 | 4 (データ保護)                                                   |
| 実現可能性   | 4 (Electron API使用)                                             |
| リスク       | 2 (実装複雑性)                                                   |
| コスト       | 2 (1-4週間)                                                      |

**詳細要件**:

- 未保存のファイルがある場合、閉じる前に確認ダイアログを表示
- 「保存して閉じる」「保存せずに閉じる」「キャンセル」の選択肢
- 複数ファイルが未保存の場合はリストで表示

---

#### FR-011: ファイルタイプアイコン表示

| 項目         | 内容                                     |
| ------------ | ---------------------------------------- |
| ID           | FR-011                                   |
| 名称         | ファイルタイプアイコン表示               |
| 優先度       | **Could have** (スコア: 8)               |
| 説明         | ファイルの種類に応じたアイコンを表示する |
| ビジネス価値 | 2 (UX向上)                               |
| 実現可能性   | 5 (シンプル)                             |
| リスク       | 1 (リスクなし)                           |
| コスト       | 1 (1週間未満)                            |

**詳細要件**:

- .ts/.tsx: TypeScriptアイコン
- .js/.jsx: JavaScriptアイコン
- .md: Markdownアイコン
- .json: JSONアイコン
- その他: 汎用ファイルアイコン
- フォルダ: フォルダアイコン

---

#### FR-012: フォルダの並べ替え

| 項目         | 内容                                             |
| ------------ | ------------------------------------------------ |
| ID           | FR-012                                           |
| 名称         | フォルダの並べ替え                               |
| 優先度       | **Could have** (スコア: 6)                       |
| 説明         | ワークスペース内のフォルダの表示順序を変更できる |
| ビジネス価値 | 2 (UX向上)                                       |
| 実現可能性   | 4 (ドラッグ&ドロップ実装)                        |
| リスク       | 2 (実装複雑性)                                   |
| コスト       | 2 (1-4週間)                                      |

**詳細要件**:

- ドラッグ&ドロップでフォルダの順序を変更
- 変更された順序は永続化される

---

#### FR-013: キーボードナビゲーション

| 項目         | 内容                                       |
| ------------ | ------------------------------------------ |
| ID           | FR-013                                     |
| 名称         | キーボードナビゲーション                   |
| 優先度       | **Could have** (スコア: 9)                 |
| 説明         | キーボードのみでファイルツリーを操作できる |
| ビジネス価値 | 3 (アクセシビリティ)                       |
| 実現可能性   | 4 (標準的な実装)                           |
| リスク       | 1 (リスクなし)                             |
| コスト       | 2 (1-4週間)                                |

**詳細要件**:

- 上下矢印キーでアイテム間を移動
- 左矢印キーでフォルダを折りたたみ
- 右矢印キーでフォルダを展開
- Enterキーでファイルを開く/フォルダを展開

---

## 3. ユースケース定義

### UC-001: フォルダをワークスペースに追加する

| 項目     | 内容                                  |
| -------- | ------------------------------------- |
| ID       | UC-001                                |
| アクター | エンドユーザー                        |
| ゴール   | Mac上のフォルダをワークスペースに追加 |
| 関連要件 | FR-001, FR-003                        |

**事前条件**:

- アプリケーションが起動している
- EditorViewが表示されている

**基本フロー**（正常系）:

1. ユーザーがサイドバーの「フォルダを追加」ボタンをクリックする
2. システムがネイティブフォルダ選択ダイアログを表示する
3. ユーザーがフォルダを選択し「開く」をクリックする
4. システムが選択されたフォルダをワークスペースに追加する
5. システムがサイドバーに新しいフォルダをツリー表示する
6. システムがワークスペース状態を永続化する

**代替フロー**:

- 3a. ユーザーがキャンセルをクリックした場合:
  - システムはダイアログを閉じ、何も変更しない

**例外フロー**:

- E1. 既に追加済みのフォルダを選択した場合:
  - システムは「このフォルダは既に追加されています」と通知する
  - フォルダは追加されない
- E2. アクセス権限がないフォルダを選択した場合:
  - システムは「このフォルダにアクセスする権限がありません」とエラーを表示する

**事後条件**:

- 選択したフォルダがサイドバーに表示されている
- フォルダパスがワークスペース状態に保存されている

---

### UC-002: ファイルを閲覧・編集・保存する

| 項目     | 内容                             |
| -------- | -------------------------------- |
| ID       | UC-002                           |
| アクター | エンドユーザー                   |
| ゴール   | ファイルを開いて編集し、保存する |
| 関連要件 | FR-004, FR-005, FR-006           |

**事前条件**:

- ワークスペースにフォルダが追加されている
- サイドバーにファイルツリーが表示されている

**基本フロー**（正常系）:

1. ユーザーがサイドバーのファイルをクリックする
2. システムがファイル内容を読み込む
3. システムがエディターにファイル内容を表示する
4. ユーザーがエディターでファイル内容を編集する
5. システムが未保存状態を示すインジケーターを表示する
6. ユーザーがCmd+Sを押す
7. システムがファイルを元の場所に保存する
8. システムが未保存インジケーターを消す
9. システムが「保存しました」と通知する

**代替フロー**:

- 4a. 編集せずに別のファイルを選択した場合:
  - システムは新しいファイルを表示する

**例外フロー**:

- E1. ファイルの読み込みに失敗した場合:
  - システムは「ファイルを読み込めませんでした」とエラーを表示する
- E2. ファイルの保存に失敗した場合:
  - システムは「ファイルを保存できませんでした: [理由]」とエラーを表示する
  - 未保存インジケーターは維持される

**事後条件**:

- ファイルが元のファイルシステムに保存されている
- エディターに保存後の内容が表示されている

---

### UC-003: ワークスペースからフォルダを削除する

| 項目     | 内容                                       |
| -------- | ------------------------------------------ |
| ID       | UC-003                                     |
| アクター | エンドユーザー                             |
| ゴール   | 不要なフォルダをワークスペースから削除する |
| 関連要件 | FR-002                                     |

**事前条件**:

- ワークスペースに1つ以上のフォルダが追加されている

**基本フロー**（正常系）:

1. ユーザーがフォルダを右クリックする
2. システムがコンテキストメニューを表示する
3. ユーザーが「ワークスペースから削除」を選択する
4. システムがフォルダをワークスペースから削除する
5. システムがサイドバーを更新する
6. システムがワークスペース状態を永続化する

**代替フロー**:

- なし

**例外フロー**:

- なし（ワークスペースからの削除は常に成功する）

**事後条件**:

- フォルダがサイドバーから削除されている
- 元のファイルシステムのフォルダは影響を受けていない

---

### UC-004: アプリ再起動後にワークスペースを復元する

| 項目     | 内容                               |
| -------- | ---------------------------------- |
| ID       | UC-004                             |
| アクター | エンドユーザー                     |
| ゴール   | 前回のワークスペース状態を復元する |
| 関連要件 | FR-007, FR-008                     |

**事前条件**:

- 以前にワークスペースにフォルダを追加している
- アプリを終了し、再起動した

**基本フロー**（正常系）:

1. ユーザーがアプリを起動する
2. システムが保存されたワークスペース状態を読み込む
3. システムが各フォルダの存在を確認する
4. システムがサイドバーにフォルダをツリー表示する
5. システムが展開/折りたたみ状態を復元する
6. システムが最後に選択していたファイルを復元する（存在する場合）

**代替フロー**:

- 3a. 一部のフォルダが存在しない場合:
  - システムは存在しないフォルダを除外する
  - システムは「以下のフォルダが見つかりませんでした」と通知する
  - 存在するフォルダのみ表示する

**例外フロー**:

- E1. ワークスペース状態ファイルが破損している場合:
  - システムは空のワークスペースで起動する
  - システムは「ワークスペースの復元に失敗しました」と通知する

**事後条件**:

- 前回のワークスペース状態が復元されている
- 存在しないフォルダはワークスペースから除外されている

---

## 4. 受け入れ基準（Given-When-Then形式）

### AC-001: フォルダ追加の受け入れ基準

**シナリオ1: 正常なフォルダ追加**

```gherkin
Given: ワークスペースが空の状態で
  And: 有効なフォルダ /Users/user/projects/my-project が存在する
When: ユーザーが「フォルダを追加」をクリックし、上記フォルダを選択する
Then: フォルダがサイドバーに表示される
  And: フォルダ内のファイル・サブフォルダがツリー表示される
  And: ワークスペース状態がlocalStorageに保存される
```

**シナリオ2: 重複フォルダの追加防止**

```gherkin
Given: /Users/user/projects/my-project がワークスペースに追加済み
When: ユーザーが同じフォルダを再度追加しようとする
Then: 「このフォルダは既に追加されています」と通知される
  And: フォルダは重複して追加されない
```

**シナリオ3: キャンセル時の動作**

```gherkin
Given: フォルダ選択ダイアログが表示されている
When: ユーザーがキャンセルをクリックする
Then: ダイアログが閉じる
  And: ワークスペースに変更はない
```

---

### AC-002: ファイル編集・保存の受け入れ基準

**シナリオ1: ファイルの正常な編集と保存**

```gherkin
Given: ファイル test.md がエディターで開かれている
  And: 元の内容は "Hello" である
When: ユーザーが内容を "Hello World" に変更する
  And: ユーザーが Cmd+S を押す
Then: ファイル test.md の内容が "Hello World" に更新される
  And: 未保存インジケーターが消える
  And: 「保存しました」と通知される
```

**シナリオ2: 未保存状態の表示**

```gherkin
Given: ファイル test.md がエディターで開かれている
  And: 保存済みの状態である
When: ユーザーが内容を変更する
Then: タブに未保存インジケーター（●）が表示される
```

**シナリオ3: 保存失敗時のエラー表示**

```gherkin
Given: ファイル readonly.md が読み取り専用である
  And: ユーザーが内容を変更した
When: ユーザーが Cmd+S を押す
Then: 「ファイルを保存できませんでした: 書き込み権限がありません」とエラーが表示される
  And: 未保存インジケーターは維持される
```

---

### AC-003: ワークスペース状態復元の受け入れ基準

**シナリオ1: 正常な状態復元**

```gherkin
Given: ワークスペースに2つのフォルダが追加されている
  And: フォルダAは展開状態、フォルダBは折りたたみ状態
  And: アプリを終了した
When: アプリを再起動する
Then: 2つのフォルダがサイドバーに表示される
  And: フォルダAは展開状態で表示される
  And: フォルダBは折りたたみ状態で表示される
```

**シナリオ2: 存在しないフォルダの除外**

```gherkin
Given: ワークスペースにフォルダ /old/path が保存されている
  And: そのフォルダが削除されている
When: アプリを起動する
Then: 「フォルダ /old/path が見つかりませんでした」と通知される
  And: そのフォルダはワークスペースから除外される
```

---

### AC-004: フォルダ削除の受け入れ基準

**シナリオ1: ワークスペースからの正常な削除**

```gherkin
Given: フォルダ /Users/user/projects がワークスペースに追加されている
When: ユーザーが該当フォルダを右クリックし「ワークスペースから削除」を選択する
Then: フォルダがサイドバーから削除される
  And: 元のフォルダ /Users/user/projects は影響を受けない
  And: ワークスペース状態が更新される
```

---

## 5. 依存関係マトリクス

| 要件ID | 依存先 | 依存理由                                   |
| ------ | ------ | ------------------------------------------ |
| FR-002 | FR-001 | フォルダが追加されていないと削除できない   |
| FR-003 | FR-001 | フォルダが追加されていないとツリー表示不可 |
| FR-004 | FR-003 | ツリーからファイルを選択する必要がある     |
| FR-005 | FR-004 | ファイルが表示されていないと編集できない   |
| FR-006 | FR-005 | 編集されていないと保存する意味がない       |
| FR-007 | FR-001 | 追加されたフォルダを永続化する             |
| FR-008 | FR-003 | ツリーの展開状態を保持する                 |
| FR-009 | FR-001 | 複数フォルダを追加する機能が前提           |
| FR-010 | FR-005 | 編集機能がないと未保存状態が発生しない     |

---

## 6. 用語集

| 用語               | 定義                                                                                 |
| ------------------ | ------------------------------------------------------------------------------------ |
| ワークスペース     | 複数のフォルダをまとめて管理する論理的なコンテナ。ファイルのコピーではなく参照を保持 |
| フォルダエントリー | ワークスペースに追加された個々のフォルダの参照情報                                   |
| ファイルツリー     | フォルダの階層構造を視覚的に表示するUI要素                                           |
| 状態永続化         | アプリ終了後も設定やデータを保持する仕組み（localStorage/electron-store使用）        |
| 未保存状態         | ファイルが編集されているが、まだディスクに保存されていない状態                       |

---

## 7. 品質検証スコア

| 指標       | スコア | 目標 |
| ---------- | ------ | ---- |
| 明確性     | 92%    | 90%  |
| 完全性     | 88%    | 85%  |
| 一貫性     | 100%   | 100% |
| 検証可能性 | 85%    | 80%  |
| 追跡可能性 | 100%   | 100% |

---

## 8. 次フェーズへの引き継ぎ事項

### 8.1 設計フェーズへの入力

- データモデル設計に必要な型定義（Workspace, FolderEntry, FileNode）
- IPC API設計に必要なチャネル定義
- UIコンポーネント設計に必要な状態管理要件

### 8.2 テストフェーズへの入力

- 受け入れ基準に基づくテストケースの作成
- 正常系・異常系・境界値のカバレッジ確保
- TDD準拠のためのテストファースト実装

### 8.3 オープンな課題

1. 大量ファイル時のパフォーマンス最適化方針
2. ファイル監視（自動リロード）の必要性
3. バイナリファイルの取り扱い方針

---

## 変更履歴

| バージョン | 日付       | 変更者       | 変更内容 |
| ---------- | ---------- | ------------ | -------- |
| 1.0.0      | 2025-12-11 | @req-analyst | 初版作成 |
