# User Profile Enhancement 手動テストガイド

## 概要

このドキュメントは、User Profile Enhancement機能の手動テスト手順を記載しています。
自動テストでは検証できないユーザー体験・UI/UXを確認するために使用します。

> **注意**: タイムゾーン・言語選択機能は将来実装予定のため、現在は日本固定です。
> 詳細: `docs/30-workflows/unassigned-task/task-locale-timezone-selection.md`

## 前提条件

- デスクトップアプリがビルド済みであること
- テスト用アカウントでログイン可能であること
- Supabaseバックエンドが稼働していること

## アプリの起動方法

```bash
pnpm --filter @repo/desktop dev
```

---

## テストケース一覧

| No  | カテゴリ     | テスト項目               | 重要度 |
| --- | ------------ | ------------------------ | ------ |
| 1   | 通知設定     | 通知ON/OFF               | 高     |
| 2   | エクスポート | プロフィールエクスポート | 高     |
| 3   | インポート   | プロフィールインポート   | 高     |
| 4   | オフライン   | オフライン時の動作       | 中     |

---

## テストNo.1: 通知ON/OFF

### 目的

通知設定のトグルが正しく動作し、設定が保存されることを確認する。

### 前提条件

- ログイン済み状態

### 操作手順

1. **設定画面を開く**
   - サイドバーまたはメニューから「設定」を選択
   - 「プロフィール設定」セクションを見つける

2. **通知セクションを確認**
   - 「通知」カードを見つける
   - 説明テキスト「通知の受け取り方を設定します」が表示されていること

3. **各トグルの初期状態を確認**
   - 以下の5つのトグルがあることを確認:
     - メール通知
     - デスクトップ通知
     - 通知音
     - ワークフロー完了
     - ワークフローエラー

4. **個別トグルを操作**
   - 「メール通知」トグルをクリック
   - ON→OFF または OFF→ON に切り替わることを確認
   - トグルのビジュアルフィードバックを確認（色の変化）
   - 他のトグルも同様にテスト

5. **一括操作ボタンをテスト**
   - 「すべて無効」ボタンをクリック
   - 全てのトグルがOFFになることを確認
   - 「すべて有効」ボタンをクリック
   - 全てのトグルがONになることを確認

6. **ボタンの無効化状態を確認**
   - 全てONの時: 「すべて有効」ボタンが無効化
   - 全てOFFの時: 「すべて無効」ボタンが無効化

7. **永続化の確認**
   - いくつかのトグルをOFFに設定
   - アプリを完全に終了（Cmd+Q / Alt+F4）
   - アプリを再起動
   - 設定画面を開き、設定が保持されていることを確認

### 期待結果

- [ ] 5つのトグルが表示される
- [ ] 各トグルが個別に操作可能
- [ ] トグル操作時にビジュアルフィードバックがある
- [ ] 一括操作ボタンが正常に動作する
- [ ] ボタンの無効化状態が適切
- [ ] アプリ再起動後も設定が保持される
- [ ] エラーメッセージが表示されない

### 実行結果

| 項目   | 結果        | 備考 |
| ------ | ----------- | ---- |
| 実行日 |             |      |
| 実行者 |             |      |
| 結果   | PASS / FAIL |      |
| 不具合 |             |      |

---

## テストNo.2: プロフィールエクスポート

### 目的

プロフィール設定をJSONファイルにエクスポートできることを確認する。

### 前提条件

- ログイン済み状態
- 通知設定がいくつか変更済み

### 操作手順

1. **設定画面を開く**
   - 「プロフィール設定」セクションを見つける
   - 「データ管理」カードを見つける

2. **エクスポートボタンを確認**
   - 「エクスポート」ボタンが表示されていること
   - 説明テキスト「プロフィール設定のエクスポート・インポート」が表示されていること
   - セキュリティ説明テキストが表示されていること
     - 「メールアドレスやアカウント情報は含まれません」

3. **エクスポートを実行**
   - 「エクスポート」ボタンをクリック
   - ファイル保存ダイアログが表示される
   - 任意の場所を選択して保存
   - デフォルトファイル名を確認（例: `profile-export-YYYY-MM-DD.json`）

4. **成功メッセージの確認**
   - 「エクスポートが完了しました」メッセージが表示される
   - 保存先パスが表示される

5. **エクスポートファイルの検証**
   - 保存されたJSONファイルを開く
   - 以下の内容が含まれていることを確認:
     ```json
     {
       "displayName": "ユーザー名",
       "timezone": "Asia/Tokyo",
       "locale": "ja",
       "notificationSettings": {
         "email": true,
         "desktop": true,
         "sound": true,
         "workflowComplete": true,
         "workflowError": true
       },
       "preferences": {},
       "exportedAt": "2024-XX-XXTXX:XX:XXZ",
       "version": "1.0"
     }
     ```

6. **機密情報の除外確認**
   - JSONファイルに以下が**含まれていない**ことを確認:
     - `id` (ユーザーID)
     - `email` (メールアドレス)
     - `plan` (プラン情報)
     - `avatarUrl` (アバターURL)

### 期待結果

- [ ] エクスポートボタンが正常に動作する
- [ ] ファイル保存ダイアログが表示される
- [ ] JSONファイルが正しくフォーマットされている
- [ ] 機密情報が含まれていない
- [ ] 成功メッセージが表示される
- [ ] 保存先パスが表示される

### 実行結果

| 項目   | 結果        | 備考 |
| ------ | ----------- | ---- |
| 実行日 |             |      |
| 実行者 |             |      |
| 結果   | PASS / FAIL |      |
| 不具合 |             |      |
| 保存先 |             |      |

---

## テストNo.3: プロフィールインポート

### 目的

エクスポートしたJSONファイルからプロフィール設定を復元できることを確認する。

### 前提条件

- ログイン済み状態
- テストNo.2でエクスポートしたファイルが存在する

### 操作手順

1. **現在の設定を変更**
   - テストNo.2と異なる設定に変更
   - 例: すべての通知をOFFに設定

2. **インポートを実行**
   - 「データ管理」カードの「インポート」ボタンをクリック
   - ファイル選択ダイアログが表示される
   - テストNo.2でエクスポートしたJSONファイルを選択

3. **インポート結果の確認**
   - 成功メッセージが表示される
   - 通知設定がエクスポート時の状態に復元される

4. **永続化の確認**
   - アプリを再起動
   - インポートした設定が保持されていることを確認

5. **不正ファイルのテスト**
   - 不正なJSONファイルを選択した場合
   - エラーメッセージが表示されることを確認
   - アプリがクラッシュしないことを確認

6. **空ファイルのテスト**
   - 空のJSONファイルを選択した場合
   - 適切なエラーメッセージが表示されることを確認

### 期待結果

- [ ] インポートボタンが正常に動作する
- [ ] ファイル選択ダイアログが表示される
- [ ] 通知設定が正しく復元される
- [ ] 成功メッセージが表示される
- [ ] 不正ファイル時にエラーハンドリングが行われる
- [ ] アプリがクラッシュしない

### 実行結果

| 項目   | 結果        | 備考 |
| ------ | ----------- | ---- |
| 実行日 |             |      |
| 実行者 |             |      |
| 結果   | PASS / FAIL |      |
| 不具合 |             |      |

---

## テストNo.4: オフライン時の動作

### 目的

ネットワーク切断時にキャッシュからデータが表示されることを確認する。

### 前提条件

- ログイン済み状態
- プロフィールデータがロード済み

### 操作手順

1. **オンライン状態で設定を確認**
   - 設定画面を開く
   - 現在の通知設定が表示されていることを確認
   - データ管理セクションが表示されていることを確認

2. **ネットワークを切断**
   - Wi-Fiをオフにする、またはネットワークケーブルを抜く
   - または開発者ツールでネットワークをオフラインに設定

3. **アプリを操作**
   - 別の画面に移動
   - 再度設定画面を開く

4. **キャッシュからの表示を確認**
   - 通知設定が表示されること
   - 「オフライン」や「接続なし」の表示がある場合は記録

5. **設定変更を試行**
   - 通知トグルを変更してみる
   - エラーメッセージまたは警告が表示されることを確認
   - アプリがクラッシュしないことを確認

6. **ネットワーク復帰後の動作**
   - ネットワークを再接続
   - 設定操作が正常に行えることを確認
   - オフライン中の変更があった場合、適切に処理されるか確認

### 期待結果

- [ ] オフライン時にキャッシュからデータが表示される
- [ ] オフライン時の変更操作で適切なエラーハンドリング
- [ ] アプリがクラッシュしない
- [ ] ネットワーク復帰後に正常動作する

### 実行結果

| 項目   | 結果        | 備考 |
| ------ | ----------- | ---- |
| 実行日 |             |      |
| 実行者 |             |      |
| 結果   | PASS / FAIL |      |
| 不具合 |             |      |

---

## テスト結果サマリー

| No  | テスト項目               | 結果 | 実行日 | 備考 |
| --- | ------------------------ | ---- | ------ | ---- |
| 1   | 通知ON/OFF               |      |        |      |
| 2   | プロフィールエクスポート |      |        |      |
| 3   | プロフィールインポート   |      |        |      |
| 4   | オフライン時の動作       |      |        |      |

## 未実装機能（将来対応予定）

以下の機能は現在日本固定で運用しており、将来実装予定です：

| 機能             | ステータス | 関連タスク                                                            |
| ---------------- | ---------- | --------------------------------------------------------------------- |
| タイムゾーン選択 | 未実装     | `docs/30-workflows/unassigned-task/task-locale-timezone-selection.md` |
| 言語選択         | 未実装     | `docs/30-workflows/unassigned-task/task-locale-timezone-selection.md` |

## 発見された不具合

| No  | 重要度 | 概要 | 再現手順 | ステータス |
| --- | ------ | ---- | -------- | ---------- |
|     |        |      |          |            |

---

## 承認

| 役割         | 名前 | 日付 | 署名 |
| ------------ | ---- | ---- | ---- |
| テスト実行者 |      |      |      |
| レビュアー   |      |      |      |
