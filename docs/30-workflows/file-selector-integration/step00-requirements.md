# Step 00: 要件定義書 - FileSelectorビュー統合

## 概要

| 項目       | 内容              |
| ---------- | ----------------- |
| タスクID   | T-00-1, T-00-2    |
| フェーズ   | Phase 0: 要件定義 |
| 作成日     | 2025-12-16        |
| ステータス | 完了              |

## 1. 配置先ビューの決定

### 1.1 調査対象ビュー

| ビュー名       | 主要機能                         | ファイル操作との関連性              |
| -------------- | -------------------------------- | ----------------------------------- |
| DashboardView  | 統計情報・アクティビティ表示     | 低 - 概要表示が目的                 |
| **EditorView** | ファイル編集・ワークスペース管理 | **高 - 既存のファイル操作機能あり** |
| ChatView       | AIチャットインターフェース       | 中 - 将来的にファイル添付の可能性   |
| GraphView      | ナレッジグラフ可視化             | 低 - グラフ表示が目的               |
| SettingsView   | アプリケーション設定             | 低 - 設定管理が目的                 |

### 1.2 決定: EditorView

**選定理由:**

1. **既存機能との整合性**
   - WorkspaceSidebarコンポーネントが既に存在
   - フォルダ追加/削除機能が実装済み（`addFolder`, `removeFolder`）
   - ファイル選択機能が実装済み（`handleFileSelect`）

2. **ユーザー体験の一貫性**
   - ファイル操作はEditorViewのコンテキスト内で完結
   - ユーザーがファイルを扱う場所として直感的

3. **技術的適合性**
   - ワークスペース状態管理が既に存在
   - IPC通信パターンが確立済み

### 1.3 統合方式

| 方式                     | 説明                       | 採用     |
| ------------------------ | -------------------------- | -------- |
| WorkspaceSidebarへの統合 | 既存サイドバーにボタン追加 | **推奨** |
| 独立モーダル             | ヘッダーからモーダル表示   | 代替案   |
| 新規パネル               | 専用パネルとして追加       | 不採用   |

**推奨方式:** WorkspaceSidebarのフォルダ追加ボタン近くに「ファイル選択」ボタンを配置

## 2. ユーザーフロー定義

### 2.1 メインフロー

```
┌─────────────────────────────────────────────────────────────────┐
│                    FileSelector ユーザーフロー                    │
└─────────────────────────────────────────────────────────────────┘

[EditorView]
     │
     ▼
┌─────────────────┐
│ WorkspaceSidebar │
│   を表示中       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐     ┌─────────────────────────────────────┐
│ 「ファイル選択」  │────▶│ FileSelectorModal が開く             │
│ ボタンをクリック │     │ - 現在のワークスペースフォルダを表示  │
└─────────────────┘     └────────────────┬────────────────────┘
                                         │
                        ┌────────────────┼────────────────┐
                        │                │                │
                        ▼                ▼                ▼
               ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
               │ フォルダ展開  │  │ ファイル選択 │  │ キャンセル   │
               │ /折りたたみ   │  │ (チェック)   │  │ ボタン      │
               └──────┬──────┘  └──────┬──────┘  └──────┬──────┘
                      │                │                │
                      ▼                ▼                ▼
               ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
               │ ツリー構造   │  │ 選択状態     │  │ モーダル     │
               │ が更新       │  │ が更新       │  │ を閉じる     │
               └─────────────┘  └──────┬──────┘  └─────────────┘
                                       │
                                       ▼
                               ┌─────────────┐
                               │ 「確定」ボタン │
                               │ をクリック    │
                               └──────┬──────┘
                                      │
                                      ▼
                        ┌─────────────────────────┐
                        │ 選択されたファイルを     │
                        │ 親コンポーネントに通知   │
                        │ (onFilesSelected)        │
                        └─────────────────────────┘
```

### 2.2 状態遷移図

```
┌──────────────────────────────────────────────────────────┐
│                   モーダル状態遷移                         │
└──────────────────────────────────────────────────────────┘

                    ┌─────────┐
         ──────────▶│  閉じた  │◀──────────
        │           │ (初期)   │          │
        │           └────┬────┘          │
        │                │                │
        │         openModal()             │
        │                │                │
        │                ▼                │
        │           ┌─────────┐           │
 closeModal()      │  開いた  │    closeModal()
   or ESC          │ (表示中) │    or 確定
        │           └────┬────┘           │
        │                │                │
        │      ┌─────────┴─────────┐      │
        │      │                   │      │
        │      ▼                   ▼      │
        │ ┌─────────┐       ┌─────────┐   │
        │ │ 選択なし │       │ 選択あり │   │
        │ │ (0件)   │◀─────▶│ (1件〜)  │   │
        │ └────┬────┘       └────┬────┘   │
        │      │                 │        │
        └──────┴─────────────────┴────────┘
```

### 2.3 インタラクション詳細

| アクション         | トリガー                              | 結果                                     |
| ------------------ | ------------------------------------- | ---------------------------------------- |
| モーダルを開く     | 「ファイル選択」ボタンクリック        | FileSelectorModalが表示される            |
| フォルダ展開       | フォルダアイコンクリック              | 子要素が表示される                       |
| フォルダ折りたたみ | 展開済みフォルダアイコンクリック      | 子要素が非表示になる                     |
| ファイル選択       | チェックボックスクリック              | 選択状態がトグルされる                   |
| 全選択             | 「すべて選択」ボタン                  | 表示中のファイルが全選択される           |
| 選択解除           | 「選択解除」ボタン                    | すべての選択が解除される                 |
| 確定               | 「確定」ボタンクリック                | 選択ファイルが通知され、モーダルが閉じる |
| キャンセル         | 「キャンセル」ボタン/ESC/背景クリック | モーダルが閉じる（変更破棄）             |

## 3. 機能要件

### 3.1 必須機能 (P0)

| ID   | 機能         | 説明                                           |
| ---- | ------------ | ---------------------------------------------- |
| F-01 | モーダル表示 | FileSelectorをモーダルで表示できる             |
| F-02 | ファイル選択 | ワークスペース内のファイルを選択できる         |
| F-03 | 選択確定     | 選択したファイルを親コンポーネントに通知できる |
| F-04 | キャンセル   | 選択をキャンセルしてモーダルを閉じられる       |

### 3.2 推奨機能 (P1)

| ID   | 機能                    | 説明                           |
| ---- | ----------------------- | ------------------------------ |
| F-05 | 複数選択                | 複数ファイルを一度に選択できる |
| F-06 | フォルダ展開/折りたたみ | フォルダ構造をナビゲートできる |
| F-07 | 選択カウント表示        | 現在の選択件数を表示する       |
| F-08 | キーボード操作          | ESCでモーダルを閉じられる      |

### 3.3 将来機能 (P2)

| ID   | 機能                     | 説明                           |
| ---- | ------------------------ | ------------------------------ |
| F-09 | 検索/フィルター          | ファイル名で検索できる         |
| F-10 | ファイルタイプフィルター | 拡張子でフィルタリングできる   |
| F-11 | 最近使用したファイル     | 最近選択したファイルを表示する |

## 4. 非機能要件

### 4.1 パフォーマンス

| 項目                   | 要件                              |
| ---------------------- | --------------------------------- |
| モーダル表示           | 100ms以内に表示開始               |
| ファイルツリー読み込み | 1000ファイル以下で500ms以内       |
| 選択操作               | 16ms以内のレスポンス（60fps維持） |

### 4.2 アクセシビリティ

| 項目               | 要件                             |
| ------------------ | -------------------------------- |
| キーボード操作     | Tab/Shift+Tab, Enter, Escape対応 |
| スクリーンリーダー | 適切なARIAラベル                 |
| フォーカス管理     | モーダル内でフォーカストラップ   |

### 4.3 レスポンシブ

| 画面サイズ                | 動作                          |
| ------------------------- | ----------------------------- |
| デスクトップ (1024px+)    | 中央配置モーダル、最大幅600px |
| タブレット (768px-1023px) | 中央配置モーダル、最大幅90%   |
| モバイル (767px以下)      | フルスクリーンモーダル        |

## 5. 受け入れ条件

### 5.1 Phase 0 完了条件

- [x] 配置先ビューが決定されている（EditorView）
- [x] ユーザーフローが定義されている
- [x] 機能要件が優先度付きで整理されている
- [x] 非機能要件が定義されている

### 5.2 全体完了条件

- [ ] FileSelectorModalコンポーネントが実装されている
- [ ] EditorViewにトリガーボタンが配置されている
- [ ] useFileSelectorModalフックが実装されている
- [ ] 単体テストがパスしている
- [ ] E2Eテストがパスしている
- [ ] アクセシビリティ要件を満たしている

## 6. 技術スタック

| 項目           | 技術                                       |
| -------------- | ------------------------------------------ |
| フレームワーク | React 18                                   |
| 状態管理       | Zustand (useAppStore)                      |
| スタイリング   | Tailwind CSS                               |
| コンポーネント | 既存のGlassPanel, Button, Checkbox等を活用 |
| テスト         | Vitest + React Testing Library             |
| E2E            | Playwright                                 |

## 7. 関連ドキュメント

- [タスク仕様書](./task-file-selector-integration.md)
- [FileSelector実装](../../../apps/desktop/src/renderer/components/organisms/FileSelector/)
- [EditorView](../../../apps/desktop/src/renderer/views/EditorView/)

---

**次のステップ:** Phase 1: 設計 (T-01-1, T-01-2)
