# プロジェクト概要

> 本ドキュメントは統合システム設計仕様書の一部です。
> マスタードキュメント: [master_system_design.md](./master_system_design.md)

---

## 1.1 システムの目的

クラウド環境（Next.js）とローカル環境（PC）をシームレスに統合し、チャットツール（Discord）やファイル操作をトリガーとして、あらゆる業務プロセス（議事録作成、動画要約、データ変換など）を自動実行する「中央司令塔」システムを構築する。

### デスクトップアプリケーションの目的

| 機能               | 説明                                                                |
| ------------------ | ------------------------------------------------------------------- |
| ログ収集・可視化   | Macローカル環境で発生するログ情報を自動収集し、データベースに永続化 |
| 成果物生成         | 収集したログ情報を基に、レポート、グラフ、統計情報などを自動生成    |
| オフライン対応     | インターネット接続がない環境でもログ収集と基本的な分析が可能        |
| リアルタイム監視   | ローカル環境の状態をリアルタイムでモニタリングし、異常検知時に通知  |
| 成果物エクスポート | 生成した成果物をPDF、CSV、JSON等の形式でエクスポート可能            |

### 個人開発における設計方針

本プロジェクトは個人開発を前提としており、以下の方針を重視する。

| 方針       | 説明                                             |
| ---------- | ------------------------------------------------ |
| 変更容易性 | 要件変更に柔軟に対応できる設計                   |
| 低コスト   | 無料枠を最大限活用し、必要に応じてスケールアップ |
| シンプルさ | 過度な抽象化を避け、理解しやすい構造を維持       |
| 段階的拡張 | MVPから始めて徐々に機能を追加                    |

---

## 1.2 設計の核心概念

### Hybrid Architecture（ハイブリッド構成）

| 処理場所            | 役割                                             |
| ------------------- | ------------------------------------------------ |
| クラウド（Railway） | AI処理、データ管理、API提供、Discord Bot         |
| ローカル（PC）      | ファイル監視、ローカルアプリ連携、オフライン処理 |

**メリット**:

- 重い処理はクラウドに任せ、ローカルリソースを節約
- オフライン時でもローカル機能は継続動作
- Cloudflare等のエッジ配信による高速レスポンス

### Infinite Extensibility（無限の拡張性）

| 手法           | 説明                                                                  |
| -------------- | --------------------------------------------------------------------- |
| JSONB活用      | ワークフローの入出力をJSONB型で保存し、スキーマ変更なしで新機能に対応 |
| プラグイン構造 | 機能追加は独立したフォルダ作成のみで完結                              |
| 機能間独立     | 各機能は相互依存せず、削除・追加が容易                                |

### Specification-Driven（仕様駆動）

| 要素       | 説明                                                        |
| ---------- | ----------------------------------------------------------- |
| 正本       | ソースコードではなく仕様書（Markdown）を正本とする          |
| 実装フロー | AIアシスタント（Claude Code）が仕様書を読み込んで実装を行う |
| 変更管理   | 仕様書の変更が実装の変更を駆動する                          |

---

## 1.3 対象ユーザー

| ユーザー種別           | 説明                                  | 主な操作                            |
| ---------------------- | ------------------------------------- | ----------------------------------- |
| 開発者（自分）         | 機能プラグインを追加実装する者        | コード編集、仕様書作成              |
| エンドユーザー（自分） | Discord経由でワークフローを実行する者 | Discord操作、デスクトップアプリ使用 |

**注記**: 個人開発のため、開発者とエンドユーザーは同一人物を想定する。将来的に他者への公開を行う場合は、認証・認可の設計を見直す。

---

## 1.4 スコープ定義

### スコープ内（In Scope）

**クラウド機能**:

| 機能                 | 技術                                            |
| -------------------- | ----------------------------------------------- |
| ワークフローエンジン | Next.js 15（App Router）                        |
| データ永続化         | Turso（libSQL）                                 |
| AI処理               | Vercel AI SDK（OpenAI, Anthropic, Google, xAI） |
| チャット連携         | Discord Bot                                     |
| デプロイ             | Railway                                         |

**デスクトップ機能**:

| 機能               | 技術                              |
| ------------------ | --------------------------------- |
| デスクトップアプリ | Electron                          |
| ローカルDB         | SQLite（Turso Embedded Replicas） |
| ファイル監視       | Local Agent（Node.js）            |
| クラウド同期       | Turso Embedded Replicas           |

**対応プラットフォーム**:

- macOS（主要ターゲット）
- Windows（将来対応）

### スコープ外（Out of Scope）

| 項目                       | 理由               |
| -------------------------- | ------------------ |
| モバイルアプリケーション   | 開発リソースの制約 |
| リアルタイム協調編集       | 個人利用のため不要 |
| 独自AIモデルのトレーニング | コストと複雑性     |
| オンプレミスデプロイメント | 個人開発では不要   |
| LINE連携                   | MVP後の将来機能    |

---

## 1.5 アーキテクチャ原則

| 原則                 | 説明                                                          | 適用場面           |
| -------------------- | ------------------------------------------------------------- | ------------------ |
| Clean Architecture   | 依存関係は外から内へ（Infrastructure → Application → Domain） | レイヤー設計       |
| Event-driven         | 非同期処理、疎結合なサービス連携                              | ワークフロー実行   |
| Specification-Driven | 仕様書を正とし、実装はその変換結果                            | 開発フロー         |
| Fault Tolerance      | 障害を前提とした設計（リトライ、フォールバック）              | エラーハンドリング |
| TDD                  | すべての機能追加はテスト記述から着手                          | 開発プラクティス   |

### 各原則の実践方法

**Clean Architecture**:

- packages/shared/core/は外部依存ゼロ
- 依存の方向を常に内側（ドメイン）に向ける
- ESLintプラグインで依存違反を検出

**Event-driven**:

- ワークフロー状態の遷移をイベントとして扱う
- 疎結合を維持し、機能間の独立性を確保
- 将来的なメッセージキュー導入を考慮した設計

**Fault Tolerance**:

- すべての外部通信にタイムアウトを設定
- リトライ可能なエラーとそうでないエラーを区別
- オフライン時のフォールバック動作を定義

---

## 1.6 成功基準

### MVP（Minimum Viable Product）

| 基準                          | 目標                                       |
| ----------------------------- | ------------------------------------------ |
| Discord経由のワークフロー実行 | 1種類以上のワークフローが動作              |
| ログ収集・表示                | デスクトップアプリでログが閲覧可能         |
| オフライン動作                | インターネット未接続時もローカル機能が動作 |
| デプロイ                      | Railway上で安定稼働                        |

### 将来目標

| 段階    | 目標                          |
| ------- | ----------------------------- |
| Phase 2 | 5種類以上のワークフロー対応   |
| Phase 3 | 成果物自動生成（PDF、グラフ） |
| Phase 4 | Windows対応                   |

---

## 関連ドキュメント

- [非機能要件](./02-non-functional-requirements.md)
- [テクノロジースタック](./03-technology-stack.md)
- [ディレクトリ構造](./04-directory-structure.md)
- [アーキテクチャ設計](./05-architecture.md)
