# 統合システム設計仕様書：Universal AI Workflow Orchestrator

> **マスタードキュメント**

> 本ドキュメントはAIワークフローオーケストレーターの統合設計仕様書です。
> 各セクションの詳細は分離されたドキュメントを参照してください。

---

## 目次

### 基本設計

| セクション              | ドキュメント                                                             | 概要                                                                           |
| ----------------------- | ------------------------------------------------------------------------ | ------------------------------------------------------------------------------ |
| 1. プロジェクト概要     | [01-overview.md](./01-overview.md)                                       | システムの目的、設計の核心概念、対象ユーザー、スコープ定義、アーキテクチャ原則 |
| 2. 非機能要件           | [02-non-functional-requirements.md](./02-non-functional-requirements.md) | 認証、暗号化、ロギング、ストレージ、テスト戦略、デスクトップアプリ要件         |
| 3. テクノロジースタック | [03-technology-stack.md](./03-technology-stack.md)                       | 技術選定基準、フレームワーク、データベース、AI、UI、テスト                     |
| 4. ディレクトリ構造     | [04-directory-structure.md](./04-directory-structure.md)                 | モノレポ構成、変数記法、依存関係ルール、機能追加手順                           |

### アーキテクチャ

| セクション            | ドキュメント                               | 概要                                                                     |
| --------------------- | ------------------------------------------ | ------------------------------------------------------------------------ |
| 5. アーキテクチャ設計 | [05-architecture.md](./05-architecture.md) | モノレポアーキテクチャ、Clean Architecture、オフライン対応、セキュリティ |

### インターフェース仕様

| セクション              | ドキュメント                                     | 概要                                                                                 |
| ----------------------- | ------------------------------------------------ | ------------------------------------------------------------------------------------ |
| 6. コアインターフェース | [06-core-interfaces.md](./06-core-interfaces.md) | IWorkflowExecutor、IRepository、IAIClient、IFileWatcher、Result型、Logger            |
| 7. エラーハンドリング   | [07-error-handling.md](./07-error-handling.md)   | エラー分類、エラーコード、リトライ戦略、サーキットブレーカー、エラーレスポンス形式   |
| 8. REST API 設計        | [08-api-design.md](./08-api-design.md)           | RESTful原則、バージョニング、HTTPステータス、ページネーション、認証、Local Agent API |

### 外部連携

| セクション              | ドキュメント                             | 概要                                                                         |
| ----------------------- | ---------------------------------------- | ---------------------------------------------------------------------------- |
| 9. ローカルエージェント | [09-local-agent.md](./09-local-agent.md) | ファイル監視、クラウド同期、オフライン対応、Turso Embedded Replicas、PM2設定 |
| 10. Discord Bot         | [10-discord-bot.md](./10-discord-bot.md) | イベントハンドリング、スラッシュコマンド、メッセージ解析、レート制限、OAuth2 |

### 開発ガイド

| セクション               | ドキュメント                                                             | 概要                                                                    |
| ------------------------ | ------------------------------------------------------------------------ | ----------------------------------------------------------------------- |
| 11. プラグイン開発       | [11-plugin-development.md](./11-plugin-development.md)                   | 追加フロー、IWorkflowExecutor実装、スキーマ定義、テスト、チェックリスト |
| 14. タスク実行仕様書生成 | [14-task-workflow-specification.md](./14-task-workflow-specification.md) | フェーズ構造、コマンド・エージェント・スキル選定、出力テンプレート      |

### 運用

| セクション         | ドキュメント                                                 | 概要                                                       |
| ------------------ | ------------------------------------------------------------ | ---------------------------------------------------------- |
| 12. デプロイメント | [12-deployment.md](./12-deployment.md)                       | Railway自動デプロイ、GitHub Actions、品質ゲート            |
| 13. 環境変数       | [13-environment-variables.md](./13-environment-variables.md) | Cloud環境変数、Local Agent環境変数、Turso設定、Railway CLI |

### データベース

| セクション           | ドキュメント                                     | 概要                                                                              |
| -------------------- | ------------------------------------------------ | --------------------------------------------------------------------------------- |
| 15. データベース設計 | [15-database-design.md](./15-database-design.md) | Turso + libSQL、Drizzle ORM、スキーマ設計、RAG全文検索（FTS5）、Embedded Replicas |

### Electron デスクトップアプリ

| セクション             | ドキュメント                                       | 概要                                                                                   |
| ---------------------- | -------------------------------------------------- | -------------------------------------------------------------------------------------- |
| 16. UI/UX ガイドライン | [16-ui-ux-guidelines.md](./16-ui-ux-guidelines.md) | Design Tokens、Apple HIG準拠、コンポーネント設計、Portal実装パターン、アクセシビリティ |

### セキュリティ

| セクション                   | ドキュメント                                             | 概要                                                                        |
| ---------------------------- | -------------------------------------------------------- | --------------------------------------------------------------------------- |
| 17. セキュリティガイドライン | [17-security-guidelines.md](./17-security-guidelines.md) | 認証、データ保護、入力検証、API保護、Electronセキュリティ、インシデント対応 |

### 付録

| セクション | ドキュメント                       | 概要                     |
| ---------- | ---------------------------------- | ------------------------ |
| 99. 用語集 | [99-glossary.md](./99-glossary.md) | 用語定義、参考資料リンク |

---

## クイックリファレンス

### システムの目的

クラウド環境（Next.js）とローカル環境（PC）をシームレスに統合し、チャットツール（Discord/LINE）やファイル操作をトリガーとして、あらゆる業務プロセス（議事録作成、動画要約、データ変換など）を自動実行する「中央司令塔」システム。

### 設計の核心概念

| 概念                   | 説明                                                         |
| ---------------------- | ------------------------------------------------------------ |
| Hybrid Architecture    | 重いAI処理はクラウド、ファイル監視・オフライン処理はローカル |
| Infinite Extensibility | JSON活用でDB変更不要、プラグイン追加で機能拡張               |
| Specification-Driven   | 仕様書（Markdown）を正本とし、AIアシスタントが実装           |
| Offline-First          | Turso Embedded ReplicasによるローカルDB同期                  |

### 主要技術スタック

| カテゴリ       | 技術                                                |
| -------------- | --------------------------------------------------- |
| フレームワーク | Next.js 15.x (App Router), Electron                 |
| データベース   | Turso + libSQL (Cloud), Embedded Replicas (Desktop) |
| ORM            | Drizzle ORM                                         |
| AI             | Vercel AI SDK (OpenAI, Anthropic, Google, xAI)      |
| UI             | React 19.x, Tailwind CSS, shadcn/ui                 |
| テスト         | Vitest, Playwright, React Testing Library           |
| デプロイ       | Railway, GitHub Actions                             |

### アーキテクチャ原則

| 原則                 | 説明                                               |
| -------------------- | -------------------------------------------------- |
| Clean Architecture   | 依存関係は外から内へ、コアは外部に依存しない       |
| Event-driven         | 非同期処理、疎結合、スケーラビリティ               |
| Specification-Driven | 仕様書を正、実装はその変換結果                     |
| Fault Tolerance      | 障害を前提とした設計、グレースフルデグラデーション |
| TDD                  | テストを先に書いてから実装                         |
| Offline-First        | ネットワーク切断時も動作継続                       |

### 個人開発における設計指針

| 指針           | 説明                                            |
| -------------- | ----------------------------------------------- |
| シンプルさ優先 | 過度な抽象化を避け、理解しやすい設計を維持      |
| 段階的拡張     | MVP時点では必要最小限から開始し、徐々に機能追加 |
| 変更容易性     | 要件変更に柔軟に対応できる構造                  |
| 自己文書化     | コードと仕様書の一貫性を維持                    |

### AIプロバイダー連携

| プロバイダー | 主要モデル               | 用途                             |
| ------------ | ------------------------ | -------------------------------- |
| OpenAI       | GPT-4、DALL-E、Whisper   | テキスト生成、画像生成、音声認識 |
| Anthropic    | Claude 3.5 Sonnet、Haiku | テキスト生成、コード補助         |
| Google AI    | Gemini Pro、Gemini Flash | テキスト生成、マルチモーダル     |
| xAI          | Grok-2、Grok-2-mini      | テキスト生成                     |

**APIキー管理方式**:

| 環境           | ストレージ                            | 暗号化方式         |
| -------------- | ------------------------------------- | ------------------ |
| デスクトップ   | Electron safeStorage + electron-store | OSキーチェーン連携 |
| クラウド（DB） | Turso api_keys テーブル               | AES-256-GCM        |

---

## ドキュメント管理

### 編集ガイドライン

| ルール                 | 説明                                       |
| ---------------------- | ------------------------------------------ |
| Single Source of Truth | 各情報は1箇所にのみ記載                    |
| 相対パスリンク         | ドキュメント間の参照は相対パスを使用       |
| コード禁止             | 仕様は言葉、表、図で記述（実装はAIに委譲） |
| 変更追跡               | 重要な変更は更新履歴に記録                 |
| テーブル形式           | 情報はテーブルで整理し、視認性を高める     |

---

## 関連リソース

| リソース     | 説明                   |
| ------------ | ---------------------- |
| リポジトリ   | GitHub（プライベート） |
| デプロイ環境 | Railway                |
| データベース | Turso                  |
| CI/CD        | GitHub Actions         |
