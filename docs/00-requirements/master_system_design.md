# 統合システム設計仕様書：Universal AI Workflow Orchestrator

> **マスタードキュメント**

> 本ドキュメントはAIワークフローオーケストレーターの統合設計仕様書です。
> 各セクションの詳細は分離されたドキュメントを参照してください。

---

## 目次

### 基本設計

| セクション              | ドキュメント                                                             | 概要                                                                           |
| ----------------------- | ------------------------------------------------------------------------ | ------------------------------------------------------------------------------ |
| 1. プロジェクト概要     | [01-overview.md](./01-overview.md)                                       | システムの目的、設計の核心概念、対象ユーザー、スコープ定義、アーキテクチャ原則 |
| 2. 非機能要件           | [02-non-functional-requirements.md](./02-non-functional-requirements.md) | 認証、暗号化、ロギング、ストレージ、テスト戦略、デスクトップアプリ要件         |
| 3. テクノロジースタック | [03-technology-stack.md](./03-technology-stack.md)                       | 選定基準、パッケージ管理、フレームワーク、データベース、AI、UI、テスト         |
| 4. ディレクトリ構造     | [04-directory-structure.md](./04-directory-structure.md)                 | モノレポ構成、変数記法、依存関係ルール、機能追加手順                           |

### アーキテクチャ

| セクション            | ドキュメント                               | 概要                                                            |
| --------------------- | ------------------------------------------ | --------------------------------------------------------------- |
| 5. アーキテクチャ設計 | [05-architecture.md](./05-architecture.md) | モノレポアーキテクチャ、データベース設計原則、workflowsテーブル |

### インターフェース仕様

| セクション              | ドキュメント                                     | 概要                                                                 |
| ----------------------- | ------------------------------------------------ | -------------------------------------------------------------------- |
| 6. コアインターフェース | [06-core-interfaces.md](./06-core-interfaces.md) | IWorkflowExecutor、IRepository、ExecutionContext                     |
| 7. エラーハンドリング   | [07-error-handling.md](./07-error-handling.md)   | エラー分類、リトライ戦略、サーキットブレーカー、エラーレスポンス形式 |
| 8. REST API 設計        | [08-api-design.md](./08-api-design.md)           | RESTful原則、バージョニング、HTTPステータス、ページネーション、認証  |

### 外部連携

| セクション              | ドキュメント                             | 概要                                                                 |
| ----------------------- | ---------------------------------------- | -------------------------------------------------------------------- |
| 9. ローカルエージェント | [09-local-agent.md](./09-local-agent.md) | ファイル監視、設定項目、PM2設定                                      |
| 10. Discord Bot         | [10-discord-bot.md](./10-discord-bot.md) | イベントハンドリング、スラッシュコマンド、メッセージ解析、レート制限 |

### 開発ガイド

| セクション         | ドキュメント                                           | 概要                                                           |
| ------------------ | ------------------------------------------------------ | -------------------------------------------------------------- |
| 11. プラグイン開発 | [11-plugin-development.md](./11-plugin-development.md) | 追加フロー、ファイル構成、共通インフラ使用方法、チェックリスト |
| 14. タスク実行仕様書生成 | [14-task-workflow-specification.md](./14-task-workflow-specification.md) | フェーズ構造、コマンド・エージェント・スキル選定、出力テンプレート |

### 運用

| セクション         | ドキュメント                                                 | 概要                                            |
| ------------------ | ------------------------------------------------------------ | ----------------------------------------------- |
| 12. デプロイメント | [12-deployment.md](./12-deployment.md)                       | Railway自動デプロイ、GitHub Actions、品質ゲート |
| 13. 環境変数       | [13-environment-variables.md](./13-environment-variables.md) | Cloud環境変数、Local Agent環境変数、Railway CLI |

### 付録

| セクション | ドキュメント                       | 概要                     |
| ---------- | ---------------------------------- | ------------------------ |
| 99. 用語集 | [99-glossary.md](./99-glossary.md) | 用語定義、参考資料リンク |

---

## クイックリファレンス

### システムの目的

クラウド環境（Next.js）とローカル環境（PC）をシームレスに統合し、チャットツール（Discord/LINE）やファイル操作をトリガーとして、あらゆる業務プロセス（議事録作成、動画要約、データ変換など）を自動実行する「中央司令塔」システム。

### 設計の核心概念

1. **Hybrid Architecture**: 重いAI処理はクラウド、ファイル監視はローカル
2. **Infinite Extensibility**: JSONB活用でDB変更不要、プラグイン追加で機能拡張
3. **Specification-Driven**: 仕様書（Markdown）を正本とし、AIアシスタントが実装

### 主要技術スタック

| カテゴリ       | 技術                                           |
| -------------- | ---------------------------------------------- |
| フレームワーク | Next.js 15.x (App Router), Electron            |
| データベース   | Neon PostgreSQL (Cloud), SQLite (Desktop)      |
| ORM            | Drizzle ORM                                    |
| AI             | Vercel AI SDK (OpenAI, Anthropic, Google, xAI) |
| UI             | React 18.x, Tailwind CSS, shadcn/ui            |
| テスト         | Vitest, Playwright, React Testing Library      |
| デプロイ       | Railway, GitHub Actions                        |

### アーキテクチャ原則

| 原則                 | 説明                           |
| -------------------- | ------------------------------ |
| Clean Architecture   | 依存関係は外から内へ           |
| Event-driven         | 非同期処理、疎結合             |
| Specification-Driven | 仕様書を正、実装はその変換結果 |
| Fault Tolerance      | 障害を前提とした設計           |
| TDD                  | テストを先に書いてから実装     |

---

## ドキュメント管理

### 更新履歴

| 日付       | バージョン | 変更内容                 |
| ---------- | ---------- | ------------------------ |
| 2025-12-04 | 2.0.0      | ドキュメント分離、索引化 |

### 編集ガイドライン

1. **Single Source of Truth**: 各情報は1箇所にのみ記載
2. **相対パスリンク**: ドキュメント間の参照は相対パスを使用
3. **具体的コード禁止**: 仕様は言葉、表、図で記述（実装はAIに委譲）
4. **変更追跡**: 重要な変更は更新履歴に記録

---

## 関連リソース

- **リポジトリ**: GitHub（プライベート）
- **デプロイ環境**: Railway
- **データベース**: Neon PostgreSQL
- **CI/CD**: GitHub Actions
