# Skill作成とエージェント改修完全ガイド

このドキュメントは、既存エージェントからSkillを分離・作成し、エージェントを軽量化するための完全な手順をまとめたものです。

---

## 目的

- エージェント定義からSkill関連の知識を分離する
- 必要十分な情報を持つSkillを作成する
- エージェントとSkillの重複を排除し、エージェントを軽量化する
- エージェントはSkillを参照する形で機能を保持する

---

## 参照ドキュメント

以下の参照資料は、スキル作成やエージェント軽量化の全体的な指針・設計を検討する際に用いるものです。これらを基にしてスキル構造や設計案を理解し、実際のタスクやアクション実行は行わず、知識参照・設計準拠の判断用途に限定します。
（※本ガイドでは、スキル作成等の実行主体として`.claude/agents/skill-librarian.md`エージェントが自律的にタスク実行することは想定していません）

### ナレッジ情報
- **Skillsガイド**: `.claude/prompt/ナレッジ_Claude_Code_skills_ガイド.md`
  - Skillの構造、設計原則、ベストプラクティス等の知識を網羅
  - Progressive Disclosure アーキテクチャの概要
  - スキル活性化の最適化手法

### プロジェクト概要
- **システム設計仕様書**: `docs/00-requirements/master_system_design.md`
  - 実装予定システムの全体仕様
  - Universal AI Workflow Orchestrator の設計ポイント
  - アーキテクチャ設計・テクノロジースタック

### 既存Skill一覧
- **Skill一覧**: `.claude/skills/skill_list.md`
  - 既存Skillの索引と概要
  - 各Skill間の関連性

### プロンプトフォーマット
- **エージェントプロンプトフォーマット**: `.claude/prompt/prompt_format.yaml`
  - エージェント定義に関するYAMLフォーマット基本仕様
  - メタデータ、ドメイン定義、インフラストラクチャ定義等
  - エージェント定義とオーケストレーション層の手引き

---

## 対象エージェント

### 修正対象エージェント
- **ファイルパス**: `.claude/agents/skill-librarian.md`
- **エージェント名**: `@skill-librarian`
- **役割**: Skill管理とSkill作成支援

**修正内容**:
- エージェント内に記述されているSkill関連の知識・手順を分離
- 分離した内容をSkillとして独立させる
- エージェント本体は軽量化し、Skillを参照する形に変更
- 重複した内容を完全に排除

---

## Skill作成要件

### 基本原則

#### 1. 必要十分な情報
- 過不足なく、該当Skillに必要な情報のみを記載
- 余分な情報は含めない
- 不足している情報がないことを確認

#### 2. 重複排除
- エージェントとSkillで同じ内容を二重に記述しない
- 詳細な知識・手順はSkillに集約
- エージェントは役割と参照のみ

#### 3. 参照関係
- エージェントはSkillを参照する形で機能を保持
- 参照パスを明確に記載
- 参照方法を具体的に示す

#### 4. 抽象度の調整
- サンプルコードに引っ張られすぎないよう、概念要素を中心に記述
- 具体例は最小限に抑える
- 原則と実践方法を明確に分離

#### 5. AI委譲
- 具体的な技術選定はAIに委ねる
- 方向性と概念の認識ズレがないよう記述
- チェックリスト形式で判断基準を提供
- AIが最適な選択をできるよう導く

---

### Skill構成要素

#### 1. メタデータ（YAML Frontmatter）

```yaml
---
name: {{skill-identifier}}
  # 形式: kebab-case
  # 制約: 最大64文字
  # 例: "excel-pivot-table-generator", "react-component-generator"
  # 命名規則: [domain]-[action]-[object]

description: |
  {{スキルの概要（1-2文）}}
  # メイン機能を簡潔に説明

  専門分野:
  - {{領域1}}: {{詳細}}
  - {{領域2}}: {{詳細}}

  適用場面:
  - {{主要な適用場面1}}
  - {{主要な適用場面2}}

  使用タイミング:
  - {{トリガー条件1}}
  - {{トリガー条件2}}

  Use proactively when {{プロアクティブ条件}}.
  # Claudeが自動的にこのSkillを起動すべき条件

version: {{version}}
  # 形式: セマンティックバージョニング（major.minor.patch）
  # 例: "1.0.0", "2.1.0"
  # オプション（省略可能）
---
```

**記載項目の詳細**:

- **name（必須）**:
  - kebab-case形式の識別子
  - 最大64文字
  - 命名規則: [domain]-[action]-[object]
  - 例: `excel-pivot-table-generator`, `api-error-handler`

- **description（必須・最重要）**:
  - メイン機能（1-2文）
  - 専門分野の列挙
  - 適用場面の明確化
  - 使用タイミング/トリガー条件
  - プロアクティブ指示
  - 制約: メタデータとして最大200文字 + 本文で詳細化可能
  - **重要**: Claudeがこのフィールドを見てSkillを自動選択する

- **version（オプション）**:
  - セマンティックバージョニング
  - 形式: major.minor.patch
  - 変更追跡と互換性管理に使用

#### 2. 概要セクション

```markdown
# {{Skill Name}}

## 概要

{{このSkillが解決する問題}}
- 問題の背景
- 現状の課題
- このSkillによる解決方法

{{提供する価値}}
- ユーザーへの価値
- 効率化の度合い
- 品質向上の効果
```

**記載内容**:
- このSkillが解決する具体的な問題
- 提供する価値の明確化
- 適用場面の詳細説明

#### 3. リソース構造

```markdown
## リソース構造

```
{{skill-name}}/
├── SKILL.md                    # エントリーポイント（概要と目次）
├── resources/                  # リファレンス文書
│   ├── getting-started.md      # 初心者向けガイド
│   ├── advanced-usage.md       # 上級者向けガイド
│   ├── troubleshooting.md      # トラブルシューティング
│   └── api-reference.md        # API リファレンス
├── scripts/                    # 実行可能スクリプト
│   ├── setup.py                # セットアップスクリプト
│   ├── execute.py              # 実行スクリプト
│   └── cleanup.py              # クリーンアップスクリプト
├── templates/                  # テンプレートファイル
│   ├── config.template.yaml    # 設定テンプレート
│   └── report.template.md      # レポートテンプレート
└── assets/                     # 静的アセット
    ├── schema.json             # JSONスキーマ
    └── sample-data.csv         # サンプルデータ
```

### リソース種別

#### documents (resources/)
- `{{document-1}}.md`: {{用途1の説明}}
  - 対象: {{対象ユーザー}}
  - 内容: {{含まれる情報}}
- `{{document-2}}.md`: {{用途2の説明}}
  - 対象: {{対象ユーザー}}
  - 内容: {{含まれる情報}}
- `{{document-N}}.md`: {{用途Nの説明}}
  - 対象: {{対象ユーザー}}
  - 内容: {{含まれる情報}}

**使用パターン**:
```bash
Read resources/{{document-name}}.md
```

#### scripts (scripts/)
- `{{script-1}}.py`: {{用途1の説明}}
  - 実行: `python scripts/{{script-1}}.py {{arguments}}`
  - 入力: {{入力形式}}
  - 出力: {{出力形式}}
- `{{script-2}}.py`: {{用途2の説明}}
  - 実行: `python scripts/{{script-2}}.py {{arguments}}`
  - 入力: {{入力形式}}
  - 出力: {{出力形式}}
- `{{script-N}}.sh`: {{用途Nの説明}}
  - 実行: `bash scripts/{{script-N}}.sh {{arguments}}`
  - 入力: {{入力形式}}
  - 出力: {{出力形式}}

**使用パターン**:
```bash
Bash: {{execution-command}}
```

#### templates (templates/)
- `{{template-1}}.yaml`: {{用途1の説明}}
  - 用途: {{使用場面}}
  - 出力先: `{{output-path-1}}`
- `{{template-2}}.md`: {{用途2の説明}}
  - 用途: {{使用場面}}
  - 出力先: `{{output-path-2}}`
- `{{template-N}}.{{ext}}`: {{用途Nの説明}}
  - 用途: {{使用場面}}
  - 出力先: `{{output-path-N}}`

**使用パターン**:
```bash
Read templates/{{template-name}}.{{ext}}
# テンプレートを読み込み、変数を置換
Write {{output-path}}
```

#### assets (assets/)
- `{{asset-1}}.json`: {{用途1の説明}}
  - 内容: {{データ構造}}
  - 用途: {{使用場面}}
- `{{asset-2}}.csv`: {{用途2の説明}}
  - 内容: {{データ構造}}
  - 用途: {{使用場面}}
- `{{asset-N}}.{{ext}}`: {{用途Nの説明}}
  - 内容: {{データ構造}}
  - 用途: {{使用場面}}

**使用パターン**:
```bash
Read assets/{{asset-name}}.{{ext}}
```
```

**記載内容**:
- ディレクトリ構造の全体像
- 各リソース種別の説明
- ファイルごとの用途と使用方法
- 使用パターンの具体例

#### 4. 実行パターン

```markdown
## 実行パターン

### {{パターン名1}}

**目的**: {{このパターンの目的}}

**前提条件**:
- {{前提条件1}}
- {{前提条件2}}

**実行手順**:
```bash
# ステップ1: {{ステップ1の説明}}
Read resources/{{doc}}.md

# ステップ2: {{ステップ2の説明}}
Bash: {{setup-command}}

# ステップ3: {{ステップ3の説明}}
Read templates/{{template}}.{{ext}}

# ステップ4: {{ステップ4の説明}}
Write {{output}}

# ステップ5: {{ステップ5の説明}}
Bash: {{execute-command}}

# ステップ6: {{ステップ6の説明}}
Bash: {{cleanup-command}}
```

**期待される結果**:
- {{期待される結果1}}
- {{期待される結果2}}

### {{パターン名2}}

**目的**: {{このパターンの目的}}

**前提条件**:
- {{前提条件1}}
- {{前提条件2}}

**実行手順**:
```bash
# ステップ1: {{ステップ1の説明}}
Read resources/{{doc-1}}.md

# ステップ2: {{ステップ2の説明}}
Read resources/{{doc-2}}.md

# ステップ3: {{ステップ3の説明}}
Read assets/{{asset}}.{{ext}}

# ステップ4: {{ステップ4の説明}}
Bash: {{validation-command}}

# ステップ5: {{ステップ5の説明}}
Bash: {{execute-command}}
```

**期待される結果**:
- {{期待される結果1}}
- {{期待される結果2}}

### {{パターン名3}}

**目的**: {{このパターンの目的}}

**前提条件**:
- {{前提条件1}}

**実行手順**:
```bash
# ステップ1: {{ステップ1の説明}}
Read resources/{{troubleshooting-doc}}.md

# ステップ2: {{ステップ2の説明}}
Bash: {{debug-command}}

# ステップ3: {{ステップ3の説明}}
Read {{log-path}}

# ステップ4: {{ステップ4の説明}}
Bash: {{fix-command}}
```

**期待される結果**:
- {{期待される結果1}}
```

**記載内容**:
- 各実行パターンの目的
- 前提条件
- ステップバイステップの実行手順
- 各ステップの説明
- 期待される結果

#### 5. 核心概念

```markdown
## 核心概念

### {{概念1}}

**定義**:
{{概念1の定義}}

**原則**:
- {{原則1-1}}: {{説明}}
- {{原則1-2}}: {{説明}}
- {{原則1-N}}: {{説明}}

**実践**:
- {{実践方法1-1}}
  - 手順: {{具体的手順}}
  - 例: {{具体例}}
- {{実践方法1-2}}
  - 手順: {{具体的手順}}
  - 例: {{具体例}}

**リソース**: `resources/{{concept-1-doc}}.md`

**関連概念**:
- {{関連概念1}}
- {{関連概念2}}

### {{概念2}}

**定義**:
{{概念2の定義}}

**原則**:
- {{原則2-1}}: {{説明}}
- {{原則2-2}}: {{説明}}

**実践**:
- {{実践方法2-1}}
  - 手順: {{具体的手順}}
  - 例: {{具体例}}
- {{実践方法2-2}}
  - 手順: {{具体的手順}}
  - 例: {{具体例}}

**リソース**: `{{resource-type}}/{{concept-2-resource}}.{{ext}}`

**関連概念**:
- {{関連概念1}}

### {{概念N}}

**定義**:
{{概念Nの定義}}

**原則**:
- {{原則N-1}}: {{説明}}
- {{原則N-2}}: {{説明}}

**実践**:
- {{実践方法N-1}}
  - 手順: {{具体的手順}}
  - 例: {{具体例}}

**リソース**: `{{resource-path}}`

**関連概念**:
- {{関連概念1}}
- {{関連概念2}}
```

**記載内容**:
- 各概念の明確な定義
- 原則（Principles）の列挙
- 実践方法（Practice）の具体化
- 関連リソースへの参照
- 関連概念との関係性

#### 6. 適用場面

```markdown
## 適用場面

### {{場面1}}

**トリガー**:
- {{トリガー条件1-1}}
- {{トリガー条件1-2}}
- {{トリガー条件1-N}}

**状況**:
{{この場面が発生する状況の詳細}}

**対応**:
- {{対応1-1}}
  - 目的: {{目的}}
  - 手順: {{手順}}
- {{対応1-2}}
  - 目的: {{目的}}
  - 手順: {{手順}}

**リソース**: `{{resource-path-1}}`

**実行**:
```bash
{{execution-pattern-1}}
```

**期待される成果**:
- {{成果1}}
- {{成果2}}

### {{場面2}}

**トリガー**:
- {{トリガー条件2-1}}
- {{トリガー条件2-2}}

**状況**:
{{この場面が発生する状況の詳細}}

**対応**:
- {{対応2-1}}
  - 目的: {{目的}}
  - 手順: {{手順}}
- {{対応2-2}}
  - 目的: {{目的}}
  - 手順: {{手順}}

**リソース**: `{{resource-path-2}}`

**実行**:
```bash
{{execution-pattern-2}}
```

**期待される成果**:
- {{成果1}}
- {{成果2}}

### {{場面N}}

**トリガー**:
- {{トリガー条件N-1}}

**状況**:
{{この場面が発生する状況の詳細}}

**対応**:
- {{対応N-1}}
  - 目的: {{目的}}
  - 手順: {{手順}}

**リソース**: `{{resource-path-N}}`

**実行**:
```bash
{{execution-pattern-N}}
```

**期待される成果**:
- {{成果1}}
```

**記載内容**:
- トリガー条件の明確化
- 発生状況の説明
- 対応手順の詳細
- 使用リソース
- 実行パターン
- 期待される成果

#### 7. 判断基準

```markdown
## 判断基準

### {{カテゴリ1}}

**目的**: {{このカテゴリの判断目的}}

**基準**:

- [ ] {{判断項目1-1}}
  - 説明: {{判断基準の詳細}}
  - リソース: `{{resource-1-1}}`
  - 実行: `{{command-1-1}}`
  - 期待値: {{期待される結果}}
  - 不合格時: {{不合格時の対応}}

- [ ] {{判断項目1-2}}
  - 説明: {{判断基準の詳細}}
  - リソース: `{{resource-1-2}}`
  - 期待値: {{期待される結果}}
  - 不合格時: {{不合格時の対応}}

- [ ] {{判断項目1-N}}
  - 説明: {{判断基準の詳細}}
  - 期待値: {{期待される結果}}
  - 不合格時: {{不合格時の対応}}

### {{カテゴリ2}}

**目的**: {{このカテゴリの判断目的}}

**基準**:

- [ ] {{判断項目2-1}}
  - 説明: {{判断基準の詳細}}
  - リソース: `{{resource-2-1}}`
  - 期待値: {{期待される結果}}
  - 不合格時: {{不合格時の対応}}

- [ ] {{判断項目2-2}}
  - 説明: {{判断基準の詳細}}
  - 実行: `{{command-2-2}}`
  - 期待値: {{期待される結果}}
  - 不合格時: {{不合格時の対応}}

### {{カテゴリN}}

**目的**: {{このカテゴリの判断目的}}

**基準**:

- [ ] {{判断項目N-1}}
  - 説明: {{判断基準の詳細}}
  - 期待値: {{期待される結果}}
  - 不合格時: {{不合格時の対応}}

- [ ] {{判断項目N-2}}
  - 説明: {{判断基準の詳細}}
  - 期待値: {{期待される結果}}
  - 不合格時: {{不合格時の対応}}
```

**記載内容**:
- カテゴリごとの判断目的
- チェックリスト形式の判断基準
- 各判断項目の詳細説明
- 使用リソースと実行コマンド
- 期待値と不合格時の対応

#### 8. 統合パターン

```markdown
## 統合パターン

### {{統合対象1}}

**統合の目的**:
{{なぜこの統合が必要か}}

**原則**:
- {{統合原則1-1}}: {{説明}}
- {{統合原則1-2}}: {{説明}}

**方法**:
- {{統合方法1-1}}
  - 手順: {{具体的手順}}
  - 注意点: {{注意すべきポイント}}
- {{統合方法1-2}}
  - 手順: {{具体的手順}}
  - 注意点: {{注意すべきポイント}}

**実装**:
```bash
{{integration-command-1}}
```

**リソース**: `{{integration-resource-1}}`

**統合後の確認事項**:
- [ ] {{確認項目1}}
- [ ] {{確認項目2}}

### {{統合対象2}}

**統合の目的**:
{{なぜこの統合が必要か}}

**原則**:
- {{統合原則2-1}}: {{説明}}
- {{統合原則2-2}}: {{説明}}

**方法**:
- {{統合方法2-1}}
  - 手順: {{具体的手順}}
  - 注意点: {{注意すべきポイント}}

**実装**:
```bash
Read templates/{{integration-template-2}}.{{ext}}
# テンプレートを読み込み、統合設定を生成
Write {{integration-output-2}}
```

**リソース**: `{{integration-resource-2}}`

**統合後の確認事項**:
- [ ] {{確認項目1}}
- [ ] {{確認項目2}}

### {{統合対象N}}

**統合の目的**:
{{なぜこの統合が必要か}}

**原則**:
- {{統合原則N-1}}: {{説明}}

**方法**:
- {{統合方法N-1}}
  - 手順: {{具体的手順}}
  - 注意点: {{注意すべきポイント}}

**実装**:
```bash
{{integration-command-N}}
```

**リソース**: `{{integration-resource-N}}`

**統合後の確認事項**:
- [ ] {{確認項目1}}
```

**記載内容**:
- 統合の目的と理由
- 統合原則
- 統合方法の詳細
- 実装パターン
- 関連リソース
- 統合後の確認事項

#### 9. メトリクス

```markdown
## メトリクス

### {{メトリクス1}}

**カテゴリ**: {{メトリクスのカテゴリ（パフォーマンス、品質、効率性等）}}

**定義**:
{{メトリクス定義1}}

**測定方法**:
```bash
{{metric-collection-command-1}}
```

**測定頻度**: {{測定頻度（リアルタイム、日次、週次等）}}

**基準値**:
- 最小値: {{minimum}}
- 目標値: {{target}}
- 最大値: {{maximum}}

**用途**:
- {{用途1-1}}: {{詳細説明}}
- {{用途1-2}}: {{詳細説明}}

**リソース**: `{{metric-resource-1}}`

**アクション**:
- 基準値未満の場合: {{対応アクション}}
- 目標値達成時: {{対応アクション}}

### {{メトリクス2}}

**カテゴリ**: {{メトリクスのカテゴリ}}

**定義**:
{{メトリクス定義2}}

**測定方法**:
```bash
{{metric-collection-command-2}}
```

**測定頻度**: {{測定頻度}}

**基準値**:
- 最小値: {{minimum}}
- 目標値: {{target}}
- 最大値: {{maximum}}

**用途**:
- {{用途2-1}}: {{詳細説明}}

**リソース**: `{{metric-resource-2}}`

**アクション**:
- 基準値未満の場合: {{対応アクション}}
- 目標値達成時: {{対応アクション}}

### {{メトリクスN}}

**カテゴリ**: {{メトリクスのカテゴリ}}

**定義**:
{{メトリクス定義N}}

**測定方法**:
```bash
{{metric-collection-command-N}}
```

**測定頻度**: {{測定頻度}}

**基準値**:
- 最小値: {{minimum}}
- 目標値: {{target}}

**用途**:
- {{用途N-1}}: {{詳細説明}}

**リソース**: `{{metric-resource-N}}`

**アクション**:
- 基準値未満の場合: {{対応アクション}}
```

**記載内容**:
- メトリクスのカテゴリ
- 明確な定義
- 測定方法とコマンド
- 測定頻度
- 基準値（最小、目標、最大）
- 用途と活用方法
- 基準値に応じたアクション

#### 10. エラーハンドリング

```markdown
## エラーハンドリング

### {{エラー1}}

**エラーコード**: {{ERROR_CODE_1}}

**症状**:
- {{症状1-1}}
- {{症状1-2}}

**原因**:
- {{原因1-1}}: {{詳細説明}}
- {{原因1-2}}: {{詳細説明}}

**対応手順**:
```bash
# ステップ1: エラー診断ガイドを確認
Read resources/{{error-doc-1}}.md

# ステップ2: 診断コマンド実行
Bash: {{error-handling-command-1}}

# ステップ3: ログ確認
Read {{error-log-path-1}}

# ステップ4: 修復実行
Bash: {{recovery-command-1}}
```

**予防策**:
- {{予防策1-1}}
- {{予防策1-2}}

**リソース**: `resources/{{error-doc-1}}.md`

### {{エラー2}}

**エラーコード**: {{ERROR_CODE_2}}

**症状**:
- {{症状2-1}}
- {{症状2-2}}

**原因**:
- {{原因2-1}}: {{詳細説明}}

**対応手順**:
```bash
# ステップ1: リカバリーコマンド実行
Bash: {{recovery-command-2}}

# ステップ2: 検証
Bash: {{validation-command-2}}
```

**予防策**:
- {{予防策2-1}}

**リソース**: `resources/{{error-doc-2}}.md`

### {{エラーN}}

**エラーコード**: {{ERROR_CODE_N}}

**症状**:
- {{症状N-1}}

**原因**:
- {{原因N-1}}: {{詳細説明}}
- {{原因N-2}}: {{詳細説明}}

**対応手順**:
- {{対応手順N-1}}
  - 詳細: {{詳細説明}}
  - コマンド: `{{command}}`
- {{対応手順N-2}}
  - 詳細: {{詳細説明}}

**予防策**:
- {{予防策N-1}}
- {{予防策N-2}}

**リソース**: `{{error-resource-N}}`

### 一般的なエラー対応フロー

```bash
# ステップ1: エラーログ収集
Read {{log-path}}

# ステップ2: エラーコード特定
Bash: grep "ERROR" {{log-path}}

# ステップ3: 該当エラードキュメント参照
Read resources/error-{{error-code}}.md

# ステップ4: 対応実行
Bash: {{recovery-command}}

# ステップ5: 検証
Bash: {{validation-command}}
```
```

**記載内容**:
- エラーコードの定義
- 症状の詳細
- 原因の特定
- 対応手順のステップバイステップ
- 予防策
- リソースへの参照
- 一般的な対応フロー

#### 11. 参考文献

```markdown
## 参考文献

### {{カテゴリ1}}（例：基礎理論）

- **{{文献1-1}}** - {{著者1-1}}
  - 出版年: {{year}}
  - 概要: {{概要}}
  - 得られる知識: {{得られる知識1-1}}
  - 適用方法: {{このSkillでの適用方法}}
  - リソース: `{{reference-resource-1-1}}`
  - 参照章: {{章番号}}

- **{{文献1-2}}** - {{著者1-2}}
  - 出版年: {{year}}
  - 概要: {{概要}}
  - 得られる知識: {{得られる知識1-2}}
  - 適用方法: {{このSkillでの適用方法}}
  - リソース: `{{reference-resource-1-2}}`
  - 参照章: {{章番号}}

### {{カテゴリ2}}（例：実践ガイド）

- **{{文献2-1}}** - {{著者2-1}}
  - 出版年: {{year}}
  - 概要: {{概要}}
  - 得られる知識: {{得られる知識2-1}}
  - 適用方法: {{このSkillでの適用方法}}
  - リソース: `{{reference-resource-2-1}}`
  - 参照章: {{章番号}}

### {{カテゴリ3}}（例：オンラインリソース）

- **{{文献3-1}}** - {{著者3-1}}
  - URL: {{url}}
  - 最終確認日: {{date}}
  - 概要: {{概要}}
  - 得られる知識: {{得られる知識3-1}}
  - 適用方法: {{このSkillでの適用方法}}

### {{カテゴリN}}（例：関連ツール・フレームワーク）

- **{{文献N-1}}** - {{著者N-1}}
  - バージョン: {{version}}
  - 公式ドキュメント: {{url}}
  - 概要: {{概要}}
  - 得られる知識: {{得られる知識N-1}}
  - 適用方法: {{このSkillでの適用方法}}
  - リソース: `{{reference-resource-N-1}}`
```

**記載内容**:
- カテゴリ別に整理
- 文献の基本情報（著者、出版年、URL等）
- 得られる知識の明確化
- このSkillでの適用方法
- 関連リソースへの参照
- 参照すべき章や節の指定

#### 12. 使用上の注意

```markdown
## 使用上の注意

### 一般的な注意事項

- **{{注意事項1}}**
  - 詳細: {{詳細説明}}
  - 理由: {{なぜこの注意が必要か}}
  - 違反時の影響: {{影響の説明}}

- **{{注意事項2}}**
  - 詳細: {{詳細説明}}
  - 理由: {{なぜこの注意が必要か}}
  - 違反時の影響: {{影響の説明}}

- **{{注意事項3}}**
  - 詳細: {{詳細説明}}
  - 理由: {{なぜこの注意が必要か}}
  - 違反時の影響: {{影響の説明}}

### セキュリティ関連

- **{{セキュリティ注意事項1}}**
  - リスク: {{リスクの説明}}
  - 対策: {{対策方法}}

- **{{セキュリティ注意事項2}}**
  - リスク: {{リスクの説明}}
  - 対策: {{対策方法}}

### パフォーマンス関連

- **{{パフォーマンス注意事項1}}**
  - 影響: {{パフォーマンスへの影響}}
  - 推奨: {{推奨される使用方法}}

- **{{パフォーマンス注意事項2}}**
  - 影響: {{パフォーマンスへの影響}}
  - 推奨: {{推奨される使用方法}}

### 互換性関連

- **{{互換性注意事項1}}**
  - 対象: {{対象環境・バージョン}}
  - 制限: {{制限事項}}
  - 回避策: {{回避策}}

### 制限事項

- **{{制限事項1}}**
  - 内容: {{制限の詳細}}
  - 理由: {{なぜこの制限があるか}}
  - 代替案: {{代替案がある場合}}

- **{{制限事項N}}**
  - 内容: {{制限の詳細}}
  - 理由: {{なぜこの制限があるか}}
  - 代替案: {{代替案がある場合}}
```

**記載内容**:
- 一般的な注意事項
- セキュリティ関連の注意
- パフォーマンス関連の注意
- 互換性の注意
- 制限事項
- それぞれの理由と影響
- 対策や回避策

#### 13. 変更履歴

```markdown
## 変更履歴

| バージョン | 日付 | 変更内容 | 変更者 | 影響範囲 |
|------------|------|----------|--------|----------|
| {{version}} | {{YYYY-MM-DD}} | {{changes}} | {{author}} | {{impact}} |

### 詳細な変更内容

#### v{{version}} ({{YYYY-MM-DD}})

**追加**:
- {{追加機能1}}: {{詳細説明}}
- {{追加機能2}}: {{詳細説明}}

**変更**:
- {{変更内容1}}: {{詳細説明}}
- {{変更内容2}}: {{詳細説明}}

**修正**:
- {{修正内容1}}: {{詳細説明}}
- {{修正内容2}}: {{詳細説明}}

**削除**:
- {{削除内容1}}: {{詳細説明}}

**非推奨**:
- {{非推奨機能1}}: {{代替手段}}

**破壊的変更**:
- {{破壊的変更1}}: {{移行ガイド}}

**影響範囲**:
- {{影響を受けるコンポーネント}}
- {{影響を受けるユーザー}}

**移行ガイド**:
```bash
# 旧バージョンからの移行手順
{{migration-steps}}
```

#### v{{previous-version}} ({{YYYY-MM-DD}})

**追加**:
- {{追加機能1}}: {{詳細説明}}

**変更**:
- {{変更内容1}}: {{詳細説明}}

**修正**:
- {{修正内容1}}: {{詳細説明}}
```

**記載内容**:
- バージョン番号と日付
- 変更内容の概要
- 変更者
- 影響範囲
- 詳細な変更内容（追加、変更、修正、削除、非推奨、破壊的変更）
- 移行ガイド

---

## Skill作成手順

### ステップ1: エージェント内容の分析

**目的**:
エージェント定義から分離すべきSkill関連の知識を特定する

**実行内容**:

1. **エージェントファイルの読み込み**
   ```bash
   Read .claude/agents/skill-librarian.md
   ```

2. **Skill関連内容の特定**
   - Skillの作成方法に関する知識
   - Skillの構造に関する説明
   - Skillの設計原則
   - 実行パターンや手順
   - リソース管理の方法
   - エラーハンドリングの方法

3. **分離すべき内容のリストアップ**
   - [ ] Skillの構造に関する知識
   - [ ] Progressive Disclosure の実装方法
   - [ ] リソースファイルの配置規則
   - [ ] 実行パターンの定義
   - [ ] メタデータの記述方法
   - [ ] 強制評価フックの設定
   - [ ] その他のSkill固有知識

4. **エージェントに残すべき内容の特定**
   - エージェントの役割と責務
   - エージェントの起動条件
   - 他エージェントとの連携
   - Skillへの参照方法

**成果物**:
- 分離すべき内容のリスト
- エージェントに残す内容のリスト

**確認事項**:
- [ ] エージェント全体を読み込んで理解した
- [ ] Skill関連の知識を網羅的に特定した
- [ ] 重複なく分離できることを確認した

---

### ステップ2: Skill対象の決定

**目的**:
作成すべきSkillを特定し、名前と識別子を決定する

**実行内容**:

1. **既存Skill一覧の確認**
   ```bash
   Read .claude/skills/skill_list.md
   ```

2. **Skill識別子の決定**
   - 命名規則: `[domain]-[action]-[object]`
   - kebab-case形式
   - 最大64文字
   - 例: `skill-creation-methodology`, `agent-skill-separation`

3. **Skillの概要記述**
   - 1-2文でメイン機能を説明
   - 専門分野を明確化
   - 適用場面を列挙
   - プロアクティブ条件を定義

4. **バージョンの決定**
   - 初版: `1.0.0`
   - セマンティックバージョニングに従う

**入力情報**:
```
Skill名: {{skill-name}}
識別子: {{skill-identifier}}
概要: {{スキルの概要記述}}
バージョン: {{version}}
```

**成果物**:
- Skill名と識別子
- Skillの概要記述
- バージョン番号

**確認事項**:
- [ ] 既存Skillと重複していない
- [ ] 命名規則に従っている
- [ ] 概要が明確で具体的である
- [ ] プロアクティブ条件が適切である

---

### ステップ3: Skillディレクトリ構造の作成

**目的**:
Skillのディレクトリ構造を作成し、リソースを配置する準備をする

**実行内容**:

1. **メインディレクトリの作成**
   ```bash
   Bash: mkdir -p .claude/skills/{{skill-identifier}}
   ```

2. **サブディレクトリの作成（必要に応じて）**
   ```bash
   Bash: mkdir -p .claude/skills/{{skill-identifier}}/resources
   Bash: mkdir -p .claude/skills/{{skill-identifier}}/scripts
   Bash: mkdir -p .claude/skills/{{skill-identifier}}/templates
   Bash: mkdir -p .claude/skills/{{skill-identifier}}/assets
   ```

3. **ディレクトリ構造の確認**
   ```bash
   Bash: tree .claude/skills/{{skill-identifier}}
   ```

**期待される構造**:
```
.claude/skills/{{skill-identifier}}/
├── SKILL.md                    # 次のステップで作成
├── resources/                  # リファレンス文書用
├── scripts/                    # 実行スクリプト用
├── templates/                  # テンプレート用
└── assets/                     # 静的アセット用
```

**成果物**:
- Skillディレクトリ構造

**確認事項**:
- [ ] メインディレクトリが作成された
- [ ] 必要なサブディレクトリが作成された
- [ ] ディレクトリ構造が正しい

---

### ステップ4: SKILL.mdの作成

**目的**:
Skillのエントリーポイントとなる SKILL.md を作成する

**実行内容**:

1. **ナレッジガイドの参照**
   ```bash
   Read .claude/prompt/ナレッジ_Claude_Code_skills_ガイド.md
   ```

2. **システム設計仕様書の参照**
   ```bash
   Read docs/00-requirements/master_system_design.md
   ```

3. **SKILL.mdの作成**
   - 出力テンプレートに従って記述
   - エージェントから分離した知識を統合
   - 抽象度を調整（概念要素中心）
   - AIに技術選定を委ねる形で記述

4. **各セクションの記述**
   - メタデータ（YAML Frontmatter）
   - 概要
   - リソース構造
   - 実行パターン
   - 核心概念
   - 適用場面
   - 判断基準
   - 統合パターン
   - メトリクス
   - エラーハンドリング
   - 参考文献
   - 使用上の注意
   - 変更履歴

**出力先**:
```
.claude/skills/{{skill-identifier}}/SKILL.md
```

**記述ルール**:
- サンプルコードは最小限に
- 概念要素を中心に記述
- チェックリスト形式で判断基準を提供
- 具体的な技術選定はAIに委ねる
- 方向性と概念の認識ズレがないよう記述

**成果物**:
- `.claude/skills/{{skill-identifier}}/SKILL.md`

**確認事項**:
- [ ] 出力テンプレートの全セクションを記述した
- [ ] メタデータが正しく記述されている
- [ ] description が効果的である
- [ ] リソース構造が明確である
- [ ] 実行パターンが具体的である
- [ ] 核心概念が明確である
- [ ] 判断基準がチェックリスト形式である
- [ ] 抽象度が適切である

---

### ステップ5: リソースファイルの作成

**目的**:
SKILL.mdから参照されるリソースファイルを作成する

**実行内容**:

1. **必要なリソースファイルの特定**
   - SKILL.mdで参照しているファイル
   - エージェントから分離した詳細知識
   - 実行スクリプト
   - テンプレートファイル
   - アセットファイル

2. **ドキュメントファイルの作成（resources/）**
   ```bash
   Write .claude/skills/{{skill-identifier}}/resources/{{document-name}}.md
   ```
   - getting-started.md: 初心者向けガイド
   - advanced-usage.md: 上級者向けガイド
   - troubleshooting.md: トラブルシューティング
   - api-reference.md: APIリファレンス
   - その他必要なドキュメント

3. **スクリプトファイルの作成（scripts/）**
   ```bash
   Write .claude/skills/{{skill-identifier}}/scripts/{{script-name}}.py
   Bash: chmod +x .claude/skills/{{skill-identifier}}/scripts/{{script-name}}.py
   ```
   - setup.py: セットアップスクリプト
   - execute.py: 実行スクリプト
   - cleanup.py: クリーンアップスクリプト
   - その他必要なスクリプト

4. **テンプレートファイルの作成（templates/）**
   ```bash
   Write .claude/skills/{{skill-identifier}}/templates/{{template-name}}.yaml
   ```
   - config.template.yaml: 設定テンプレート
   - report.template.md: レポートテンプレート
   - その他必要なテンプレート

5. **アセットファイルの作成（assets/）**
   ```bash
   Write .claude/skills/{{skill-identifier}}/assets/{{asset-name}}.json
   ```
   - schema.json: JSONスキーマ
   - sample-data.csv: サンプルデータ
   - その他必要なアセット

**作成対象**:
- **ドキュメント**: `.md`形式
- **スクリプト**: `.py`, `.sh`等の実行可能ファイル
- **テンプレート**: `.yaml`, `.md`等
- **アセット**: `.json`, `.csv`等

**成果物**:
- 各種リソースファイル

**確認事項**:
- [ ] SKILL.mdで参照しているファイルをすべて作成した
- [ ] スクリプトに実行権限を付与した
- [ ] ファイル内容が適切である
- [ ] ファイル配置が正しい

---

### ステップ6: エージェント本体の修正

**目的**:
エージェント定義からSkillに分離した内容を削除し、Skillへの参照を追加する

**実行内容**:

1. **エージェントファイルの読み込み**
   ```bash
   Read .claude/agents/skill-librarian.md
   ```

2. **Skill関連内容の削除**
   - Skillの構造に関する詳細説明を削除
   - Progressive Disclosure の実装方法を削除
   - リソースファイルの配置規則を削除
   - 実行パターンの詳細を削除
   - メタデータの記述方法の詳細を削除
   - その他Skillに移動した内容を削除

3. **Skillへの参照の追加**
   ```markdown
   ## Skill管理

   詳細なSkill作成方法とベストプラクティスは以下のSkillを参照:
   - `.claude/skills/{{skill-identifier}}/SKILL.md`

   ### Skillの構造

   Skillの詳細な構造については上記のSkillを参照してください。

   ### 実行パターン

   実行パターンの詳細については上記のSkillを参照してください。
   ```

4. **エージェントの役割の明確化**
   - エージェントの役割と責務を簡潔に記述
   - Skillとの関係を明確化
   - 他エージェントとの連携を記述

5. **エージェントファイルの更新**
   ```bash
   Edit .claude/agents/skill-librarian.md
   ```

**修正対象ファイル**:
```
.claude/agents/skill-librarian.md
```

**修正内容**:
- Skill関連の詳細説明を削除
- Skillへの参照を追加
- エージェントの役割を明確化
- 軽量化された内容に更新

**修正ルール**:
- エージェントとSkillで重複した内容を持たない
- エージェントは役割・責務・使用方法のみを記載
- 具体的な知識・手順はSkillに委譲
- 参照パスを明確に記載

**成果物**:
- 修正された `.claude/agents/skill-librarian.md`

**確認事項**:
- [ ] Skill関連の詳細を削除した
- [ ] Skillへの参照を追加した
- [ ] エージェントの役割が明確である
- [ ] 重複がない
- [ ] 参照パスが正しい

---

### ステップ7: 検証

**目的**:
作成したSkillとエージェントの品質を確認する

**実行内容**:

1. **重複チェック**
   - エージェントとSkillで同じ内容が記述されていないか確認
   - 重複がある場合は削除

2. **参照チェック**
   - エージェントからSkillへの参照が正しいか確認
   - 参照パスが正確か確認
   - リンク切れがないか確認

3. **Skillの完全性チェック**
   - 必要十分な情報が含まれているか確認
   - 出力テンプレートのすべてのセクションが記述されているか確認
   - リソースファイルがすべて作成されているか確認

4. **Skillメタデータのチェック**
   - name が適切か確認
   - description が効果的か確認
   - version が記述されているか確認

5. **実行可能性のチェック**
   - 実行パターンが実際に実行できるか確認
   - スクリプトが実行可能か確認
   - テンプレートが使用可能か確認

6. **ディレクトリ構造のチェック**
   ```bash
   Bash: tree .claude/skills/{{skill-identifier}}
   ```

7. **ファイル内容のチェック**
   ```bash
   Read .claude/skills/{{skill-identifier}}/SKILL.md
   Read .claude/agents/skill-librarian.md
   ```

**検証チェックリスト**:
- [ ] エージェントとSkillで同じ内容が二重に記述されていない
- [ ] エージェントからSkillへの参照が明記されている
- [ ] Skillのメタデータ（name, description）が適切に記述されている
- [ ] Skillのリソース構造が整理されている
- [ ] 実行パターンが具体的に記述されている
- [ ] 核心概念、適用場面、判断基準が明確である
- [ ] エラーハンドリングが記載されている
- [ ] すべてのリソースファイルが作成されている
- [ ] スクリプトに実行権限が付与されている
- [ ] エージェントが軽量化されている
- [ ] 出力テンプレートのすべてのセクションが記述されている
- [ ] 抽象度が適切である
- [ ] AIに技術選定を委ねる形で記述されている
- [ ] 方向性と概念の認識ズレがない

**成果物**:
- 検証済みのSkillとエージェント

**確認事項**:
- [ ] すべての検証項目をクリアした
- [ ] 品質基準を満たしている
- [ ] 実用可能な状態である

---

## 出力ファイル一覧

### 新規作成ファイル

#### メインファイル
```
.claude/skills/{{skill-identifier}}/SKILL.md
```
- Skillのエントリーポイント
- 出力テンプレートに従って記述
- 全セクションを含む

#### リソースファイル（必要に応じて）
```
.claude/skills/{{skill-identifier}}/resources/getting-started.md
.claude/skills/{{skill-identifier}}/resources/advanced-usage.md
.claude/skills/{{skill-identifier}}/resources/troubleshooting.md
.claude/skills/{{skill-identifier}}/resources/api-reference.md
.claude/skills/{{skill-identifier}}/resources/{{other-document}}.md
```
- 参照用ドキュメント
- 初心者向け、上級者向け、トラブルシューティング等

#### スクリプトファイル（必要に応じて）
```
.claude/skills/{{skill-identifier}}/scripts/setup.py
.claude/skills/{{skill-identifier}}/scripts/execute.py
.claude/skills/{{skill-identifier}}/scripts/cleanup.py
.claude/skills/{{skill-identifier}}/scripts/{{other-script}}.sh
```
- 実行可能スクリプト
- セットアップ、実行、クリーンアップ等

#### テンプレートファイル（必要に応じて）
```
.claude/skills/{{skill-identifier}}/templates/config.template.yaml
.claude/skills/{{skill-identifier}}/templates/report.template.md
.claude/skills/{{skill-identifier}}/templates/{{other-template}}.{{ext}}
```
- 設定やレポートのテンプレート
- 変数を含む雛形

#### アセットファイル（必要に応じて）
```
.claude/skills/{{skill-identifier}}/assets/schema.json
.claude/skills/{{skill-identifier}}/assets/sample-data.csv
.claude/skills/{{skill-identifier}}/assets/{{other-asset}}.{{ext}}
```
- JSONスキーマ、サンプルデータ等
- 静的なデータファイル

---

### 修正ファイル

```
.claude/agents/skill-librarian.md
```

**修正内容**:
- Skill関連内容を削除
- Skillへの参照を追加
- エージェントの役割を明確化
- 軽量化

**修正前の状態**:
- Skillの詳細な構造説明を含む
- Progressive Disclosure の実装方法を含む
- リソース管理の詳細を含む
- 実行パターンの詳細を含む

**修正後の状態**:
- エージェントの役割と責務のみ
- Skillへの参照を含む
- 簡潔で軽量
- 重複なし

---

### 修正対象外ファイル

以下のファイルは**修正しない**:

```
.claude/skills/（他のSkill）
.claude/agents/（他のエージェント）
.claude/prompt/ナレッジ_Claude_Code_skills_ガイド.md
.claude/prompt/prompt_format.yaml
docs/00-requirements/master_system_design.md
.claude/skills/skill_list.md
```

**理由**:
- 指定されたSkillとエージェントのみを対象とする
- 他のファイルへの影響を最小限にする
- システム全体の一貫性を保つ

---

## 注意事項

### 禁止事項

1. **サンプルコードへの過度な依存**
   - サンプルコードに引っ張られすぎない
   - 概念要素を中心に記述
   - 具体例は最小限に抑える

2. **重複記述**
   - エージェントとSkillで同じ内容を二重に記述しない
   - 詳細はSkillに集約
   - エージェントは参照のみ

3. **抽象度の低下**
   - 具体的すぎる実装に落とし込まない
   - 概念レベルでの記述を維持
   - AIに技術選定を委ねる

4. **テーブル形式の使用**
   - 基本的に箇条書きを使用
   - テーブルは変更履歴など限定的に使用
   - 可読性を優先

5. **内容の省略**
   - すべての内容を記述
   - 省略しない
   - 出力テンプレートの全セクションを含める

---

### 推奨事項

1. **概念要素中心の記述**
   - 原則（Principles）を明確に
   - 実践方法（Practice）を具体化
   - 判断基準をチェックリスト化

2. **AIへの技術選定委譲**
   - 具体的な技術は指定しない
   - 方向性と概念を明確にする
   - AIが最適な選択をできるよう導く

3. **方向性と概念の明確化**
   - 認識ズレがないよう具体的に記述
   - 目的と理由を明確にする
   - コンテキストを提供

4. **チェックリスト形式の活用**
   - 判断基準をチェックリスト化
   - 確認項目を列挙
   - AIが自己評価できるようにする

5. **完全性の確保**
   - すべての内容を省略せず記述
   - 出力テンプレートの全セクションを含める
   - 必要十分な情報を提供

---

## 実行フロー

```
ステップ1: エージェント内容の分析
   ↓
   - エージェントファイルの読み込み
   - Skill関連内容の特定
   - 分離すべき内容のリストアップ
   ↓
ステップ2: Skill対象の決定
   ↓
   - 既存Skill一覧の確認
   - Skill識別子の決定
   - Skillの概要記述
   - バージョンの決定
   ↓
ステップ3: Skillディレクトリ構造の作成
   ↓
   - メインディレクトリの作成
   - サブディレクトリの作成
   - ディレクトリ構造の確認
   ↓
ステップ4: SKILL.mdの作成
   ↓
   - ナレッジガイドの参照
   - システム設計仕様書の参照
   - SKILL.mdの作成
   - 各セクションの記述
   ↓
ステップ5: リソースファイルの作成
   ↓
   - 必要なリソースファイルの特定
   - ドキュメントファイルの作成
   - スクリプトファイルの作成
   - テンプレートファイルの作成
   - アセットファイルの作成
   ↓
ステップ6: エージェント本体の修正
   ↓
   - エージェントファイルの読み込み
   - Skill関連内容の削除
   - Skillへの参照の追加
   - エージェントの役割の明確化
   - エージェントファイルの更新
   ↓
ステップ7: 検証
   ↓
   - 重複チェック
   - 参照チェック
   - Skillの完全性チェック
   - Skillメタデータのチェック
   - 実行可能性のチェック
   - ディレクトリ構造のチェック
   - ファイル内容のチェック
   ↓
完成
```

**実行原則**:
- **ステップバイステップ**: 各ステップを一つずつ丁寧に実行
- **前ステップの完了確認**: 前ステップの完了を確認してから次ステップへ
- **検証の徹底**: 各ステップで確認事項をチェック
- **品質の確保**: 最終的な検証を経て完成とする

---

## 最終確認チェックリスト

### ファイル作成確認
- [ ] `.claude/skills/{{skill-identifier}}/SKILL.md` を作成した
- [ ] 必要なリソースファイルをすべて作成した
- [ ] 必要なスクリプトファイルをすべて作成した
- [ ] 必要なテンプレートファイルをすべて作成した
- [ ] 必要なアセットファイルをすべて作成した

### エージェント修正確認
- [ ] `.claude/agents/skill-librarian.md` を修正した
- [ ] Skill関連の詳細を削除した
- [ ] Skillへの参照を追加した
- [ ] エージェントが軽量化された

### 内容確認
- [ ] すべての参照ドキュメントを確認済み
- [ ] エージェントから分離すべき内容をリストアップ済み
- [ ] Skill識別子とディレクトリ名を決定済み
- [ ] SKILL.mdを出力テンプレートに従って作成済み
- [ ] 出力テンプレートの全セクションを記述済み

### 品質確認
- [ ] エージェントとSkillの重複がないことを確認済み
- [ ] エージェントがSkillを正しく参照していることを確認済み
- [ ] Skillが必要十分な情報を持っていることを確認済み
- [ ] すべての内容が省略されていないことを確認済み
- [ ] 抽象度が適切であることを確認済み

### 実行可能性確認
- [ ] 実行パターンが実際に実行できることを確認済み
- [ ] スクリプトに実行権限が付与されていることを確認済み
- [ ] テンプレートが使用可能であることを確認済み
- [ ] リソースファイルが正しく配置されていることを確認済み

---

このガイドに従い、ステップバイステップでSkillを作成し、エージェントを改修してください。
すべてのステップを丁寧に実行し、最終確認チェックリストをクリアすることで、高品質なSkillとエージェントが完成します。
