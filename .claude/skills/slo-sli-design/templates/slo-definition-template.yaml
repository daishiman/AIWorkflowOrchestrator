# SLOå®šç¾©ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

service_name: "{{SERVICE_NAME}}"
service_description: "{{SERVICE_DESCRIPTION}}"

# SLOå®šç¾©
slos:
  # SLO 1: å¯ç”¨æ€§
  - name: "APIå¯ç”¨æ€§"
    description: "APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æˆåŠŸç‡"
    sli:
      type: "availability"
      measurement:
        numerator: "HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰2xxã¾ãŸã¯3xxã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°"
        denominator: "å…¨HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°"
        data_source: "Prometheus"
        query: |
          sum(rate(http_requests_total{service="{{SERVICE_NAME}}", status=~"2..|3.."}[{{WINDOW}}]))
          /
          sum(rate(http_requests_total{service="{{SERVICE_NAME}}"}[{{WINDOW}}]))
      success_criteria: "HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ 2xx ã¾ãŸã¯ 3xx"
      exclusions:
        - "ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (/health)"
        - "ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (/metrics)"
    slo_target: 99.9  # 99.9%
    measurement_window: "30d"  # 30æ—¥é–“ã®ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
    error_budget:
      calculation: "(1 - 0.999) * total_requests_30d"
      policy:
        - threshold: "> 50%"
          action: "é€šå¸¸é–‹ç™ºé€Ÿåº¦"
        - threshold: "25-50%"
          action: "æ–°æ©Ÿèƒ½ãƒ‡ãƒ—ãƒ­ã‚¤æ…é‡åŒ–"
        - threshold: "10-25%"
          action: "æ–°æ©Ÿèƒ½å‡çµã€ä¿¡é ¼æ€§æ”¹å–„å„ªå…ˆ"
        - threshold: "< 10%"
          action: "ç·Šæ€¥å¯¾å¿œã€ã™ã¹ã¦ã®å¤‰æ›´å‡çµ"

  # SLO 2: ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·
  - name: "APIãƒ¬ã‚¤ãƒ†ãƒ³ã‚·"
    description: "APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å¿œç­”æ™‚é–“ï¼ˆP99ï¼‰"
    sli:
      type: "latency"
      measurement:
        metric: "P99ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·"
        data_source: "Prometheus"
        query: |
          histogram_quantile(0.99,
            rate(http_request_duration_seconds_bucket{service="{{SERVICE_NAME}}"}[{{WINDOW}}])
          )
      percentile: 99
    slo_target: 0.5  # 500ms
    measurement_window: "30d"
    error_budget:
      calculation: "Requests with latency > 500ms"
      policy:
        - threshold: "> 1% of requests slow"
          action: "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚’å„ªå…ˆ"

  # SLO 3: ã‚¨ãƒ©ãƒ¼ç‡
  - name: "5xxã‚¨ãƒ©ãƒ¼ç‡"
    description: "ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ã®ç™ºç”Ÿç‡"
    sli:
      type: "error_rate"
      measurement:
        numerator: "HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰5xxã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°"
        denominator: "å…¨HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°"
        data_source: "Prometheus"
        query: |
          sum(rate(http_requests_total{service="{{SERVICE_NAME}}", status=~"5.."}[{{WINDOW}}]))
          /
          sum(rate(http_requests_total{service="{{SERVICE_NAME}}"}[{{WINDOW}}]))
    slo_target: 0.001  # 0.1% (99.9%ã®æˆåŠŸç‡)
    measurement_window: "30d"
    error_budget:
      calculation: "(1 - 0.999) * total_requests_30d"

# ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
alerts:
  - name: "SLOViolation"
    condition: "availability_30d < slo_target"
    severity: "critical"
    notification:
      - "slack_channel"
      - "pagerduty"
    message: "ğŸ”´ SLOé•å: å¯ç”¨æ€§ãŒ{{VALUE}}% (ç›®æ¨™: {{SLO_TARGET}}%)"

  - name: "ErrorBudgetYellow"
    condition: "error_budget_remaining < 0.50"
    severity: "warning"
    notification:
      - "slack_channel"
    message: "âš ï¸ ã‚¨ãƒ©ãƒ¼ãƒã‚¸ã‚§ãƒƒãƒˆæ®‹é‡50%æœªæº€"

  - name: "ErrorBudgetCritical"
    condition: "error_budget_remaining < 0.10"
    severity: "critical"
    notification:
      - "slack_channel"
      - "pagerduty"
      - "email_engineering_leadership"
    message: "ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒã‚¸ã‚§ãƒƒãƒˆæ®‹é‡10%æœªæº€ã€‚ç·Šæ€¥å¯¾å¿œãŒå¿…è¦ã§ã™ã€‚"

  - name: "FastBurn"
    condition: "burn_rate_1h > 14.4 AND burn_rate_6h > 14.4"
    severity: "critical"
    notification:
      - "pagerduty"
    message: "ğŸ”¥ ã‚¨ãƒ©ãƒ¼ãƒã‚¸ã‚§ãƒƒãƒˆãŒæ€¥é€Ÿæ¶ˆè²»ä¸­ï¼ˆ2æ—¥ã§æ¯æ¸‡äºˆæ¸¬ï¼‰"

# ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¨­å®š
dashboard:
  panels:
    - name: "SLO Status"
      type: "stat"
      query: "availability_30d"
      thresholds:
        - color: "green"
          value: 99.9
        - color: "red"
          value: 0

    - name: "Error Budget Remaining"
      type: "gauge"
      query: "(error_budget_total - error_count_30d) / error_budget_total * 100"
      thresholds:
        - color: "red"
          value: 0
        - color: "yellow"
          value: 25
        - color: "green"
          value: 50

    - name: "Error Budget Burn Rate"
      type: "graph"
      query: "rate(http_requests_total{status=~'5..'}[1h]) / (slo_error_rate)"

    - name: "Request Success Rate (30d)"
      type: "graph"
      query: "availability_30d"

# ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
review_schedule:
  daily: "ã‚¨ãƒ©ãƒ¼ãƒã‚¸ã‚§ãƒƒãƒˆæ®‹é‡ç¢ºèª"
  weekly: "SLOé”æˆçŠ¶æ³ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ"
  monthly: "æœˆæ¬¡SLOãƒ¬ãƒãƒ¼ãƒˆã€ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆæŒ¯ã‚Šè¿”ã‚Š"
  quarterly: "SLOå¦¥å½“æ€§è©•ä¾¡ã€ç›®æ¨™å€¤èª¿æ•´æ¤œè¨"
