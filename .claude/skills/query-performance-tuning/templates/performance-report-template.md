# パフォーマンスレポート

## レポート情報

| 項目         | 内容                     |
| ------------ | ------------------------ |
| 対象システム | [システム名]             |
| 対象期間     | YYYY-MM-DD 〜 YYYY-MM-DD |
| 作成日       | YYYY-MM-DD               |
| 作成者       | [作成者名]               |

## エグゼクティブサマリー

### 全体評価

| 指標               | 現状値 | 目標値 | 状態     |
| ------------------ | ------ | ------ | -------- |
| 平均クエリ時間     | [X]ms  | <100ms | 🟢/🟡/🔴 |
| P95レスポンス      | [X]ms  | <500ms | 🟢/🟡/🔴 |
| スロークエリ率     | [X]%   | <1%    | 🟢/🟡/🔴 |
| キャッシュヒット率 | [X]%   | >95%   | 🟢/🟡/🔴 |

### 主な発見

1. [発見1の要約]
2. [発見2の要約]
3. [発見3の要約]

### 優先度の高い改善提案

1. **[改善1]**: [期待される効果]
2. **[改善2]**: [期待される効果]
3. **[改善3]**: [期待される効果]

---

## 詳細分析

### 1. スロークエリ分析

#### Top 10 スロークエリ（平均実行時間順）

| #   | クエリ概要 | 呼出回数 | 平均時間 | 合計時間 | 影響度   |
| --- | ---------- | -------- | -------- | -------- | -------- |
| 1   | [クエリ1]  | [N]回    | [X]ms    | [Y]ms    | 高/中/低 |
| 2   | [クエリ2]  | [N]回    | [X]ms    | [Y]ms    | 高/中/低 |
| ... | ...        | ...      | ...      | ...      | ...      |

#### 問題クエリの詳細

**クエリ #1: [クエリの識別名]**

```sql
-- 問題のクエリ
[実際のSQL]
```

**現在の実行計画:**

```
[EXPLAIN QUERY PLAN の出力]
```

**問題点:**

- [問題点1]
- [問題点2]

**改善提案:**

```sql
-- 改善後のクエリ
[改善されたSQL]

-- または新しいインデックス
-- 注: SQLiteにはCONCURRENTLYオプションはない。WALモード推奨。
CREATE INDEX [インデックス名] ON [テーブル] ([カラム]);
```

**期待される改善:**

- 実行時間: [X]ms → [Y]ms（[Z]%改善）

---

### 2. インデックス分析

#### 未使用インデックス

| テーブル    | インデックス名  | サイズ | 推奨アクション |
| ----------- | --------------- | ------ | -------------- |
| [テーブル1] | [インデックス1] | [X]MB  | 削除を検討     |
| [テーブル2] | [インデックス2] | [Y]MB  | 削除を検討     |

#### 不足しているインデックス

| テーブル    | 提案インデックス   | 理由   | 優先度   |
| ----------- | ------------------ | ------ | -------- |
| [テーブル1] | [カラム1, カラム2] | [理由] | 高/中/低 |
| [テーブル2] | [カラム3]          | [理由] | 高/中/低 |

#### インデックス使用状況

注: SQLiteには直接的なスキャン統計がないため、
EXPLAIN QUERY PLANとアプリケーションログで監視

| テーブル    | クエリパターン | インデックス使用 | 状態     |
| ----------- | -------------- | ---------------- | -------- |
| [テーブル1] | [パターン]     | SEARCH/SCAN      | 🟢/🟡/🔴 |
| [テーブル2] | [パターン]     | SEARCH/SCAN      | 🟢/🟡/🔴 |

---

### 3. テーブル統計

#### サイズ上位テーブル

| テーブル    | 総サイズ | データ | インデックス | 行数  |
| ----------- | -------- | ------ | ------------ | ----- |
| [テーブル1] | [X]GB    | [Y]GB  | [Z]GB        | [N]行 |
| [テーブル2] | [X]GB    | [Y]GB  | [Z]GB        | [N]行 |

#### データベース断片化状況

| テーブル    | 未使用ページ | 割合 | 最終VACUUM | 推奨       |
| ----------- | ------------ | ---- | ---------- | ---------- |
| [テーブル1] | [N]ページ    | [X]% | [日時]     | VACUUM推奨 |
| [テーブル2] | [N]ページ    | [X]% | [日時]     | 正常       |

注: `PRAGMA freelist_count` で未使用ページ数を確認

---

### 4. 接続とリソース

#### 接続プール状況

| 指標                     | 値  | 推奨値 |
| ------------------------ | --- | ------ |
| 最大接続数               | [N] | [M]    |
| アクティブ接続（ピーク） | [N] | -      |
| アイドル接続（平均）     | [N] | -      |
| 待機接続（最大）         | [N] | 0      |

#### リソース使用率

| リソース     | 使用率 | 状態     |
| ------------ | ------ | -------- |
| CPU          | [X]%   | 🟢/🟡/🔴 |
| メモリ       | [X]%   | 🟢/🟡/🔴 |
| ディスクI/O  | [X]%   | 🟢/🟡/🔴 |
| ネットワーク | [X]%   | 🟢/🟡/🔴 |

---

## 改善計画

### 短期（1-2週間）

| #   | 改善項目 | 対象   | 期待効果 | 担当   | 期限  |
| --- | -------- | ------ | -------- | ------ | ----- |
| 1   | [改善1]  | [対象] | [効果]   | [担当] | MM/DD |
| 2   | [改善2]  | [対象] | [効果]   | [担当] | MM/DD |

### 中期（1-2ヶ月）

| #   | 改善項目 | 対象   | 期待効果 | 担当   | 期限  |
| --- | -------- | ------ | -------- | ------ | ----- |
| 1   | [改善1]  | [対象] | [効果]   | [担当] | MM/DD |
| 2   | [改善2]  | [対象] | [効果]   | [担当] | MM/DD |

### 長期（3ヶ月以上）

| #   | 改善項目 | 対象   | 期待効果 | 検討事項   |
| --- | -------- | ------ | -------- | ---------- |
| 1   | [改善1]  | [対象] | [効果]   | [検討事項] |
| 2   | [改善2]  | [対象] | [効果]   | [検討事項] |

---

## 監視と継続改善

### 監視ダッシュボード

- [ ] アプリケーションログでのクエリ時間監視（週次）
- [ ] スロークエリアラートの設定
- [ ] データベースサイズの監視
- [ ] WALファイルサイズの監視
- [ ] 接続数の監視

### 次回レビュー

- **日付**: YYYY-MM-DD
- **フォーカスエリア**: [次回の重点分野]

---

## 付録

### A. 使用したクエリ

```sql
-- スロークエリ抽出
SELECT ...

-- インデックス使用率
SELECT ...
```

### B. 環境情報

```yaml
sqlite_version: [バージョン]
journal_mode: [WAL/DELETE/TRUNCATE/PERSIST/MEMORY/OFF]
synchronous: [OFF/NORMAL/FULL/EXTRA]
cache_size: [ページ数]
page_size: [バイト]
mmap_size: [バイト]
```

### C. 変更履歴

| 日付       | 変更内容 | 担当   |
| ---------- | -------- | ------ |
| YYYY-MM-DD | 初版作成 | [担当] |
