# System Prompt Patterns

## 概要

エージェントのSystem Prompt設計における効果的なパターン集。

## System Promptの構造

### 推奨7セクション構造

```markdown
# {{エージェント名}}

## 役割

{{役割の説明}}

## 専門分野

{{専門領域のリスト}}

## ワークフロー

{{Phase 1-7の詳細}}

## スキル管理

{{使用タイミングと依存スキル}}

## ベストプラクティス

{{すべきこと・避けるべきこと}}

## 詳細リファレンス

{{リソース・テンプレート・スクリプトへの参照}}

## 変更履歴

{{バージョン履歴}}
```

## パターン1: Role Prompting

### 基本形式

```markdown
## 役割

あなたは **{{役割名}}** です。

{{役割の詳細説明}}
```

### 効果

- ✅ エージェントの行動指針が明確になる
- ✅ 一貫した判断基準が形成される
- ✅ 専門性が向上する

### 例

```markdown
## 役割

あなたは **リファクタリング専門家** です。

マーティン・ファウラー『リファクタリング』に基づき、
コードの匂いを検出し、適切なリファクタリング手法を
選択・適用することで、コード品質を体系的に改善します。
```

## パターン2: Constrained Behavior

### 基本形式

```markdown
## 制約

**すべきこと**:

- {{制約1}}
- {{制約2}}

**避けるべきこと**:

- {{禁止事項1}}
- {{禁止事項2}}
```

### 効果

- ✅ 不適切な動作を防止
- ✅ 品質基準を明確化
- ✅ エラーを減らす

### 例

```markdown
## ベストプラクティス

✅ **すべきこと**:

- 明確で説明的な変数名を使用
- 小さなステップでリファクタリング
- 各ステップでテストを実行

❌ **避けるべきこと**:

- テストなしのリファクタリング
- 複数の変更を同時に実施
- 曖昧な変数名の使用
```

## パターン3: Structured Workflow

### 基本形式

```markdown
## ワークフロー

### Phase 1: {{Phase名}}

**実施内容**:

1. {{ステップ1}}
2. {{ステップ2}}
3. {{ステップ3}}

**ツール使用**:

- {{ツール1}}
- {{ツール2}}

**成果物**:

- {{成果物1}}
```

### 効果

- ✅ タスクを体系的に実行
- ✅ ツール使用が適切になる
- ✅ 成果物が明確になる

### 例

```markdown
## ワークフロー

### Phase 1: Code Smellsの検出

**実施内容**:

1. 対象コードファイルを読み込み
2. Long Method（長すぎるメソッド）を検出
3. Duplicate Code（重複コード）を特定
4. Large Class（巨大クラス）を発見

**ツール使用**:

- Read: コードファイルの読み込み
- Grep: パターン検索

**成果物**:

- `.claude/docs/code-smells-report.md`
```

## パターン4: Knowledge Reference

### 基本形式

````markdown
## 専門知識の参照

このエージェントは以下のスキルに依存しています:

- **{{スキル1}}** (`.claude/skills/{{スキル1パス}}/SKILL.md`)
- **{{スキル2}}** (`.claude/skills/{{スキル2パス}}/SKILL.md`)

🔴 起動時にこれらのスキルを必ず読み込んでください:

```bash
cat .claude/skills/{{スキル1パス}}/SKILL.md
cat .claude/skills/{{スキル2パス}}/SKILL.md
```
````

````

### 効果

- ✅ プログレッシブディスクロージャー
- ✅ エージェント本体の軽量化
- ✅ 専門知識の分離

### 例

```markdown
## 専門知識の参照

このエージェントは以下のスキルに依存しています:
- **.claude/skills/agent-architecture-patterns/SKILL.md** (`.claude/skills/agent-architecture-patterns/SKILL.md`)
- **.claude/skills/agent-structure-design/SKILL.md** (`.claude/skills/agent-structure-design/SKILL.md`)

🔴 起動時にこれらのスキルを必ず読み込んでください:

```bash
cat .claude/skills/agent-architecture-patterns/SKILL.md
cat .claude/skills/agent-structure-design/SKILL.md
````

````

## パターン5: Few-Shot Examples

### 基本形式

```markdown
## 例

### 例1: {{シナリオ1}}

**入力**:
{{入力例1}}

**期待される出力**:
{{出力例1}}

### 例2: {{シナリオ2}}

**入力**:
{{入力例2}}

**期待される出力**:
{{出力例2}}
````

### 効果

- ✅ 期待される動作が明確になる
- ✅ エッジケースへの対応が向上
- ✅ 学習効率が上がる

### 推奨数

- **最小限**: 2-3個
- **最大**: 5個

### 例

````markdown
## 例

### 例1: Long Methodの検出

**入力**:

```typescript
function processUserData(user) {
  // 50行のコード
  // ...
}
```
````

**期待される出力**:

- Code Smell検出: Long Method
- 推奨リファクタリング: Extract Method
- 提案: `processUserData`を5つのメソッドに分割

````

## パターン6: Context Enhancement

### 基本形式

```markdown
## コンテキスト強化

### プロジェクト固有の知識

このエージェントは以下のプロジェクトドキュメントを参照します:
- アーキテクチャ図: `.claude/docs/architecture.md`
- スタイルガイド: `.claude/docs/style-guide.md`

### 判断基準

以下の基準に従って判断します:
- {{基準1}}
- {{基準2}}
````

### 効果

- ✅ プロジェクト固有の知識を活用
- ✅ 一貫した判断基準
- ✅ コンテキスト認識の向上

## パターン7: Error Handling Directive

### 基本形式

```markdown
## エラーハンドリング

### Retry戦略

- **最大試行回数**: {{max_retries}}
- **Retry条件**: {{retry_conditions}}

### Fallback動作

エラー時の代替動作:

1. {{fallback_1}}
2. {{fallback_2}}

### Escalation

以下の場合は上位エージェントにエスカレーション:

- {{escalation_condition_1}}
- {{escalation_condition_2}}
```

### 効果

- ✅ エラー時の動作が明確
- ✅ 復旧可能性の向上
- ✅ ユーザー体験の改善

## ベストプラクティス

### ✅ すべきこと

1. **明確な役割定義**: Role Promptingパターン使用
2. **構造化**: 7セクション構造に従う
3. **最小限の例**: 2-3個のFew-Shot Examples
4. **スキル参照**: プログレッシブディスクロージャー
5. **制約明示**: すべきこと・避けるべきこと

### ❌ 避けるべきこと

1. **曖昧な役割**: 抽象的な説明
2. **非構造化**: 一貫性のない構造
3. **過度な例**: 10個以上のFew-Shot
4. **知識の重複**: スキルと重複する詳細
5. **制約の欠如**: ガードレールなし

## 変更履歴

| バージョン | 日付       | 変更内容 |
| ---------- | ---------- | -------- |
| 1.0.0      | 2025-11-24 | 初版作成 |
