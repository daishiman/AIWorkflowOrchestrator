# 要件分類ガイド

## 概要

要件を機能要件（Functional Requirements）と非機能要件（Non-Functional Requirements）に
正確に分類することで、設計・実装・テストの効率が向上します。

## 基本定義

### 機能要件（FR: Functional Requirements）

**定義**: システムが「何をするか」を定義する要件

**特徴**:
- ユーザーの操作に対するシステムの応答
- データの入力・処理・出力
- ビジネスルールと計算ロジック
- 状態遷移

**例**:
- ユーザーはログインできる
- システムは注文を処理する
- レポートを生成する
- 検索結果を表示する

### 非機能要件（NFR: Non-Functional Requirements）

**定義**: システムが「どのように動作するか」を定義する要件

**特徴**:
- 品質特性（性能、セキュリティ、可用性など）
- 制約条件
- 技術的な基準

**例**:
- 応答時間は200ms以内
- 稼働率99.9%
- WCAG 2.1 AA準拠
- 同時接続1000ユーザー

## 分類判断フローチャート

```
この要件は...
│
├─ ユーザーの操作に対する応答を定義？
│  └─ Yes → 機能要件
│
├─ データの入出力・変換を定義？
│  └─ Yes → 機能要件
│
├─ ビジネスルール・計算を定義？
│  └─ Yes → 機能要件
│
├─ システムの品質特性を定義？
│  └─ Yes → 非機能要件
│
├─ セキュリティ・認証を定義？
│  └─ Yes → 非機能要件（ただしログイン機能自体は機能要件）
│
├─ 性能・応答時間を定義？
│  └─ Yes → 非機能要件
│
├─ 保守性・拡張性を定義？
│  └─ Yes → 非機能要件
│
└─ 制約条件を定義？
   └─ Yes → 非機能要件
```

## 分類の具体例

### 明確な機能要件

| 要件 | 理由 |
|-----|------|
| ユーザーはメールアドレスでログインできる | ユーザー操作への応答 |
| システムは注文合計を計算する | データ処理 |
| 検索キーワードに一致する商品を表示する | データ出力 |
| 管理者はユーザーを削除できる | ユーザー操作への応答 |
| システムは在庫を減少させる | 状態変更 |

### 明確な非機能要件

| 要件 | 理由 |
|-----|------|
| 応答時間200ms以内 | 性能 |
| 稼働率99.9% | 可用性 |
| パスワードはSHA-256でハッシュ化 | セキュリティ |
| 同時接続1000ユーザー | スケーラビリティ |
| WCAG 2.1 AA準拠 | アクセシビリティ |

### 判断が難しい例

| 要件 | 分類 | 理由 |
|-----|------|------|
| ユーザー認証機能 | FR | 機能としての認証（ログイン/ログアウト） |
| 認証の安全性 | NFR | 認証の品質特性（暗号化、セッション管理） |
| 検索機能 | FR | 検索という機能 |
| 検索の高速性 | NFR | 検索の性能特性 |
| エラー処理 | FR | どのようなエラーメッセージを表示するか |
| エラー回復性 | NFR | システムがエラーから復旧する能力 |

## 機能要件の記述形式

### 基本フォーマット

```markdown
## 機能要件: FR-XXX [機能名]

**概要**: [1文での説明]

**アクター**: [誰が使うか]

**前提条件**: [実行前に満たすべき条件]

**トリガー**: [機能が実行されるきっかけ]

**基本フロー**:
1. [ステップ1]
2. [ステップ2]
3. [ステップ3]

**代替フロー**:
- [条件]: [動作]

**事後条件**: [実行後の状態]

**ビジネスルール**:
- [ルール1]
- [ルール2]

**関連要件**: [関連するFR/NFR]
```

### 記述例

```markdown
## 機能要件: FR-001 ユーザーログイン

**概要**: ユーザーがメールアドレスとパスワードでシステムにログインする

**アクター**: 登録済みユーザー

**前提条件**:
- ユーザーアカウントが存在する
- アカウントがロックされていない

**トリガー**: ユーザーがログインページにアクセス

**基本フロー**:
1. システムがログインフォームを表示する
2. ユーザーがメールアドレスとパスワードを入力する
3. ユーザーが「ログイン」ボタンをクリックする
4. システムが認証情報を検証する
5. システムがセッションを作成する
6. システムがホームページにリダイレクトする

**代替フロー**:
- 認証失敗: エラーメッセージを表示し、ステップ1に戻る
- 5回連続失敗: アカウントをロックし、通知メールを送信

**事後条件**:
- ユーザーがログイン状態になる
- セッションが作成される

**ビジネスルール**:
- パスワードは8文字以上
- セッション有効期限は30分（アクティビティで延長）

**関連要件**: NFR-001（認証セキュリティ）
```

## 非機能要件の記述形式

### 基本フォーマット

```markdown
## 非機能要件: NFR-XXX [カテゴリ]

**指標**: [測定対象]
**目標値**: [具体的な数値]
**測定方法**: [どうやって測るか]
**重要度**: Critical / High / Medium / Low
**理由**: [なぜこの目標値か]

**関連機能要件**: [影響を受けるFR]
```

### 記述例

```markdown
## 非機能要件: NFR-001 認証セキュリティ

**指標**: パスワード強度と保護
**目標値**:
- パスワードはbcryptでハッシュ化（コスト係数12以上）
- パスワードポリシー: 8文字以上、大小英数字必須
- ブルートフォース対策: 5回失敗でアカウントロック

**測定方法**:
- セキュリティ監査ツールによるスキャン
- ペネトレーションテスト

**重要度**: Critical

**理由**:
- 個人情報保護法への準拠
- 過去のセキュリティインシデントの再発防止

**関連機能要件**: FR-001（ユーザーログイン）
```

## 分類チェックリスト

### 機能要件の確認
- [ ] アクターが特定されているか？
- [ ] 入力と出力が明確か？
- [ ] ビジネスルールが定義されているか？
- [ ] 成功・失敗の条件が明確か？

### 非機能要件の確認
- [ ] カテゴリが特定されているか？
- [ ] 測定可能な目標値があるか？
- [ ] 測定方法が定義されているか？
- [ ] 重要度が設定されているか？

### 分類の妥当性確認
- [ ] 「システムは何をするか」→ FR
- [ ] 「システムはどのように動作するか」→ NFR
- [ ] 混在している場合は分離したか？

## よくある間違い

### 1. 機能と品質の混同

**間違い**: 「高速な検索機能」

**正解**:
- FR: 「検索機能」（キーワードで商品を検索できる）
- NFR: 「検索性能」（検索結果を1秒以内に表示）

### 2. 制約を機能と混同

**間違い**: FR「システムはAWSで動作する」

**正解**: NFR「インフラ制約」（AWSでホスティング）

### 3. セキュリティの分類

**間違い**: すべてのセキュリティを非機能要件に分類

**正解**:
- FR: 「ユーザー認証機能」（ログイン/ログアウトの動作）
- NFR: 「認証セキュリティ」（暗号化方式、セッション管理）

## 境界ケースの扱い

### ログ出力

```
FR: 「システムはエラー時にログを出力する」
    → エラー時に何を出力するかという機能

NFR: 「ログの保持期間は1年間」
    → ログ管理の品質特性
```

### 通知機能

```
FR: 「システムはユーザーにメール通知を送信する」
    → 通知という機能

NFR: 「通知は5分以内に送信される」
    → 通知の性能特性
```

### アクセス制御

```
FR: 「管理者のみがユーザーを削除できる」
    → 権限による機能の制限

NFR: 「権限チェックは全APIで必須」
    → セキュリティの品質特性
```
