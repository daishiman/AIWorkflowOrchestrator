# ロックファイルトラブルシューティングテンプレート

## 基本情報

| 項目                   | 値                          |
| ---------------------- | --------------------------- |
| 報告日                 | <!-- 例: 2025-11-27 -->     |
| 報告者                 | <!-- 例: @dep-mgr -->       |
| プロジェクト           | <!-- 例: my-project -->     |
| パッケージマネージャー | <!-- pnpm / pnpm / yarn --> |
| PMバージョン           | <!-- 例: pnpm 9.0.0 -->     |
| Node.jsバージョン      | <!-- 例: 20.10.0 -->        |

## 問題の概要

### 発生した問題

<!-- 問題の簡潔な説明 -->

### エラーメッセージ

```
<!-- エラーメッセージを貼り付け -->
```

### 発生環境

- [ ] ローカル開発環境
- [ ] CI/CD環境（GitHub Actions / GitLab CI / CircleCI / その他）
- [ ] Docker環境
- [ ] その他: <!-- 詳細 -->

### 再現手順

1. <!-- 手順1 -->
2. <!-- 手順2 -->
3. <!-- 手順3 -->

## 診断情報

### ロックファイルの状態

```bash
# 以下のコマンドの出力を貼り付け

# ロックファイルの存在確認
ls -la pnpm-lock.yaml package-lock.json yarn.lock 2>/dev/null

# ロックファイルのサイズ
wc -l pnpm-lock.yaml 2>/dev/null || wc -l package-lock.json 2>/dev/null
```

### package.jsonとの同期状態

```bash
# pnpm
pnpm install --frozen-lockfile --dry-run

# pnpm
pnpm ci --dry-run

# yarn
yarn install --immutable --check-cache
```

**結果**:

```
<!-- 出力を貼り付け -->
```

### 依存関係ツリー

```bash
# 問題のあるパッケージの依存を確認
pnpm why <package-name>
```

**結果**:

```
<!-- 出力を貼り付け -->
```

### Node.jsとパッケージマネージャーのバージョン

```bash
node --version
pnpm --version  # または pnpm --version / yarn --version
```

**結果**:

```
<!-- 出力を貼り付け -->
```

## 問題の分類

### 問題タイプ

- [ ] ロックファイルとpackage.jsonの不整合
- [ ] マージコンフリクト
- [ ] 整合性ハッシュのエラー
- [ ] ピア依存の競合
- [ ] CI/CD環境での再現性問題
- [ ] パフォーマンス問題
- [ ] その他: <!-- 詳細 -->

### 影響範囲

- [ ] ローカル開発のみ
- [ ] CI/CDビルドのみ
- [ ] 本番デプロイに影響
- [ ] チーム全体に影響

## 試行した解決策

### 試行1: <!-- 解決策名 -->

**実行したコマンド**:

```bash
<!-- コマンド -->
```

**結果**:

- [ ] 成功
- [ ] 失敗

**詳細**:

<!-- 結果の詳細 -->

---

### 試行2: <!-- 解決策名 -->

**実行したコマンド**:

```bash
<!-- コマンド -->
```

**結果**:

- [ ] 成功
- [ ] 失敗

**詳細**:

<!-- 結果の詳細 -->

---

## 解決策

### 採用した解決策

<!-- 最終的に解決した方法 -->

### 実行した手順

```bash
# 1.
<!-- コマンド -->

# 2.
<!-- コマンド -->

# 3.
<!-- コマンド -->
```

### 検証

- [ ] ローカルでのインストールが成功
- [ ] `--frozen-lockfile` でのインストールが成功
- [ ] 全テストが通過
- [ ] CI/CDでのビルドが成功

## 根本原因分析

### 原因

<!-- 問題が発生した根本的な原因 -->

### 発生条件

<!-- どのような条件で問題が発生したか -->

## 再発防止策

### 短期的な対策

- [ ] <!-- 対策1 -->
- [ ] <!-- 対策2 -->

### 長期的な対策

- [ ] <!-- 対策1 -->
- [ ] <!-- 対策2 -->

## 参考情報

### 関連リンク

- <!-- エラーメッセージの公式ドキュメント -->
- <!-- GitHub Issue等 -->

### 関連するコミット/PR

- <!-- コミットハッシュまたはPR URL -->

## コマンドリファレンス

### 一般的な解決コマンド

```bash
# ロックファイルの再生成
rm pnpm-lock.yaml && pnpm install

# node_modulesのクリーンインストール
rm -rf node_modules && pnpm install

# pnpmストアのクリア
pnpm store prune

# 重複の解消
pnpm dedupe

# 整合性チェック
pnpm install --frozen-lockfile
```

### マージコンフリクト解決

```bash
# package.jsonのコンフリクトを解決後
rm pnpm-lock.yaml
pnpm install
git add package.json pnpm-lock.yaml
```

### 環境間の問題

```bash
# ローカルのロックファイルをCIと同期
git pull origin main
rm -rf node_modules
pnpm install --frozen-lockfile
```

## チェックリスト

### 問題報告時

- [ ] エラーメッセージを正確に記録したか？
- [ ] 再現手順を明確にしたか？
- [ ] 環境情報を収集したか？
- [ ] 関連するファイルの状態を確認したか？

### 解決時

- [ ] 根本原因を特定したか？
- [ ] 解決策が他の環境でも有効か確認したか？
- [ ] テストで動作確認したか？
- [ ] ドキュメントを更新したか？

### 再発防止

- [ ] CI/CDでのチェックを追加したか？
- [ ] チームに共有したか？
- [ ] プロセスの改善点を特定したか？
