# エッジケースカタログ

## 概要

よく見落とされるエッジケースのカタログです。
テストケース設計時のチェックリストとして使用してください。

---

## 数値

### 整数

| ケース         | 値                        | 説明                     |
| -------------- | ------------------------- | ------------------------ |
| ゼロ           | `0`                       | 割り算、配列インデックス |
| 負のゼロ       | `-0`                      | JavaScriptでは0と等しい  |
| 負の数         | `-1`, `-100`              | 符号付き整数の処理       |
| 最大値         | `Number.MAX_SAFE_INTEGER` | 9007199254740991         |
| 最小値         | `Number.MIN_SAFE_INTEGER` | -9007199254740991        |
| オーバーフロー | `MAX + 1`                 | 精度の損失               |

```typescript
it.each([0, -0, -1, 1, Number.MAX_SAFE_INTEGER, Number.MIN_SAFE_INTEGER])(
  "should handle integer %i",
  (value) => {
    // テスト
  },
);
```

### 浮動小数点

| ケース | 値                      | 説明           |
| ------ | ----------------------- | -------------- |
| 小数   | `0.1`, `0.2`            | 浮動小数点誤差 |
| 極小値 | `Number.MIN_VALUE`      | 最小正数       |
| 無限大 | `Infinity`, `-Infinity` | 除算結果など   |
| 非数   | `NaN`                   | 不正な演算結果 |

```typescript
it.each([
  0.1 + 0.2, // 0.30000000000000004
  Number.MIN_VALUE,
  Number.EPSILON,
  Infinity,
  -Infinity,
  NaN,
])("should handle float %s", (value) => {
  // テスト
});
```

---

## 文字列

### 長さ

| ケース     | 値                  | 説明         |
| ---------- | ------------------- | ------------ |
| 空文字列   | `""`                | 長さ0        |
| 1文字      | `"a"`               | 最小有効     |
| 非常に長い | `"a".repeat(10000)` | 性能、メモリ |

### 特殊文字

| ケース     | 値                 | 説明         |
| ---------- | ------------------ | ------------ |
| 空白のみ   | `"   "`            | トリム処理   |
| タブ       | `"\t"`             | 空白の一種   |
| 改行       | `"\n"`, `"\r\n"`   | 行末処理     |
| Unicode    | `"日本語"`, `"😀"` | マルチバイト |
| ゼロ幅文字 | `"\u200B"`         | 見えない文字 |
| NULL文字   | `"\0"`             | 文字列終端   |

```typescript
const edgeCaseStrings = [
  "",
  " ",
  "   ",
  "\t",
  "\n",
  "\r\n",
  "a",
  "a".repeat(10000),
  "日本語",
  "😀",
  "\u200B", // zero-width space
  "\0", // null character
  '<script>alert("xss")</script>', // XSS
  "'; DROP TABLE users; --", // SQL injection
];
```

### パス・URL

| ケース         | 値                       | 説明             |
| -------------- | ------------------------ | ---------------- |
| 相対パス       | `./file.txt`             | パス解決         |
| 親ディレクトリ | `../secret`              | パストラバーサル |
| 絶対パス       | `/etc/passwd`            | システムファイル |
| UNC パス       | `\\server\share`         | Windows共有      |
| プロトコル     | `file://`, `javascript:` | スキーム         |

---

## 配列・コレクション

### サイズ

| ケース   | 値             | 説明     |
| -------- | -------------- | -------- |
| 空配列   | `[]`           | 要素なし |
| 単一要素 | `[1]`          | 最小有効 |
| 大量要素 | `Array(10000)` | 性能     |

### 内容

| ケース        | 値                  | 説明          |
| ------------- | ------------------- | ------------- |
| 重複要素      | `[1, 1, 1]`         | 重複処理      |
| null含む      | `[1, null, 3]`      | null処理      |
| undefined含む | `[1, undefined, 3]` | undefined処理 |
| ネスト        | `[[1, 2], [3, 4]]`  | 多次元配列    |
| 疎配列        | `[1, , 3]`          | 穴あき配列    |

```typescript
const edgeCaseArrays = [
  [],
  [null],
  [undefined],
  [1],
  [1, 2, 3],
  [1, 1, 1], // duplicates
  [1, null, 3], // with null
  [1, undefined, 3], // with undefined
  Array(10000).fill(1), // large
  [
    [1, 2],
    [3, 4],
  ], // nested
  [1, , 3], // sparse
];
```

---

## 日付・時刻

### 特殊な日付

| ケース   | 値                 | 説明               |
| -------- | ------------------ | ------------------ |
| エポック | `1970-01-01`       | Unix時間の起点     |
| 紀元前   | 負のタイムスタンプ | 1970年以前         |
| 遠い未来 | `9999-12-31`       | 日付オーバーフロー |
| 閏年     | `2024-02-29`       | 2月29日            |
| 非閏年   | `2023-02-28`       | 閏年でない         |
| 月末     | `2024-01-31`       | 各月の最終日       |

### タイムゾーン

| ケース     | 値                 | 説明             |
| ---------- | ------------------ | ---------------- |
| UTC        | `Z`                | 協定世界時       |
| 日本時間   | `+09:00`           | JST              |
| 日付変更線 | `+12:00`, `-12:00` | 極端なオフセット |
| 夏時間境界 | DST切り替え時      | 時刻のずれ       |

```typescript
const edgeCaseDates = [
  new Date(0), // epoch
  new Date("1969-12-31"), // before epoch
  new Date("9999-12-31"), // far future
  new Date("2024-02-29"), // leap year
  new Date("2023-02-28"), // non-leap year
  new Date("2024-01-31"), // month end
  new Date("invalid"), // Invalid Date
];
```

---

## オブジェクト

### 構造

| ケース         | 値                    | 説明             |
| -------------- | --------------------- | ---------------- |
| 空オブジェクト | `{}`                  | プロパティなし   |
| null           | `null`                | オブジェクトなし |
| undefined      | `undefined`           | 未定義           |
| 循環参照       | 自己参照              | シリアライズ問題 |
| プロトタイプ   | `Object.create(null)` | プロトタイプなし |

```typescript
const circularRef = { a: 1 };
circularRef.self = circularRef;

const edgeCaseObjects = [
  null,
  undefined,
  {},
  { a: undefined },
  { a: null },
  Object.create(null), // no prototype
  circularRef, // circular reference
  Object.freeze({ a: 1 }), // frozen
  new Proxy({}, {}), // proxy
];
```

---

## 型変換

### 暗黙の型変換

| 入力        | Boolean | Number | String              |
| ----------- | ------- | ------ | ------------------- |
| `""`        | `false` | `0`    | `""`                |
| `"0"`       | `true`  | `0`    | `"0"`               |
| `"1"`       | `true`  | `1`    | `"1"`               |
| `[]`        | `true`  | `0`    | `""`                |
| `[1]`       | `true`  | `1`    | `"1"`               |
| `{}`        | `true`  | `NaN`  | `"[object Object]"` |
| `null`      | `false` | `0`    | `"null"`            |
| `undefined` | `false` | `NaN`  | `"undefined"`       |

---

## ファイル・I/O

### ファイル

| ケース             | 説明             |
| ------------------ | ---------------- |
| 0バイトファイル    | 空ファイル       |
| 大容量ファイル     | GB単位           |
| 読み取り専用       | パーミッション   |
| 存在しない         | ファイルなし     |
| ロック中           | 他プロセス使用中 |
| シンボリックリンク | リンク解決       |

### パス

| ケース   | 値          |
| -------- | ----------- |
| 空パス   | `""`        |
| カレント | `.`         |
| 親       | `..`        |
| ルート   | `/`         |
| 長いパス | 260文字以上 |

---

## 並行処理

| ケース       | 説明             |
| ------------ | ---------------- |
| 競合状態     | 同時アクセス     |
| デッドロック | 相互待ち         |
| タイムアウト | 応答なし         |
| キャンセル   | 処理中断         |
| 再試行       | リトライロジック |

---

## チェックリスト

### 数値テスト

- [ ] 0を処理できるか？
- [ ] 負の数を処理できるか？
- [ ] 最大/最小値を処理できるか？
- [ ] NaN/Infinityを処理できるか？

### 文字列テスト

- [ ] 空文字列を処理できるか？
- [ ] 空白のみを処理できるか？
- [ ] Unicode文字を処理できるか？
- [ ] 特殊文字をエスケープしているか？

### コレクションテスト

- [ ] 空のコレクションを処理できるか？
- [ ] 単一要素を処理できるか？
- [ ] 大量データを処理できるか？
- [ ] null/undefinedを含む場合は？

### 日付テスト

- [ ] 閏年を処理できるか？
- [ ] タイムゾーンを考慮しているか？
- [ ] 無効な日付を拒否できるか？
