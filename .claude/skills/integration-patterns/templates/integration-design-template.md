# 統合設計ドキュメント

## 基本情報

| 項目 | 値 |
|------|-----|
| プロジェクト名 | {プロジェクト名} |
| 作成日 | {YYYY-MM-DD} |
| 作成者 | {作成者名} |
| バージョン | {1.0.0} |

## 1. 統合概要

### 目的

{この統合の目的と達成したいゴールを記述}

### スコープ

- 対象システム: {統合対象システムのリスト}
- 対象データ: {統合対象データのリスト}
- 対象外: {スコープ外の項目}

### 要件

#### 機能要件

- [ ] {機能要件1}
- [ ] {機能要件2}
- [ ] {機能要件3}

#### 非機能要件

| 要件 | 目標値 | 備考 |
|------|-------|------|
| レスポンス時間 | < {X}秒 | |
| スループット | {X} req/秒 | |
| 可用性 | {X}% | |
| データ整合性 | {eventually/strong} | |

## 2. アーキテクチャ設計

### システム構成図

```
{システム構成図をASCIIアートまたはMermaidで記述}

例:
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   System A   │────►│  MCP Server  │────►│   System B   │
└──────────────┘     └──────────────┘     └──────────────┘
```

### 統合パターン

選択したパターン: {パターン名}

選択理由:
- {理由1}
- {理由2}

代替案と却下理由:
| パターン | 却下理由 |
|---------|---------|
| {パターンA} | {理由} |
| {パターンB} | {理由} |

### データフロー

```
{データフローをASCIIアートまたはMermaidで記述}

例:
Source → Transform → Validate → Destination
```

## 3. インターフェース仕様

### System A インターフェース

#### エンドポイント

| メソッド | パス | 説明 |
|---------|------|------|
| {GET/POST} | {/api/resource} | {説明} |

#### リクエスト例

```json
{
  "field1": "value1",
  "field2": 123
}
```

#### レスポンス例

```json
{
  "status": "success",
  "data": {}
}
```

### System B インターフェース

{同様に記述}

## 4. メッセージ/イベント仕様

### イベント一覧

| イベント名 | トリガー | ペイロード |
|-----------|---------|-----------|
| {EventName} | {トリガー条件} | {ペイロード概要} |

### イベントスキーマ

#### {EventName}

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "eventId": { "type": "string" },
    "timestamp": { "type": "string", "format": "date-time" },
    "data": {
      "type": "object",
      "properties": {
        // イベント固有のプロパティ
      }
    }
  },
  "required": ["eventId", "timestamp", "data"]
}
```

## 5. エラーハンドリング

### エラー分類

| エラータイプ | 説明 | 対応アクション |
|-------------|------|--------------|
| 接続エラー | 外部システムへの接続失敗 | リトライ |
| タイムアウト | 処理時間超過 | リトライ/キャンセル |
| バリデーションエラー | 入力データ不正 | 拒否/通知 |
| 認証エラー | 認証失敗 | 再認証/アラート |
| システムエラー | 予期しないエラー | ログ/アラート |

### リトライ戦略

| 条件 | リトライ回数 | 間隔 | バックオフ |
|------|------------|------|-----------|
| 接続エラー | {N}回 | {X}秒 | {exponential/linear} |
| タイムアウト | {N}回 | {X}秒 | {exponential/linear} |
| 429 Rate Limit | {N}回 | Retry-After | - |

### Dead Letter Queue

- 使用: {Yes/No}
- 保持期間: {X日}
- 再処理方法: {手動/自動/スケジュール}

## 6. セキュリティ

### 認証方式

選択: {API Key / OAuth 2.0 / JWT / mTLS}

設定:
- {認証関連の設定項目}

### 認可

| 操作 | 必要権限 |
|------|---------|
| {操作} | {権限/スコープ} |

### データ保護

- 転送時暗号化: {TLS 1.2+}
- 保存時暗号化: {AES-256}
- 機密データマスキング: {対象フィールド}

## 7. 監視・運用

### メトリクス

| メトリクス | 閾値 | アラート条件 |
|-----------|------|------------|
| エラー率 | < {X}% | {X}%超過で警告 |
| レイテンシ | < {X}ms | p95が{X}ms超過で警告 |
| スループット | > {X}/秒 | {X}未満で警告 |

### ログ

| ログタイプ | 保持期間 | 用途 |
|-----------|---------|------|
| アクセスログ | {X}日 | 監査 |
| エラーログ | {X}日 | トラブルシューティング |
| デバッグログ | {X}日 | 開発 |

### アラート

| 条件 | 重要度 | 通知先 |
|------|-------|-------|
| {条件} | {Critical/Warning/Info} | {通知先} |

## 8. テスト計画

### 単体テスト

- [ ] {テスト項目1}
- [ ] {テスト項目2}

### 統合テスト

- [ ] 正常系フロー
- [ ] エラーハンドリング
- [ ] リトライロジック
- [ ] タイムアウト動作

### 性能テスト

| シナリオ | 目標 | 方法 |
|---------|------|------|
| ピーク負荷 | {X} req/秒 | {ツール/方法} |
| 持続負荷 | {X}時間 | {ツール/方法} |

## 9. デプロイ計画

### 前提条件

- [ ] {前提条件1}
- [ ] {前提条件2}

### デプロイ手順

1. {手順1}
2. {手順2}
3. {手順3}

### ロールバック手順

1. {ロールバック手順1}
2. {ロールバック手順2}

## 10. リスクと軽減策

| リスク | 影響度 | 発生確率 | 軽減策 |
|-------|-------|---------|-------|
| {リスク} | {高/中/低} | {高/中/低} | {軽減策} |

## 付録

### 用語集

| 用語 | 説明 |
|------|------|
| {用語} | {説明} |

### 参考資料

- {参考資料1}
- {参考資料2}

### 変更履歴

| バージョン | 日付 | 変更者 | 変更内容 |
|-----------|------|-------|---------|
| 1.0.0 | {日付} | {変更者} | 初版作成 |
