# バージョン範囲指定パターン

## 概要

package.jsonでの依存関係バージョン指定には、様々なパターンがあります。
適切なパターンを選択することで、安定性と更新性のバランスを取ることができます。

## パターン一覧

### 1. キャレット (^) - 推奨デフォルト

**形式**: `^X.Y.Z`

**動作**: Minor と Patch の更新を許可

**詳細**:

```
^1.2.3  :=  >=1.2.3 <2.0.0
^0.2.3  :=  >=0.2.3 <0.3.0  (注意: 0.x.xでは異なる動作)
^0.0.3  :=  >=0.0.3 <0.0.4  (注意: 0.0.xではPatchも固定)
```

**使用場面**:

- 一般的なライブラリ依存
- semver準拠が信頼できるパッケージ
- 自動的に新機能とバグ修正を取り込みたい場合

**メリット**:

- 自動的にバグ修正を受け取れる
- 新機能も自動的に利用可能
- メンテナンス負荷が低い

**デメリット**:

- Minor更新で予期しない動作変更の可能性
- 依存関係の自動更新で問題が発生する可能性

### 2. チルダ (~) - 安定性重視

**形式**: `~X.Y.Z`

**動作**: Patch の更新のみ許可

**詳細**:

```
~1.2.3  :=  >=1.2.3 <1.3.0
~1.2    :=  >=1.2.0 <1.3.0
~1      :=  >=1.0.0 <2.0.0
```

**使用場面**:

- クリティカルなシステムの依存
- Minor更新でも影響が懸念される場合
- バグ修正は欲しいが新機能は慎重に取り込みたい場合

**メリット**:

- セキュリティパッチは自動適用
- 機能変更による影響を受けにくい

**デメリット**:

- 新機能を手動で更新する必要がある
- 長期間更新しないと技術的負債が蓄積

### 3. 固定バージョン - 最大の安定性

**形式**: `X.Y.Z`

**動作**: 指定バージョンのみ使用

**使用場面**:

- 特定バージョンでのみ動作が保証される
- 再現性が最重要（CI/CDビルド等）
- バージョン間の挙動差異が大きいパッケージ

**メリット**:

- 完全な再現性
- 予期しない変更が起こらない

**デメリット**:

- セキュリティパッチも手動更新が必要
- メンテナンス負荷が高い
- 他のパッケージとの依存関係競合が起きやすい

### 4. 範囲指定

**形式**: `>=X.Y.Z <A.B.C`

**動作**: 指定範囲内の任意のバージョン

**詳細**:

```
>=1.2.3 <2.0.0  # ^1.2.3と同等
>=1.2.3 <=1.5.0 # 1.2.3から1.5.0まで
>1.0.0 <2.0.0   # 1.0.0より大きく2.0.0未満
```

**使用場面**:

- 特定の範囲のみ互換性がある場合
- ピア依存の指定
- 複雑な互換性要件がある場合

### 5. ハイフン範囲

**形式**: `X.Y.Z - A.B.C`

**動作**: 指定範囲を含む

**詳細**:

```
1.2.3 - 2.3.4  :=  >=1.2.3 <=2.3.4
```

### 6. OR 結合

**形式**: `X.Y.Z || A.B.C`

**動作**: いずれかの条件を満たす

**詳細**:

```
^1.0.0 || ^2.0.0  # 1.x.x または 2.x.x
```

**使用場面**:

- 複数のMajorバージョンをサポートする場合
- ピア依存の柔軟な指定

## 選択ガイドライン

### dependencies (本番依存)

| パッケージ特性               | 推奨パターン | 理由                     |
| ---------------------------- | ------------ | ------------------------ |
| 成熟したライブラリ           | `^X.Y.Z`     | semver準拠が信頼できる   |
| 頻繁に更新されるパッケージ   | `~X.Y.Z`     | 予期しない変更を防ぐ     |
| フレームワーク本体           | `^X.Y.Z`     | エコシステム全体の互換性 |
| セキュリティ重要なパッケージ | `^X.Y.Z`     | パッチの自動適用         |

### devDependencies (開発依存)

| パッケージ特性   | 推奨パターン | 理由               |
| ---------------- | ------------ | ------------------ |
| テストツール     | `^X.Y.Z`     | 新機能を活用       |
| ビルドツール     | `~X.Y.Z`     | 安定性優先         |
| Linter/Formatter | `^X.Y.Z`     | 新ルールを取り込む |
| TypeScript       | `~X.Y.Z`     | 型チェックの安定性 |

### peerDependencies (ピア依存)

| 状況          | 推奨パターン         | 理由             |
| ------------- | -------------------- | ---------------- |
| 単一Major対応 | `^X.0.0`             | 広い範囲をカバー |
| 複数Major対応 | `^X.0.0 \|\| ^Y.0.0` | 柔軟性           |
| 特定範囲のみ  | `>=X.Y.Z <A.B.C`     | 明示的な互換性   |

## 禁止パターン

### 使用禁止

| パターン            | 理由                               |
| ------------------- | ---------------------------------- |
| `*`                 | 再現性の完全な喪失                 |
| `latest`            | 再現性の喪失、予期しない破壊的変更 |
| `>X.Y.Z` (上限なし) | 将来のMajor変更を許可              |

### 使用注意

| パターン  | 注意点                 |
| --------- | ---------------------- |
| `>=X.Y.Z` | 上限がないと危険       |
| `X.Y.x`   | 曖昧性がある           |
| `X.Y`     | 省略形式、明確ではない |

## チェックリスト

### バージョン範囲指定時

- [ ] パッケージの成熟度を評価したか？
- [ ] semver準拠度を確認したか？
- [ ] 本番/開発/ピアの区分に応じたパターンを選択したか？
- [ ] 禁止パターンを使用していないか？

### バージョン範囲レビュー時

- [ ] `*`や`latest`が使用されていないか？
- [ ] 上限なしの範囲指定がないか？
- [ ] 0.x.xパッケージへの依存が適切に制限されているか？
