# アップグレード評価テンプレート

## 基本情報

| 項目             | 値                      |
| ---------------- | ----------------------- |
| パッケージ名     | <!-- 例: lodash -->     |
| 現在のバージョン | <!-- 例: 4.17.19 -->    |
| 目標バージョン   | <!-- 例: 4.17.21 -->    |
| 評価日           | <!-- 例: 2025-11-27 --> |
| 評価者           | <!-- 例: .claude/agents/dep-mgr.md -->   |

## バージョン変更の分類

### 変更タイプ

- [ ] **Major** (X.y.z → (X+1).0.0) - 破壊的変更
- [ ] **Minor** (x.Y.z → x.(Y+1).0) - 後方互換機能追加
- [ ] **Patch** (x.y.Z → x.y.(Z+1)) - バグ修正
- [ ] **ダウングレード** - バージョンを下げる

### リスクレベル

- [ ] 🔴 **高**: Major変更または0.x.xからの更新
- [ ] 🟡 **中**: Minor変更
- [ ] 🟢 **低**: Patch変更

## 変更内容の調査

### CHANGELOGの確認

**CHANGELOG URL**: <!-- 例: https://github.com/lodash/lodash/blob/main/CHANGELOG.md -->

**主要な変更点**:

1. <!-- 変更点1 -->
2. <!-- 変更点2 -->
3. <!-- 変更点3 -->

### 破壊的変更

| 変更内容                         | 影響を受けるコード          | 対応方法                               |
| -------------------------------- | --------------------------- | -------------------------------------- |
| <!-- 例: getUser()の引数追加 --> | <!-- 例: src/auth.js:45 --> | <!-- 例: optionsオブジェクトを追加 --> |

### 非推奨化された機能

| 機能                       | 代替手段                   | 削除予定バージョン  |
| -------------------------- | -------------------------- | ------------------- |
| <!-- 例: oldFunction() --> | <!-- 例: newFunction() --> | <!-- 例: v3.0.0 --> |

## 影響範囲の調査

### プロジェクト内の使用箇所

**検索コマンド**:

```bash
grep -r "from 'パッケージ名'" src/
grep -r "require('パッケージ名')" src/
```

**使用ファイル数**: <!-- 例: 15ファイル -->

**主要な使用箇所**:
| ファイル | 行番号 | 使用方法 |
|---------|-------|---------|
| <!-- 例: src/utils.js --> | <!-- 例: 12, 45, 78 --> | <!-- 例: _.debounce, _.throttle --> |

### 影響度スコアリング

| 要因             | スコア (1-10) | 備考                                 |
| ---------------- | ------------- | ------------------------------------ |
| 使用箇所数       | <!-- 1-10 --> | <!-- 例: 15箇所なので5点 -->         |
| 変更の複雑さ     | <!-- 1-10 --> | <!-- 例: 単純な名前変更なので2点 --> |
| テストカバレッジ | <!-- 1-10 --> | <!-- 例: 80%なので3点(10-8) -->      |
| 本番への影響     | <!-- 1-10 --> | <!-- 例: 認証機能なので8点 -->       |

**総合影響度**: <!-- (合計 / 4) 例: 4.5 -->

## 対応戦略

### 選択した戦略

- [ ] **段階的移行**: 中間バージョンを経由
- [ ] **一括移行**: 直接目標バージョンへ
- [ ] **並行運用**: 新旧バージョンを一時的に共存
- [ ] **フィーチャーフラグ**: フラグで制御
- [ ] **移行延期**: 現在のバージョンを維持

**選択理由**: <!-- 例: 影響範囲が限定的で、テストカバレッジが高いため一括移行を選択 -->

### 必要な対応

- [ ] コード変更
- [ ] テスト修正
- [ ] 設定変更
- [ ] ドキュメント更新
- [ ] パフォーマンステスト
- [ ] セキュリティレビュー

## 実装計画

### Phase 1: 準備 (目標: <!-- 日付 -->)

- [ ] CHANGELOGの詳細確認
- [ ] 影響範囲の完全なリストアップ
- [ ] ロールバック計画の策定
- [ ] テスト計画の作成

### Phase 2: 検証環境での実装 (目標: <!-- 日付 -->)

- [ ] フィーチャーブランチの作成
- [ ] パッケージの更新
- [ ] コードの修正
- [ ] ユニットテストの実行・修正
- [ ] ビルドの確認

### Phase 3: ステージングでの検証 (目標: <!-- 日付 -->)

- [ ] ステージング環境へのデプロイ
- [ ] E2Eテストの実行
- [ ] パフォーマンス測定
- [ ] ステークホルダーの承認

### Phase 4: 本番リリース (目標: <!-- 日付 -->)

- [ ] メンテナンスウィンドウの設定
- [ ] バックアップの取得
- [ ] 本番デプロイ
- [ ] スモークテスト
- [ ] モニタリング強化

## リスクとミティゲーション

| リスク                     | 発生確率          | 影響度            | ミティゲーション                    |
| -------------------------- | ----------------- | ----------------- | ----------------------------------- |
| <!-- 例: APIの動作変更 --> | <!-- 高/中/低 --> | <!-- 高/中/低 --> | <!-- 例: 事前にテスト環境で検証 --> |

## ロールバック計画

**ロールバックトリガー**:

- [ ] エラーレートが5%を超えた場合
- [ ] レスポンスタイムが2倍以上になった場合
- [ ] クリティカルな機能が動作しない場合

**ロールバック手順**:

```bash
# 1. package.jsonを前のバージョンに戻す
git checkout HEAD^ -- package.json pnpm-lock.yaml

# 2. 依存関係を再インストール
pnpm install

# 3. アプリケーションを再起動
pnpm start
```

**ロールバック所要時間**: <!-- 例: 約15分 -->

## テスト計画

### 必須テスト

- [ ] ユニットテスト実行
- [ ] 統合テスト実行
- [ ] E2Eテスト実行
- [ ] パフォーマンステスト
- [ ] セキュリティスキャン

### テスト結果

| テストタイプ   | 結果           | 備考                        |
| -------------- | -------------- | --------------------------- |
| ユニットテスト | <!-- ✅/❌ --> | <!-- 例: 150/150 passed --> |
| 統合テスト     | <!-- ✅/❌ --> | <!-- 例: 45/45 passed -->   |
| E2Eテスト      | <!-- ✅/❌ --> | <!-- 例: 30/30 passed -->   |

## 承認

| 役割         | 承認者        | 日付          | 承認 |
| ------------ | ------------- | ------------- | ---- |
| 開発リード   | <!-- 名前 --> | <!-- 日付 --> | ☐    |
| テストリード | <!-- 名前 --> | <!-- 日付 --> | ☐    |
| 運用担当     | <!-- 名前 --> | <!-- 日付 --> | ☐    |

## 事後レビュー

### 実施結果

| 項目             | 予定          | 実績            | 備考 |
| ---------------- | ------------- | --------------- | ---- |
| 開始日           | <!-- 日付 --> | <!-- 日付 -->   |      |
| 完了日           | <!-- 日付 --> | <!-- 日付 -->   |      |
| 発生した問題数   | -             | <!-- 数 -->     |      |
| ロールバック発生 | -             | <!-- Yes/No --> |      |

### 学んだこと

1. <!-- 学習事項1 -->
2. <!-- 学習事項2 -->
3. <!-- 学習事項3 -->

### 改善点

1. <!-- 改善点1 -->
2. <!-- 改善点2 -->
3. <!-- 改善点3 -->
