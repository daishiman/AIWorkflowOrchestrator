# ユースケースシナリオパターン

## 概要

シナリオはユースケースの具体的な実行経路を記述します。
メインシナリオ、代替シナリオ、例外シナリオの3種類があります。

## シナリオの種類

### 1. メインシナリオ（Main Success Scenario）

**定義**: アクターの目標が正常に達成される基本的な流れ

**特徴**:

- 最も一般的な実行パス
- エラーなしで完了
- ビジネス価値を最大化

**記述ポイント**:

- シンプルに保つ
- 1ステップ1アクション
- 条件分岐を含めない

### 2. 代替シナリオ（Alternative Scenarios）

**定義**: 目標を達成する別の正常な経路

**特徴**:

- 異なる条件での正常処理
- 最終的には成功
- ビジネスルールの分岐

**記述ポイント**:

- 分岐ポイントを明示
- 合流ポイントを明示
- メインシナリオとの差分のみ記述

### 3. 例外シナリオ（Exception Scenarios）

**定義**: エラーや異常により目標が達成されない流れ

**特徴**:

- エラー処理
- キャンセル処理
- リカバリー処理

**記述ポイント**:

- エラー条件を明確に
- システムの応答を明確に
- ユーザーの次のアクションを示す

## シナリオ記述テンプレート

### メインシナリオ

```markdown
## メインシナリオ（正常系）

1. [アクター]が[アクション]する
2. システムが[検証/処理]を行う
3. システムが[結果]を表示する
4. [アクター]が[次のアクション]を行う
5. システムが[処理]を実行する
6. システムが[完了]を通知する
```

### 代替シナリオ

```markdown
## 代替シナリオ

### A: [条件]の場合（ステップXで分岐）

A1. [アクター]が[別のアクション]を選択する
A2. システムが[別の処理]を行う
A3. ステップ[Y]に合流する

### B: [別の条件]の場合（ステップXで分岐）

B1. [異なる処理]
B2. [結果]
```

### 例外シナリオ

```markdown
## 例外シナリオ

### E1: [エラー条件]（ステップXで発生）

E1-1. システムが[エラーメッセージ]を表示する
E1-2. [アクター]が[回復アクション]を行う
E1-3. ステップ[X]に戻る

### E2: [致命的エラー]（いつでも発生）

E2-1. システムが[エラー]を記録する
E2-2. システムが[通知]を送信する
E2-3. ユースケースが終了する
```

## シナリオパターン集

### パターン1: CRUD操作

**作成シナリオ**:

```
1. ユーザーが「新規作成」を選択
2. システムが入力フォームを表示
3. ユーザーが必要情報を入力
4. ユーザーが「保存」をクリック
5. システムが入力を検証
6. システムがデータを保存
7. システムが成功メッセージを表示
```

**参照シナリオ**:

```
1. ユーザーが検索条件を入力
2. システムが結果一覧を表示
3. ユーザーが項目を選択
4. システムが詳細を表示
```

**更新シナリオ**:

```
1. ユーザーが対象を選択
2. システムが編集フォームを表示
3. ユーザーが変更を入力
4. ユーザーが「更新」をクリック
5. システムが変更を検証
6. システムがデータを更新
7. システムが成功メッセージを表示
```

**削除シナリオ**:

```
1. ユーザーが対象を選択
2. ユーザーが「削除」を選択
3. システムが確認ダイアログを表示
4. ユーザーが「確認」をクリック
5. システムがデータを削除
6. システムが成功メッセージを表示
```

### パターン2: 認証・認可

**ログインシナリオ**:

```
1. ユーザーがログインページにアクセス
2. システムがログインフォームを表示
3. ユーザーが認証情報を入力
4. ユーザーが「ログイン」をクリック
5. システムが認証情報を検証
6. システムがセッションを作成
7. システムがホームページにリダイレクト

代替A（2FA有効時）:
A1. システムが2FAコード入力を要求
A2. ユーザーがコードを入力
A3. システムがコードを検証
A4. ステップ6に合流

例外E1（認証失敗）:
E1-1. システムがエラーメッセージを表示
E1-2. 失敗回数を記録
E1-3. ステップ2に戻る

例外E2（アカウントロック）:
E2-1. システムがロックメッセージを表示
E2-2. システムが管理者に通知
E2-3. ユースケース終了
```

### パターン3: ワークフロー

**承認フローシナリオ**:

```
1. 申請者が申請を作成
2. システムが申請を登録
3. システムが承認者に通知
4. 承認者が申請を確認
5. 承認者が「承認」を選択
6. システムが状態を更新
7. システムが申請者に通知

代替A（差し戻し）:
A1. 承認者が「差し戻し」を選択
A2. 承認者がコメントを入力
A3. システムが状態を更新
A4. システムが申請者に通知
A5. ユースケース終了

代替B（却下）:
B1. 承認者が「却下」を選択
B2. 承認者が理由を入力
B3. システムが状態を更新
B4. システムが申請者に通知
B5. ユースケース終了
```

### パターン4: トランザクション

**購入シナリオ**:

```
1. 顧客がカートを確認
2. 顧客が「購入手続き」を選択
3. システムが配送先入力を表示
4. 顧客が配送先を入力
5. システムが支払い方法選択を表示
6. 顧客が支払い方法を選択
7. システムが注文確認を表示
8. 顧客が「注文確定」をクリック
9. システムが在庫を確保
10. システムが決済を処理
11. システムが注文を確定
12. システムが確認メールを送信
13. システムが完了画面を表示

例外E1（在庫切れ）:
E1-1. システムがメッセージを表示
E1-2. 在庫切れ商品を表示
E1-3. ステップ1に戻る

例外E2（決済失敗）:
E2-1. システムがエラーメッセージを表示
E2-2. 在庫確保を解放
E2-3. ステップ5に戻る
```

## シナリオ記述のベストプラクティス

### すべきこと

1. **主語を明確に**
   - ✅ 「ユーザーが〜する」「システムが〜する」
   - ❌ 「〜される」（主語不明）

2. **1ステップ1アクション**
   - ✅ 「ユーザーが保存をクリックする」
   - ❌ 「ユーザーが入力して保存する」

3. **観測可能な動詞を使用**
   - ✅ 「表示する」「送信する」「保存する」
   - ❌ 「処理する」「管理する」（曖昧）

4. **番号付けを使用**
   - メインシナリオ: 1, 2, 3...
   - 代替シナリオ: A1, A2 / B1, B2
   - 例外シナリオ: E1-1, E1-2

### 避けるべきこと

1. **UIの詳細を含めない**
   - ❌ 「青いボタンをクリック」
   - ✅ 「保存ボタンをクリック」

2. **実装詳細を含めない**
   - ❌ 「DBにINSERTする」
   - ✅ 「データを保存する」

3. **条件分岐をメインに入れない**
   - ❌ 「もし〜なら〜する」
   - ✅ 代替シナリオで記述

## シナリオ完全性チェックリスト

- [ ] メインシナリオが定義されているか？
- [ ] すべての分岐点で代替シナリオがあるか？
- [ ] すべてのエラー条件で例外シナリオがあるか？
- [ ] 各ステップで主語が明確か？
- [ ] 分岐・合流ポイントが明示されているか？
- [ ] シナリオ間の番号参照が正しいか？
