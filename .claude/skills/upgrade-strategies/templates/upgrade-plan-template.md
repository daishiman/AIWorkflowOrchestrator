# アップグレード計画テンプレート

## 基本情報

| 項目 | 値 |
|-----|-----|
| 計画作成日 | <!-- 例: 2025-11-27 --> |
| 作成者 | <!-- 例: @dep-mgr --> |
| プロジェクト | <!-- 例: my-project --> |
| 計画期間 | <!-- 例: 2025-11-27 〜 2025-12-01 --> |

## アップグレード概要

### 目的

<!-- このアップグレードの目的を記載 -->
- [ ] セキュリティ脆弱性の修正
- [ ] 新機能へのアクセス
- [ ] パフォーマンス改善
- [ ] 技術的負債の解消
- [ ] その他: <!-- 詳細 -->

### スコープ

| カテゴリ | パッケージ数 | 備考 |
|---------|------------|-----|
| Patch更新 | <!-- 数 --> | <!-- 備考 --> |
| Minor更新 | <!-- 数 --> | <!-- 備考 --> |
| Major更新 | <!-- 数 --> | <!-- 備考 --> |
| セキュリティ | <!-- 数 --> | <!-- 備考 --> |

## 更新対象パッケージ

### セキュリティアップデート（優先）

| パッケージ | 現在 | 目標 | CVE/GHSA | 重大度 |
|-----------|-----|------|----------|-------|
| <!-- 名前 --> | <!-- version --> | <!-- version --> | <!-- CVE-xxx --> | <!-- Critical/High/Medium/Low --> |

### Patch/Minor更新

| パッケージ | 現在 | 目標 | 変更タイプ | 備考 |
|-----------|-----|------|----------|-----|
| <!-- 名前 --> | <!-- version --> | <!-- version --> | <!-- Patch/Minor --> | <!-- 備考 --> |

### Major更新

| パッケージ | 現在 | 目標 | 破壊的変更 | 移行ガイド |
|-----------|-----|------|----------|-----------|
| <!-- 名前 --> | <!-- version --> | <!-- version --> | <!-- 概要 --> | <!-- URL --> |

## リスク評価

### リスクマトリックス

| リスク | 確率 | 影響度 | リスクスコア | 軽減策 |
|-------|-----|-------|------------|-------|
| ビルド失敗 | <!-- 高/中/低 --> | <!-- 高/中/低 --> | <!-- 数値 --> | <!-- 対策 --> |
| テスト失敗 | <!-- 高/中/低 --> | <!-- 高/中/低 --> | <!-- 数値 --> | <!-- 対策 --> |
| 本番障害 | <!-- 高/中/低 --> | <!-- 高/中/低 --> | <!-- 数値 --> | <!-- 対策 --> |
| パフォーマンス低下 | <!-- 高/中/低 --> | <!-- 高/中/低 --> | <!-- 数値 --> | <!-- 対策 --> |

### 総合リスクレベル

- [ ] 🟢 低リスク（自動適用可能）
- [ ] 🟡 中リスク（段階的アップグレード）
- [ ] 🔴 高リスク（計画的アップグレード必須）

## 選択した戦略

### 戦略

- [ ] 段階的アップグレード
- [ ] 一括アップグレード
- [ ] セキュリティファースト
- [ ] フィーチャーフラグ型
- [ ] その他: <!-- 詳細 -->

### 戦略選択の理由

<!-- 選択した戦略の理由を記載 -->

## 事前準備

### テストカバレッジ

| テストタイプ | 現在のカバレッジ | 目標カバレッジ | 状態 |
|------------|----------------|--------------|------|
| ユニットテスト | <!-- %% --> | <!-- %% --> | ☐ |
| 統合テスト | <!-- %% --> | <!-- %% --> | ☐ |
| E2Eテスト | <!-- %% --> | <!-- %% --> | ☐ |

### 準備タスク

- [ ] テストカバレッジの確認・改善
- [ ] ベースラインのテスト結果を記録
- [ ] フィーチャーブランチを作成
- [ ] ロールバック手順を確認
- [ ] 関係者への通知
- [ ] メンテナンスウィンドウの設定

## 実施計画

### Phase 1: 準備 (<!-- 日付 -->)

- [ ] テストカバレッジを確認
- [ ] ベースラインを記録
- [ ] フィーチャーブランチを作成

```bash
git checkout -b upgrade/dependency-update-$(date +%Y%m%d)
```

### Phase 2: セキュリティ更新 (<!-- 日付 -->)

- [ ] セキュリティパッチを適用

```bash
pnpm audit --fix
pnpm test
```

- [ ] テストを実行
- [ ] コミット

### Phase 3: Patch/Minor更新 (<!-- 日付 -->)

- [ ] Patch更新を適用

```bash
pnpm update
pnpm test
```

- [ ] Minor更新を適用（1パッケージずつ）

```bash
pnpm update <package-name>@latest
pnpm test
```

- [ ] テストを実行
- [ ] コミット

### Phase 4: Major更新 (<!-- 日付 -->)

- [ ] CHANGELOGを確認
- [ ] 移行ガイドに従ってコードを修正
- [ ] パッケージを更新

```bash
pnpm update <package-name>@<major-version>
```

- [ ] ビルドエラーを修正
- [ ] テストを修正・実行
- [ ] コミット

### Phase 5: 検証 (<!-- 日付 -->)

- [ ] 全テストスイートを実行
- [ ] パフォーマンステスト
- [ ] セキュリティスキャン
- [ ] コードレビュー
- [ ] ステージング環境でテスト

### Phase 6: 本番適用 (<!-- 日付 -->)

- [ ] PRをマージ
- [ ] 本番デプロイ
- [ ] スモークテスト
- [ ] モニタリング

## ロールバック計画

### トリガー条件

- [ ] エラーレートが5%を超えた場合
- [ ] レスポンスタイムが2倍以上になった場合
- [ ] クリティカル機能が動作しない場合

### ロールバック手順

```bash
# 1. リバートコミットを作成
git revert HEAD --no-edit

# 2. テスト
pnpm test --bail

# 3. 即座にデプロイ
# ...

# 4. 確認
```

### ロールバック担当者

- 主担当: <!-- 名前 -->
- 副担当: <!-- 名前 -->

## 検証チェックリスト

### 機能検証

- [ ] 認証・認可機能
- [ ] データ処理機能
- [ ] 外部API連携
- [ ] ユーザーインターフェース
- [ ] その他クリティカル機能

### 非機能検証

- [ ] パフォーマンス（レスポンスタイム）
- [ ] スケーラビリティ
- [ ] セキュリティスキャン
- [ ] アクセシビリティ

## コミュニケーション計画

### 関係者

| 役割 | 名前 | 通知タイミング |
|-----|-----|--------------|
| 開発リード | <!-- 名前 --> | 計画承認時、完了時 |
| QAリード | <!-- 名前 --> | テスト開始時 |
| 運用担当 | <!-- 名前 --> | デプロイ前後 |
| プロダクトオーナー | <!-- 名前 --> | 計画承認時、完了時 |

### 通知チャネル

- [ ] Slack: <!-- チャンネル名 -->
- [ ] メール: <!-- メーリングリスト -->
- [ ] その他: <!-- 詳細 -->

## 承認

| 役割 | 承認者 | 日付 | 承認 |
|-----|-------|-----|------|
| 開発リード | <!-- 名前 --> | <!-- 日付 --> | ☐ |
| QAリード | <!-- 名前 --> | <!-- 日付 --> | ☐ |
| 運用担当 | <!-- 名前 --> | <!-- 日付 --> | ☐ |

## 事後レビュー

### 実施結果

| 項目 | 予定 | 実績 | 差異 |
|-----|-----|-----|-----|
| 開始日 | <!-- 日付 --> | <!-- 日付 --> | |
| 完了日 | <!-- 日付 --> | <!-- 日付 --> | |
| ロールバック発生 | - | <!-- Yes/No --> | |
| 発生した問題数 | - | <!-- 数 --> | |

### 学んだこと

1. <!-- 学習事項1 -->
2. <!-- 学習事項2 -->
3. <!-- 学習事項3 -->

### 改善点

1. <!-- 改善点1 -->
2. <!-- 改善点2 -->
3. <!-- 改善点3 -->

## 添付資料

- [ ] 影響範囲分析レポート
- [ ] テスト結果レポート
- [ ] パフォーマンスベンチマーク
- [ ] セキュリティスキャン結果
