# 📚 依存スキル形式ガイド（v2.1.0統一フォーマット）

## 概要

このガイドは、エージェント作成時のYAML Frontmatter内「📚 依存スキル」セクションの標準形式を定義します。
全18エージェントで統一されたこの形式により、スキル参照の一貫性と可読性が向上します。

## 完全なテンプレート

```yaml
description: |
  [エージェントの役割説明 1-2段落]

  📚 依存スキル（X個）:
  このエージェントは以下のスキルに専門知識を分離しています。
  タスクに応じて必要なスキルのみを読み込んでください:

  - `.claude/skills/[skill-name-1]/SKILL.md`: [20-40文字の簡潔な説明]
  - `.claude/skills/[skill-name-2]/SKILL.md`: [20-40文字の簡潔な説明]
  - `.claude/skills/[skill-name-3]/SKILL.md`: [20-40文字の簡潔な説明]

  専門分野:
  - [専門領域1]: [具体的な技術/手法]
  - [専門領域2]: [具体的な技術/手法]

  使用タイミング:
  - [シチュエーション1]
  - [シチュエーション2]
  - [シチュエーション3]
  - [シチュエーション4]
  - [シチュエーション5]
```

## 必須ルール

### 1. スキル数のカウント

**正確な数を記載**:

- ✅ `📚 依存スキル（5個）:`
- ✅ `📚 依存スキル（11個）:`
- ❌ `📚 依存スキル:` （数の記載なし）
- ❌ `📚 依存スキル（複数）:` （曖昧な表現）

**カウント方法**:

```bash
# スキル行数をカウント
grep -c "^\s*-\s*\`\.claude/skills/" agent-file.md
```

### 2. フルパス形式

**各スキルは必ずフルパスで記載**:

- ✅ `.claude/skills/clean-code-practices/SKILL.md`
- ❌ `clean-code-practices` （スキル名のみ）
- ❌ `./skills/clean-code-practices/SKILL.md` （相対パス短縮形）

**パス構造**:

```
.claude/skills/[kebab-case-skill-name]/SKILL.md
```

### 3. スキル説明の長さ

**各スキル説明は20-40文字**:

- ✅ `Injection、XSS、CSRF等の脆弱性検出` （23文字）
- ✅ `Red-Green-Refactorサイクル、テストファースト` （28文字）
- ❌ `セキュリティ` （6文字、短すぎる）
- ❌ `Injection攻撃、XSS攻撃、CSRF攻撃、SQLインジェクション、コマンドインジェクション等の各種脆弱性を体系的に検出` （60文字、長すぎる）

**説明内容**:

- 核心機能を端的に表現
- 技術用語を適切に使用
- カンマ区切りで複数要素を列挙可能

### 4. 導入文の統一

**必ずこの文言を使用**:

```
このエージェントは以下のスキルに専門知識を分離しています。
タスクに応じて必要なスキルのみを読み込んでください:
```

**禁止パターン**:

- ❌ 「以下のスキルに依存します」（依存ではなく分離）
- ❌ 「必要なスキル:」（タスク応じて選択的であることを明示すべき）

### 5. 「パス:」行の削除

**旧形式（削除すべき）**:

```yaml
📚 依存スキル（5個）:
このエージェントは以下のスキルに専門知識を分離しています:
  - skill-name-1: 説明
  - skill-name-2: 説明

パス: .claude/skills/[スキル名]/SKILL.md  ← この行は不要
```

**新形式（v2.1.0）**:

```yaml
📚 依存スキル（5個）:
このエージェントは以下のスキルに専門知識を分離しています。
タスクに応じて必要なスキルのみを読み込んでください:

- `.claude/skills/skill-name-1/SKILL.md`: 説明1
- `.claude/skills/skill-name-2/SKILL.md`: 説明2
```

## セクション配置順序

YAML Frontmatter内の順序:

```yaml
description: |
  1. エージェント説明（1-2段落）

  2. 📚 依存スキル（X個）セクション

  3. 専門分野セクション（3-5項目）

  4. 使用タイミングセクション（5項目推奨）

  5. 英語プロアクティブヒント（オプション）
```

## 実例比較

### 悪い例（旧形式）

```yaml
description: |
  セキュリティ監査エージェント。

  依存スキル:
  - owasp-top-10
  - authentication-security

  パス: .claude/skills/[スキル名]/SKILL.md
```

**問題点**:

- スキル数のカウントなし
- フルパス記載なし
- 説明なし
- 導入文が不統一
- 「パス:」行が冗長

### 良い例（v2.1.0形式）

```yaml
description: |
  セキュリティ監査とコンプライアンス検証を専門とするエージェント。
  OWASP Top 10とCWE/SANSに基づき、脆弱性を体系的に検出します。

  📚 依存スキル（11個）:
  このエージェントは以下のスキルに専門知識を分離しています。
  タスクに応じて必要なスキルのみを読み込んでください:

  - `.claude/skills/owasp-top-10/SKILL.md`: Injection、XSS、CSRF等の脆弱性検出
  - `.claude/skills/authentication-security/SKILL.md`: 認証フロー、セッション管理の安全性評価
  - `.claude/skills/input-validation/SKILL.md`: 入力サニタイゼーションとZod検証

  専門分野:
  - OWASP Top 10脆弱性検出とCWE/SANSパターン
  - 認証・認可フローのセキュリティレビュー
  - 入力検証とサニタイゼーション戦略

  使用タイミング:
  - セキュリティ監査が必要な時
  - 脆弱性スキャンを実施する時
  - コンプライアンス検証時
  - 認証フローのレビュー時
  - 本番デプロイ前の最終チェック時
```

## チェックリスト

エージェント作成時、以下を確認:

### 📚 依存スキルセクション

- [ ] `📚 依存スキル（X個）:` でスキル数を正確にカウント
- [ ] 導入文が統一形式（「このエージェントは以下のスキルに...」）
- [ ] 全スキルがフルパス形式（`.claude/skills/[name]/SKILL.md`）
- [ ] 各スキル説明が20-40文字
- [ ] 「パス:」行が**ない**（フルパス各行記載済み）

### 専門分野セクション

- [ ] 3-5項目
- [ ] 各項目が「領域: 技術/手法」形式

### 使用タイミングセクション

- [ ] 5項目推奨
- [ ] 具体的なシチュエーション記述
- [ ] 「〜する時」「〜が必要な時」形式

## 自動検証

```bash
# スキル数カウント検証
SKILL_COUNT=$(grep -c "^\s*-\s*\`\.claude/skills/" .claude/agents/agent-name.md)
DECLARED_COUNT=$(grep "📚 依存スキル（.*個）:" .claude/agents/agent-name.md | sed -E 's/.*（([0-9]+)個）.*/\1/')

if [ "$SKILL_COUNT" -ne "$DECLARED_COUNT" ]; then
  echo "エラー: スキル数不一致（宣言: $DECLARED_COUNT、実際: $SKILL_COUNT）"
fi
```

## 移行ガイド

### 旧形式からの移行手順

1. **スキル数をカウント**:

   ```bash
   grep -c "- \." .claude/agents/agent-name.md
   ```

2. **ヘッダーを更新**:

   ```yaml
   📚 依存スキル:  →  📚 依存スキル（X個）:
   ```

3. **導入文を標準化**:

   ```
   このエージェントは以下のスキルに専門知識を分離しています。
   タスクに応じて必要なスキルのみを読み込んでください:
   ```

4. **各スキルをフルパス化**:

   ```yaml
   - skill-name: 説明
   ↓
   - `.claude/skills/skill-name/SKILL.md`: 説明
   ```

5. **「パス:」行を削除**:

   ```yaml
   パス: .claude/skills/[スキル名]/SKILL.md  ← 削除
   ```

6. **説明の長さを調整**（20-40文字）

## ベストプラクティス

### スキル説明の書き方

**良い例**:

- `Injection、XSS、CSRF等の脆弱性検出`
- `Red-Green-Refactorサイクル、テストファースト、小さなステップ`
- `PM2 ecosystem.config.js 設計と環境変数管理`

**悪い例**:

- `セキュリティ` （具体性なし）
- `テスト` （曖昧すぎる）
- `すべてのインジェクション攻撃、クロスサイトスクリプティング、クロスサイトリクエストフォージェリ、SQLインジェクション...` （冗長）

### スキル選択の粒度

**適切な粒度**:

- 5-8個: 標準的なエージェント
- 11-12個: 複雑なエージェント（sec-auditor、prompt-eng等）
- 3-4個: シンプルなエージェント

**過度な分離を避ける**:

- 20個以上のスキル依存は設計見直しを検討
- 関連性の高いスキルは統合を検討

## トラブルシューティング

### 問題1: スキル数が一致しない

**症状**: 宣言数と実際の行数が異なる

**原因**: カウントミス、スキル追加/削除時の更新忘れ

**解決策**:

```bash
# 実際のスキル数を確認
grep -c "^\s*-\s*\`\.claude/skills/" .claude/agents/agent-name.md

# ヘッダーを更新
# 📚 依存スキル（5個）: → 📚 依存スキル（7個）:
```

### 問題2: パスが相対形式

**症状**: `.claude/skills/...` ではなく `./skills/...` や `skill-name` のみ

**原因**: フルパス形式ルールの未適用

**解決策**:

```bash
# 全スキル参照をフルパス化
sed -i 's|- \([a-z-]*\):|- `.claude/skills/\1/SKILL.md`:|g' agent-file.md
```

### 問題3: 説明が長すぎる/短すぎる

**症状**: 60文字超の冗長説明、または10文字以下の簡略すぎる説明

**解決策**:

- 核心機能を1-3個の技術用語で表現
- カンマ区切りで列挙
- 目安: 20-40文字

## 変更履歴

| バージョン | 日付       | 変更内容                                            |
| ---------- | ---------- | --------------------------------------------------- |
| 1.0.0      | 2025-11-27 | 初版作成 - v2.1.0統一フォーマットのガイドライン策定 |
