# リスク分析手法

## 概要

リスク分析は、識別されたリスクの確率と影響度を評価し、
優先順位を決定するプロセスです。

## 確率・影響度マトリクス

### 基本フレームワーク

```
      影響度（Impact）
    低(1) 中(2) 高(3)
高 │ 3  │ 6  │ 9  │ 高
(3)│    │    │    │
   │────┼────┼────│
確 中 │ 2  │ 4  │ 6  │ 中
率(2)│    │    │    │
(P)│────┼────┼────│
低 │ 1  │ 2  │ 3  │ 低
(1)│    │    │    │

リスクスコア = 確率 × 影響度
```

### 5段階評価システム

**確率スケール**:
```
5: ほぼ確実 (>90%)
   - 過去に頻繁に発生
   - 発生条件が既に存在
   - 例: 新人が初めて使う技術でつまずく

4: 高い (70-90%)
   - 過去に何度か発生
   - 発生しやすい条件が揃っている
   - 例: 外部APIの一時的な障害

3: 中程度 (30-70%)
   - 発生する可能性もある
   - 条件次第で発生
   - 例: スケジュール遅延

2: 低い (10-30%)
   - 発生可能性は低い
   - 特殊な条件が揃わないと発生しない
   - 例: キーパーソンの退職

1: 稀 (<10%)
   - ほとんど発生しない
   - 過去に発生例なし
   - 例: データセンター全損
```

**影響度スケール**:
```
5: 壊滅的（Catastrophic）
   - プロジェクト中止
   - ビジネス目標達成不可
   - 例: セキュリティ侵害による事業停止

4: 重大（Major）
   - 3ヶ月以上の遅延
   - 50%以上の予算超過
   - 主要機能の削除
   - 例: コアアーキテクチャの再設計

3: 中程度（Moderate）
   - 1-3ヶ月の遅延
   - 20-50%の予算超過
   - スコープの調整で対応可能
   - 例: パフォーマンス問題による最適化

2: 軽微（Minor）
   - 1ヶ月以内の遅延
   - 10-20%の予算超過
   - 限定的な影響
   - 例: UI/UXの微調整

1: 無視可能（Negligible）
   - 影響なしまたは最小限
   - 通常業務内で吸収可能
   - 例: ドキュメントの誤字
```

### リスクレベル分類

**スコアベース分類**:
```
20-25: クリティカル（Critical）
  - 即座に対応
  - 経営層にエスカレーション
  - 専任チーム設置

15-19: 高（High）
  - 優先的に対応
  - 部門マネージャーに報告
  - 軽減策を計画

10-14: 中（Medium）
  - 計画的に対応
  - プロジェクトマネージャーが管理
  - 監視強化

6-9: 低（Low）
  - 監視継続
  - チームレベルで管理
  - 定期レビュー

1-5: 無視可能（Negligible）
  - 記録のみ
  - 受容可能
  - 特別な対応不要
```

### カラーコーディング

```
      影響度
    低    中    高
高 │緑色│黄色│赤色│
確 │    │    │    │
率 中 │緑色│黄色│橙色│
   │    │    │    │
低 │緑色│緑色│黄色│

赤: クリティカル（即座に対応）
橙: 高（優先対応）
黄: 中（計画的対応）
緑: 低（監視）
```

## 期待貨幣価値（EMV）

### 基本概念

EMV（Expected Monetary Value）は、
リスクの確率と金銭的影響を掛け合わせた期待値。

```
EMV = 確率 × 金銭的影響
```

### 計算例

**単一リスク**:
```
リスク: サーバー障害
確率: 20%
影響: -$100,000（復旧コスト + 機会損失）
EMV = 0.20 × (-$100,000) = -$20,000
```

**複数リスク**:
```
リスクA: データ移行失敗
  確率: 30%
  影響: -$50,000
  EMV: -$15,000

リスクB: サードパーティAPI障害
  確率: 10%
  影響: -$200,000
  EMV: -$20,000

リスクC: パフォーマンス問題
  確率: 40%
  影響: -$30,000
  EMV: -$12,000

合計EMV = -$47,000
```

### 正のリスク（機会）

```
機会A: 早期リリース
  確率: 30%
  利益: +$100,000
  EMV: +$30,000

機会B: 技術革新による競争優位
  確率: 20%
  利益: +$200,000
  EMV: +$40,000

合計EMV（機会） = +$70,000
```

### 意思決定への活用

**リスク対策のROI**:
```
リスク: セキュリティ侵害
確率（対策前）: 40%
影響: -$500,000
EMV（対策前）: -$200,000

対策: セキュリティ監査 + 脆弱性対策
コスト: $50,000
確率（対策後）: 10%
EMV（対策後）: -$50,000

期待利益 = (-$50,000) - (-$200,000) - $50,000
         = $100,000
ROI = $100,000 / $50,000 = 200%
```

### コンティンジェンシー予算

```
リスクEMV合計: -$100,000
コンティンジェンシー予算: $100,000 × 1.5 = $150,000
（50%のバッファ）
```

## モンテカルロシミュレーション

### 概要

確率分布を使ってランダムサンプリングを繰り返し、
結果の分布を予測する統計的手法。

### スケジュールリスク分析

**三点見積もり**:
```
タスクA:
  最良: 5日
  最も可能性が高い: 10日
  最悪: 20日

タスクB:
  最良: 3日
  最も可能性が高い: 5日
  最悪: 10日

タスクC:
  最良: 8日
  最も可能性が高い: 12日
  最悪: 25日
```

**シミュレーション結果（1000回実行）**:
```
合計期間の分布:
P10（10パーセンタイル）: 18日
P50（50パーセンタイル・中央値）: 28日
P80（80パーセンタイル）: 38日
P90（90パーセンタイル）: 45日
P95（95パーセンタイル）: 52日

推奨スケジュール:
コミット: P50 = 28日（50%の確率で達成）
バッファ込み: P80 = 38日（80%の確率で達成）
```

### コストリスク分析

```
開発コスト:
  最良: $80,000
  最も可能性が高い: $100,000
  最悪: $150,000

インフラコスト:
  最良: $20,000
  最も可能性が高い: $30,000
  最悪: $50,000

合計コスト分布:
P50: $130,000
P80: $160,000
P95: $190,000

予算設定:
ベースライン: $130,000
コンティンジェンシー: $30,000（P80 - P50）
マネジメントリザーブ: $30,000（P95 - P80）
合計予算: $190,000
```

### 実施ツール

**Excel / Google Sheets**:
- RAND関数、NORMINV関数
- データテーブル機能
- 手動実装可能

**専用ソフトウェア**:
- @RISK（Excel アドイン）
- Crystal Ball（Oracle）
- ModelRisk（Vose Software）

**Python実装**:
```python
import numpy as np
import matplotlib.pyplot as plt

def triangular_sample(best, likely, worst, size=1000):
    """三角分布からのサンプリング"""
    return np.random.triangular(best, likely, worst, size)

# タスク期間のシミュレーション
task_a = triangular_sample(5, 10, 20, 1000)
task_b = triangular_sample(3, 5, 10, 1000)
task_c = triangular_sample(8, 12, 25, 1000)

total_duration = task_a + task_b + task_c

# パーセンタイル計算
p10 = np.percentile(total_duration, 10)
p50 = np.percentile(total_duration, 50)
p80 = np.percentile(total_duration, 80)
p90 = np.percentile(total_duration, 90)
p95 = np.percentile(total_duration, 95)

print(f"P10: {p10:.1f}日")
print(f"P50: {p50:.1f}日")
print(f"P80: {p80:.1f}日")
print(f"P90: {p90:.1f}日")
print(f"P95: {p95:.1f}日")

# ヒストグラム表示
plt.hist(total_duration, bins=50, edgecolor='black')
plt.axvline(p50, color='r', linestyle='--', label='P50')
plt.axvline(p80, color='orange', linestyle='--', label='P80')
plt.legend()
plt.xlabel('期間（日）')
plt.ylabel('頻度')
plt.title('プロジェクト期間のモンテカルロシミュレーション')
plt.show()
```

## 感度分析

### 概要

各リスク要因が結果にどの程度影響するかを分析し、
最も影響力の大きい要因を特定する。

### トルネード図

```
リスク要因         影響範囲
─────────────────────────────
開発速度    ████████████████
品質        ██████████
外部依存    ████████
インフラ    ████
                ↑
            基準値
```

**解釈**:
- 開発速度が最も影響が大きい → 優先的に管理
- インフラは影響が小さい → 監視レベルで十分

### スパイダー図

```
        品質
         ↑
         |
開発速度 →+← 外部依存
         |
         ↓
       インフラ

各軸: リスク要因
線: 結果への影響度
```

## 定性的分析 vs 定量的分析

### 定性的分析

**特徴**:
- 確率と影響を主観的に評価（高/中/低）
- 迅速に実施可能
- すべてのリスクに適用可能

**適用シーン**:
- プロジェクト初期
- データが限られている場合
- 多数のリスクをスクリーニング

**ツール**:
- 確率・影響度マトリクス
- SWOT分析
- 専門家判断

### 定量的分析

**特徴**:
- 数値で確率と影響を評価
- データ分析が必要
- 精度が高い

**適用シーン**:
- 重大なリスク
- 意思決定に数値根拠が必要
- 予算・スケジュール分析

**ツール**:
- EMV分析
- モンテカルロシミュレーション
- 感度分析
- 決定木分析

## 決定木分析

### 概要

複数の選択肢と不確実性がある場合に、
最適な意思決定を導く手法。

### 例: 技術選定

```
開始
├─ 選択肢A: 新技術採用
│  ├─ 成功（60%）: 利益 +$200,000
│  │  EMV: 0.6 × $200,000 = $120,000
│  └─ 失敗（40%）: 損失 -$100,000
│     EMV: 0.4 × (-$100,000) = -$40,000
│  合計EMV(A): $80,000
│
└─ 選択肢B: 既存技術使用
   ├─ 成功（90%）: 利益 +$100,000
   │  EMV: 0.9 × $100,000 = $90,000
   └─ 失敗（10%）: 損失 -$20,000
      EMV: 0.1 × (-$20,000) = -$2,000
   合計EMV(B): $88,000

推奨: 選択肢B（EMV が高い）
```

### 複雑な決定木

```
初期選択
├─ パターン1
│  ├─ 次の選択
│  │  ├─ 結果A
│  │  └─ 結果B
│  └─ 次の選択
│     └─ 結果C
└─ パターン2
   └─ 結果D

各ノードでEMVを計算し、
最適経路を逆算する
```

## リスク調整済み価値

### 概要

不確実性を考慮した価値評価。

### 計算式

```
リスク調整済み価値 = 期待価値 - リスクプレミアム

期待価値 = Σ(確率 × 価値)
リスクプレミアム = リスク回避度 × 分散
```

### 例

```
プロジェクトA:
  確実な利益: $100,000
  リスク調整済み価値: $100,000

プロジェクトB:
  50%の確率で$250,000
  50%の確率で$0
  期待値: $125,000
  分散: 高
  リスクプレミアム: $30,000
  リスク調整済み価値: $95,000

選択: プロジェクトA
（確実性を重視する場合）
```

## まとめ

リスク分析手法の選択:

**初期段階**:
- 確率・影響度マトリクス（定性的）
- SWOT分析

**詳細分析**:
- EMV分析（金銭的影響が明確）
- モンテカルロシミュレーション（スケジュール・コスト）
- 感度分析（影響要因の特定）

**意思決定**:
- 決定木分析（複数選択肢）
- リスク調整済み価値（不確実性考慮）

**推奨アプローチ**:
1. 定性的分析でスクリーニング
2. 重大リスクを定量的分析
3. 意思決定に数値根拠を使用
4. 継続的に再評価
