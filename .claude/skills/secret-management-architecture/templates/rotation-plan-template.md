# Secret Rotation計画テンプレート

## プロジェクト情報

- **プロジェクト名**: **\*\***\_\_\_**\*\***
- **計画作成日**: **\*\***\_\_\_**\*\***
- **作成者**: **\*\***\_\_\_**\*\***
- **レビュー者**: **\*\***\_\_\_**\*\***

## Rotation対象Secret一覧

| Secret名               | 重要度   | 現在の値の作成日 | Rotation頻度 | 次回Rotation予定日 | 担当者 | 備考                 |
| ---------------------- | -------- | ---------------- | ------------ | ------------------ | ------ | -------------------- |
| DATABASE_PASSWORD_PROD | Critical | 2025-10-01       | 30日         | 2025-11-01         | DevOps | ダウンタイムゼロ必須 |
| OPENAI_API_KEY         | Critical | 2025-10-15       | 30日         | 2025-11-15         | DevOps | 課金対象             |
| NEXTAUTH_SECRET        | Critical | 2025-09-01       | 30日         | 2025-10-01         | DevOps | セッション暗号化     |
| DISCORD_WEBHOOK_URL    | High     | 2025-08-01       | 90日         | 2025-11-01         | DevOps | 通知サービス         |

## Rotation手順（5段階）

### Phase 1: 新鍵生成

- **実施日時**: **\*\***\_\_\_**\*\***
- **実施者**: **\*\***\_\_\_**\*\***
- **生成方法**: **\*\***\_\_\_**\*\***
- **チェック項目**:
  - [ ] 新鍵が生成された
  - [ ] 十分な強度（長さ、ランダム性）
  - [ ] 監査ログに記録

### Phase 2: 両方の鍵を有効化（新旧並存）

- **実施日時**: **\*\***\_\_\_**\*\***
- **実施者**: **\*\***\_\_\_**\*\***
- **手順**:
  1. [ ] 新鍵をSecret管理システムに追加
  2. [ ] 旧鍵は維持（削除しない）
  3. [ ] 両方のアクセス可能性を確認
  4. [ ] 監査ログに記録

### Phase 3: アプリケーションを新鍵に移行

- **実施日時**: **\*\***\_\_\_**\*\***
- **実施者**: **\*\***\_\_\_**\*\***
- **手順**:
  1. [ ] デプロイ設定を新鍵に更新
  2. [ ] ローリングリスタート実行
  3. [ ] 全インスタンスの移行確認
  4. [ ] エラーログ監視（15分）
  5. [ ] 機能テスト実行
  6. [ ] ロールバック手順を準備

### Phase 4: 旧鍵を無効化（読み取り専用）

- **実施日時**: **\*\***\_\_\_**\*\***
- **実施者**: **\*\***\_\_\_**\*\***
- **手順**:
  1. [ ] 旧鍵の権限を制限
  2. [ ] 旧鍵へのアクセスがゼロであることを確認
  3. [ ] 監視期間設定（24時間）

### Phase 5: 旧鍵を完全削除

- **実施日時**: **\*\***\_\_\_**\*\*** （Phase 4から24時間後）
- **実施者**: **\*\***\_\_\_**\*\***
- **手順**:
  1. [ ] 旧鍵へのアクセスがゼロであることを最終確認
  2. [ ] 旧鍵を削除
  3. [ ] バックアップから削除
  4. [ ] 監査ログに記録
  5. [ ] 完了通知送信

## ロールバック手順

### ロールバック条件

- [ ] Phase 3でエラー率が閾値（5%）を超える
- [ ] アプリケーションが正常に動作しない
- [ ] データベース接続エラーが発生

### ロールバック手順

1. [ ] デプロイ設定を旧鍵に戻す
2. [ ] ローリングリスタート実行
3. [ ] 正常動作確認
4. [ ] インシデントレポート作成
5. [ ] 原因分析と対策策定

## 監視項目

### Rotation実行中の監視

- [ ] エラーログ
- [ ] アクセスログ
- [ ] パフォーマンスメトリクス
- [ ] ユーザー影響（エラー報告）

### Rotation完了後の監視（24時間）

- [ ] 旧鍵へのアクセス回数（ゼロが理想）
- [ ] 新鍵でのエラー発生
- [ ] パフォーマンス低下
- [ ] セキュリティアラート

## 通知計画

### 事前通知（24時間前）

- **通知先**: **\*\***\_\_\_**\*\***
- **内容**: Rotation予定日時、影響範囲、ダウンタイム（あれば）

### 実行中通知

- **通知先**: **\*\***\_\_\_**\*\***
- **内容**: Phase進捗、現在のステータス

### 完了通知

- **通知先**: **\*\***\_\_\_**\*\***
- **内容**: Rotation完了、結果、次回予定

## リスク評価

| リスク                   | 発生確率 | 影響度   | 軽減策                                      |
| ------------------------ | -------- | -------- | ------------------------------------------- |
| Rotation中のダウンタイム | Low      | High     | ローリングリスタート、Blue-Green Deployment |
| 新鍵でのアクセス失敗     | Medium   | Critical | ロールバック手順準備、監視強化              |
| 旧鍵の誤削除             | Low      | High     | Phase 4で24時間監視期間                     |

## 承認

- **計画レビュー者**: **\*\***\_\_\_**\*\*** (署名: **\_\_\_**) 日付: **\_\_\_**
- **実行承認者**: **\*\***\_\_\_**\*\*** (署名: **\_\_\_**) 日付: **\_\_\_**
- **Security Admin承認**: **\*\***\_\_\_**\*\*** (署名: **\_\_\_**) 日付: **\_\_\_**

## 実行記録

### Phase 1実行記録

- 実施日時: **\*\***\_\_\_**\*\***
- 実施者: **\*\***\_\_\_**\*\***
- 結果: 成功/失敗
- 備考: **\*\***\_\_\_**\*\***

### Phase 2実行記録

- 実施日時: **\*\***\_\_\_**\*\***
- 実施者: **\*\***\_\_\_**\*\***
- 結果: 成功/失敗
- 備考: **\*\***\_\_\_**\*\***

### Phase 3実行記録

- 実施日時: **\*\***\_\_\_**\*\***
- 実施者: **\*\***\_\_\_**\*\***
- 結果: 成功/失敗
- 備考: **\*\***\_\_\_**\*\***

### Phase 4実行記録

- 実施日時: **\*\***\_\_\_**\*\***
- 実施者: **\*\***\_\_\_**\*\***
- 結果: 成功/失敗
- 備考: **\*\***\_\_\_**\*\***

### Phase 5実行記録

- 実施日時: **\*\***\_\_\_**\*\***
- 実施者: **\*\***\_\_\_**\*\***
- 結果: 成功/失敗
- 備考: **\*\***\_\_\_**\*\***

## 次回Rotation予定

- **次回実施予定日**: **\*\***\_\_\_**\*\***
- **担当者**: **\*\***\_\_\_**\*\***
- **リマインダー設定**: **\*\***\_\_\_**\*\***
