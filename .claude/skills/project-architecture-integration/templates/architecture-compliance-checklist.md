# アーキテクチャ準拠チェックリスト

このチェックリストは、エージェントがプロジェクトアーキテクチャに準拠しているか確認するためのものです。

## 使用方法

エージェント設計/レビュー時に、該当するセクションをチェックしてください。

---

## 1. ハイブリッドアーキテクチャ（shared/features）

### 必須チェック
- [ ] エージェントが生成するファイルの配置先が明確か？
  - `shared/core/` - 共通エンティティ、ビジネスルール
  - `shared/infrastructure/` - 外部サービス接続層
  - `features/` - 機能ごとのビジネスロジック
  - `app/` - HTTPエンドポイント、プレゼンテーション層

- [ ] 依存関係の方向性ルールを理解しているか？
  - app/ → features/ → shared/infrastructure/ → shared/core/
  - 逆方向の依存は禁止

- [ ] 機能間の相互依存を避けているか？
  - features/各機能は独立
  - 共通要素はshared/に配置

### 推奨チェック
- [ ] 新機能追加ワークフローに従っているか？
  - 仕様書作成 → スキーマ定義 → Executor実装 → Registry登録 → テスト作成

---

## 2. データベース設計原則

**適用条件**: データベース操作を行うエージェント

### 必須チェック
- [ ] トランザクション境界が明確か？
- [ ] ACID特性を考慮しているか？
- [ ] ロールバック戦略が定義されているか？

### 推奨チェック
- [ ] JSONB活用を検討しているか？
- [ ] インデックス戦略が定義されているか？
- [ ] pgvector使用時、ベクトル型の適切な使用を考慮しているか？

---

## 3. REST API設計

**適用条件**: API連携を行うエージェント

### 必須チェック
- [ ] RESTful原則に従っているか？
  - リソースベースのURL設計
  - 適切なHTTPメソッド使用
  - ステートレス通信

- [ ] HTTPステータスコードの適切な処理があるか？
  - 2xx（成功）、4xx（クライアントエラー）、5xx（サーバーエラー）

### 推奨チェック
- [ ] APIバージョニングを考慮しているか？
  - URLパスベース（`/api/v1/`）
- [ ] レスポンス形式が標準に準拠しているか？
  - JSON形式、ページネーション対応

---

## 4. テスト戦略

**適用条件**: テスト関連エージェント、または実装エージェント

### 必須チェック
- [ ] テストピラミッドを考慮しているか？
  - 静的型チェック（TypeScript）
  - ユニットテスト（Vitest）
  - 統合テスト
  - E2Eテスト（Playwright）

### 推奨チェック
- [ ] TDDサイクル（Red-Green-Refactor）を考慮しているか？
- [ ] カバレッジ目標が定義されているか？
  - ユニットテスト: 80%以上
- [ ] モック/スタブ方針が明確か？

---

## 5. エラーハンドリング

**適用条件**: すべてのエージェント（推奨）

### 必須チェック
- [ ] エラー分類を考慮しているか？
  - Validation: 入力検証エラー
  - Business: ビジネスルールエラー
  - External: 外部サービスエラー
  - Infrastructure: インフラエラー
  - Internal: 内部エラー

### 推奨チェック
- [ ] リトライ戦略が定義されているか？
  - 指数バックオフ
  - 最大リトライ回数
- [ ] 構造化ログを考慮しているか？
  - JSON形式
  - トレーサビリティ（request_id, workflow_id）
- [ ] サーキットブレーカーパターンを考慮しているか？

---

## 6. CI/CD要件

**適用条件**: デプロイ関連エージェント

### 必須チェック
- [ ] 品質ゲートを考慮しているか？
  - 型チェック（tsc --noEmit）
  - Lint（ESLint）
  - テスト（Vitest）
  - ビルド（Next.js build）

### 推奨チェック
- [ ] 自動デプロイフローを考慮しているか？
  - Railway統合
- [ ] 通知要件を満たしているか？
  - Discord通知
- [ ] ヘルスチェックが考慮されているか？

---

## 評価サマリー

| カテゴリ | 適用 | 必須 | 推奨 | スコア |
|---------|------|------|------|--------|
| ハイブリッドアーキテクチャ | □ | /3 | /1 | |
| データベース設計 | □ | /3 | /3 | |
| REST API設計 | □ | /2 | /2 | |
| テスト戦略 | □ | /1 | /3 | |
| エラーハンドリング | □ | /1 | /3 | |
| CI/CD要件 | □ | /1 | /3 | |

**総合評価**: ___/10

---

## 参照ドキュメント

- **master_system_design.md**: `docs/00-requirements/master_system_design.md`
  - セクション4: ディレクトリ構造
  - セクション5: アーキテクチャ設計詳細
  - セクション5.2: データベース設計原則
  - セクション7: エラーハンドリング仕様
  - セクション8: REST API設計原則
  - セクション12: デプロイメント
