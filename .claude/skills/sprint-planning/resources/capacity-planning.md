# キャパシティプランニング詳細ガイド

## 概要

キャパシティプランニングは、チームが現実的に達成可能な作業量を
見積もり、スプリント計画に反映するプロセスです。

## 基本計算式

```
個人キャパシティ =
  (作業日数 × 8時間/日 - 会議時間 - サポート時間)
  × フォーカスファクター
  × 出勤率

チームキャパシティ =
  Σ(個人キャパシティ)
```

## 詳細計算方法

### 1. 利用可能時間の算出

**基本時間**:

```
スプリント期間: 10営業日
1日の勤務時間: 8時間
基本時間 = 10日 × 8時間 = 80時間
```

**会議時間の控除**:

```
デイリースクラム: 15分 × 10日 = 2.5時間
スプリント計画: 4時間
レトロスペクティブ: 2時間
スプリントレビュー: 2時間
その他定例会議: 1時間 × 10日 = 10時間
───────────────────────────
合計会議時間: 20.5時間
```

**サポート業務の控除**:

```
技術サポート: 1時間/日 × 10日 = 10時間
コードレビュー: 0.5時間/日 × 10日 = 5時間
質問対応: 0.5時間/日 × 10日 = 5時間
───────────────────────────
合計サポート時間: 20時間
```

**正味時間**:

```
正味時間 = 80 - 20.5 - 20 = 39.5時間
```

### 2. フォーカスファクターの適用

**フォーカスファクターとは**:
集中して作業できる時間の割合。割り込み、タスク切り替え、
集中力の限界などを考慮した係数。

**典型的な値**:

```
経験豊富なチーム: 0.8 (80%)
一般的なチーム: 0.7 (70%)
新しいチーム: 0.6 (60%)
割り込み多い環境: 0.5 (50%)
```

**適用例**:

```
実効時間 = 39.5時間 × 0.7 = 27.65時間
```

### 3. 出勤率の考慮

**出勤率要因**:

- 休暇予定
- 病欠見込み
- 研修参加
- その他イベント

**計算例**:

```
チームメンバー5名
1名が2日休暇 → 出勤率 = (5×10 - 2) / (5×10) = 96%

実効時間（チーム全体） = 27.65時間 × 5名 × 0.96
                       = 132.72時間
```

## ストーリーポイントへの変換

### ベロシティベース

**過去3スプリントの実績**:

```
スプリント1: 42ポイント
スプリント2: 38ポイント
スプリント3: 45ポイント
───────────────────
平均ベロシティ: 41.67ポイント
```

**推奨コミット**:

```
Yesterday's Weather: 42ポイント（直近の実績）
Conservative: 38ポイント（最小値）
Aggressive: 45ポイント（最大値）
Average: 42ポイント（平均値）
```

### 時間ベース換算

**1ポイントあたりの時間**:

```
実績ベース:
過去スプリント: 42ポイント完了、132時間消費
1ポイント = 132 / 42 ≈ 3.14時間

今回のキャパシティ:
132.72時間 ÷ 3.14時間/ポイント ≈ 42ポイント
```

## 個人差の考慮

### スキルマトリクス

```
メンバー  | React | Node.js | DB | テスト | キャパシティ
────────|-------|---------|----|---------|-----------
Alice   | 上級  | 中級    | 中級| 上級   | 32時間
Bob     | 中級  | 上級    | 上級| 中級   | 28時間
Carol   | 初級  | 中級    | 初級| 中級   | 20時間
Dave    | 中級  | 中級    | 中級| 上級   | 30時間
Eve     | 上級  | 初級    | 中級| 中級   | 26時間
────────|-------|---------|----|---------|-----------
合計                                     | 136時間
```

### スキルベース調整

**タスクとメンバーのマッチング**:

```
React実装タスク:
- Alice（上級）: 1時間/ポイント
- Bob（中級）: 1.5時間/ポイント
- Carol（初級）: 3時間/ポイント

→ Aliceにアサインすれば効率的
```

## バッファ戦略

### 固定バッファ

```
計算キャパシティ: 42ポイント
バッファ: 20%
コミットメント: 42 × 0.8 = 33.6 → 34ポイント
残りバッファ: 8ポイント（緊急対応用）
```

### ストレッチゴール方式

```
コアコミット: 34ポイント（80%確実）
ストレッチゴール: +8ポイント（余裕があれば）
合計: 42ポイント

ステータス:
- コア完了 → スプリント成功
- ストレッチ未完了 → 許容範囲
- コア未完了 → 問題あり
```

## 調整要因

### 1. 技術的負債返済

```
通常開発キャパシティ: 42ポイント
技術的負債割当: 20%
───────────────────────
新機能開発: 33.6ポイント
リファクタリング: 8.4ポイント
```

### 2. 学習時間

```
新技術導入スプリント:
学習バッファ: 10%
実効キャパシティ: 42 × 0.9 = 37.8ポイント
```

### 3. 依存関係待ち

```
外部チーム依存タスク:
待ち時間見込み: 15%
調整後キャパシティ: 42 × 0.85 = 35.7ポイント
```

## ツールと自動化

### スプレッドシート計算

```
項目                   | 値
─────────────────────|──────
スプリント日数         | 10
1日勤務時間            | 8
チーム人数            | 5
会議時間/日           | 2
サポート時間/日        | 2
フォーカスファクター   | 0.7
出勤率                | 0.96
─────────────────────|──────
個人キャパシティ/日    | 2.8時間
個人キャパシティ/Sprint| 28時間
チームキャパシティ     | 134.4時間
```

### Python計算スクリプト

```python
def calculate_capacity(
    team_size,
    sprint_days,
    meetings_per_day=2,
    support_per_day=2,
    focus_factor=0.7,
    availability_rate=0.96
):
    hours_per_day = 8
    effective_hours = (hours_per_day - meetings_per_day - support_per_day) * focus_factor
    individual_capacity = effective_hours * sprint_days
    team_capacity = individual_capacity * team_size * availability_rate

    return {
        'individual_hours': individual_capacity,
        'team_hours': team_capacity,
        'story_points': team_capacity / 3.2  # 仮定: 1SP = 3.2時間
    }

# 使用例
result = calculate_capacity(team_size=5, sprint_days=10)
print(f"チームキャパシティ: {result['team_hours']:.1f}時間")
print(f"推定ストーリーポイント: {result['story_points']:.0f}SP")
```

## ベストプラクティス

### 1. 過去データの活用

**トラッキング項目**:

- 計画ベロシティ vs 実績ベロシティ
- 計画時間 vs 実績時間
- タスクごとの見積もり精度
- 中断・割り込み回数

### 2. 継続的な改善

**改善サイクル**:

```
計画 → 実行 → 測定 → 分析 → 調整 → 計画...
```

**調整例**:

```
実績が常に80%
→ フォーカスファクターを0.7→0.56に調整

実績が常に120%
→ 過小評価の傾向、見積もり精度を改善
```

### 3. 透明性の確保

**可視化**:

- キャパシティダッシュボード
- ベロシティチャート
- バーンダウンチャート
- キャパシティ vs コミットメント

## まとめ

キャパシティプランニングは科学と芸術の両面があります。

**科学的側面**:

- データに基づく計算
- 過去実績の分析
- 統計的予測

**芸術的側面**:

- チームの状態考慮
- プロジェクトコンテキスト
- リスク判断

両方をバランスよく活用し、継続的に改善することが重要です。
