# スキーマレビューチェックリスト

## 基本情報

| 項目               | 内容             |
| ------------------ | ---------------- |
| **レビュー日**     | {{YYYY-MM-DD}}   |
| **レビュアー**     | {{名前}}         |
| **対象スキーマ**   | {{ファイルパス}} |
| **対象テーブル数** | {{数}}           |

---

## 1. 論理設計アンチパターンチェック

### 1.1 ジェイウォーク（カンマ区切り値）

| テーブル  | カラム     | 状態            | コメント     |
| --------- | ---------- | --------------- | ------------ |
| {{table}} | {{column}} | ☐ OK / ☐ 要修正 | {{コメント}} |

**チェック項目**:

- [ ] カンマ区切り値を格納するカラムがない
- [ ] 配列として格納すべきデータが正規化されている
- [ ] FIND_IN_SET や LIKE '%value%' パターンがない

### 1.2 EAV（Entity-Attribute-Value）

**チェック項目**:

- [ ] attribute_name/attribute_value パターンがない
- [ ] 動的属性が必要な場合、JSONまたは継承を使用している
- [ ] データ型制約が適切に設定されている

| テーブル  | 問題     | 解決策     |
| --------- | -------- | ---------- |
| {{table}} | {{問題}} | {{解決策}} |

### 1.3 Polymorphic Associations

**チェック項目**:

- [ ] _\_type + _\_id パターンがない
- [ ] すべての外部キー関係に制約が定義されている
- [ ] 参照整合性がDB層で保証されている

| テーブル  | カラム     | 状態            | 推奨対応 |
| --------- | ---------- | --------------- | -------- |
| {{table}} | {{column}} | ☐ OK / ☐ 要修正 | {{対応}} |

### 1.4 マルチカラムアトリビュート

**チェック項目**:

- [ ] tag1, tag2, tag3 のようなパターンがない
- [ ] 繰り返しグループが正規化されている

---

## 2. 物理設計アンチパターンチェック

### 2.1 データ型の適切性

| カラム     | 現在の型 | 推奨型   | 理由     |
| ---------- | -------- | -------- | -------- |
| {{column}} | {{現在}} | {{推奨}} | {{理由}} |

**チェック項目**:

- [ ] 金額カラムに DECIMAL を使用している（REAL でない）
- [ ] 日時カラムに適切な型（TEXT ISO8601形式 または INTEGER Unix時間）を使用している
- [ ] 文字列長が適切に制限されている
- [ ] CHECK制約の代わりに参照テーブルを検討している

### 2.2 インデックス設計

**チェック項目**:

- [ ] すべての外部キーにインデックスがある
- [ ] 頻繁に検索されるカラムにインデックスがある
- [ ] 不要なインデックス（未使用、重複）がない
- [ ] JSON カラムに対する検索には適切なインデックス戦略がある

---

## 3. キー・制約チェック

### 3.1 主キー

| テーブル  | 主キー型                          | 適切性          | コメント     |
| --------- | --------------------------------- | --------------- | ------------ |
| {{table}} | ☐ INTEGER / ☐ TEXT(UUID) / ☐ 複合 | ☐ OK / ☐ 要検討 | {{コメント}} |

### 3.2 外部キー

| 子テーブル | 親テーブル | 制約定義    | CASCADE設定 |
| ---------- | ---------- | ----------- | ----------- |
| {{child}}  | {{parent}} | ☐ 有 / ☐ 無 | {{設定}}    |

**チェック項目**:

- [ ] すべての参照関係に外部キー制約がある
- [ ] CASCADE動作がビジネスルールと整合している
- [ ] 循環参照がない

### 3.3 UNIQUE制約

| テーブル  | カラム     | 制約        | 必要性     |
| --------- | ---------- | ----------- | ---------- |
| {{table}} | {{column}} | ☐ 有 / ☐ 無 | {{必要性}} |

### 3.4 CHECK制約

| テーブル  | 制約内容 | 状態            |
| --------- | -------- | --------------- |
| {{table}} | {{内容}} | ☐ 有 / ☐ 要追加 |

---

## 4. NULL処理チェック

### 4.1 NOT NULL制約

| テーブル  | カラム     | NULL許可        | 妥当性          | コメント     |
| --------- | ---------- | --------------- | --------------- | ------------ |
| {{table}} | {{column}} | ☐ 許可 / ☐ 不可 | ☐ OK / ☐ 要検討 | {{コメント}} |

**チェック項目**:

- [ ] 必須カラムに NOT NULL 制約がある
- [ ] マジック値（-1, '1900-01-01', ''）の代わりに NULL を使用している
- [ ] NULL許可の理由が明確である

---

## 5. クエリパターンチェック

### 5.1 クエリアンチパターン

**チェック項目**:

- [ ] SELECT \* を本番コードで使用していない
- [ ] ORDER BY RANDOM() を使用していない
- [ ] LIKE '%keyword%' の代わりに全文検索（FTS5）を使用している
- [ ] N+1 クエリパターンがない

### 5.2 パフォーマンス考慮

| クエリ     | 問題     | 推奨対応 |
| ---------- | -------- | -------- |
| {{クエリ}} | {{問題}} | {{対応}} |

---

## 6. セキュリティチェック

**チェック項目**:

- [ ] パスワードはハッシュ化されている
- [ ] パラメータ化クエリを使用している
- [ ] 機密データに適切なアクセス制御がある
- [ ] 監査ログが必要なテーブルに実装されている

| テーブル  | セキュリティ考慮 | 状態            |
| --------- | ---------------- | --------------- |
| {{table}} | {{考慮事項}}     | ☐ OK / ☐ 要対応 |

---

## 7. 検出されたアンチパターン一覧

| #   | アンチパターン | テーブル  | カラム     | 重要度   | 対応状況                     |
| --- | -------------- | --------- | ---------- | -------- | ---------------------------- |
| 1   | {{パターン}}   | {{table}} | {{column}} | 🔴/🟡/🟢 | ☐ 未対応 / ☐ 対応中 / ☐ 完了 |

---

## 8. 推奨事項

### 即時対応（クリティカル）

1. {{推奨事項1}}
2. {{推奨事項2}}

### 短期対応（高優先度）

1. {{推奨事項1}}
2. {{推奨事項2}}

### 中長期対応（改善項目）

1. {{推奨事項1}}
2. {{推奨事項2}}

---

## 9. 承認

| 役割             | 名前     | 承認日   | コメント     |
| ---------------- | -------- | -------- | ------------ |
| 開発者           | {{名前}} | {{日付}} | {{コメント}} |
| レビュアー       | {{名前}} | {{日付}} | {{コメント}} |
| DBA/テックリード | {{名前}} | {{日付}} | {{コメント}} |

---

## 10. フォローアップ

| 項目     | 担当者     | 期限     | 状態                         |
| -------- | ---------- | -------- | ---------------------------- |
| {{項目}} | {{担当者}} | {{期限}} | ☐ 未着手 / ☐ 進行中 / ☐ 完了 |
