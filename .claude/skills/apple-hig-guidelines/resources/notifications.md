# HIG Notifications 仕様書

## 通知タイプ一覧

### 表示スタイル

| タイプ       | 説明               | 用途           |
| ------------ | ------------------ | -------------- |
| **バナー**   | 画面上部に一時表示 | 一般的な通知   |
| **アラート** | 操作まで表示継続   | 重要な通知     |
| **バッジ**   | アイコン上の数字   | 未読カウント   |
| **サウンド** | 音声のみ           | 軽微な通知     |
| **なし**     | バックグラウンド   | サイレント更新 |

### 重要度レベル

| レベル             | 動作           | 用途                     |
| ------------------ | -------------- | ------------------------ |
| **Time Sensitive** | 集中モード貫通 | 緊急メッセージ、タイマー |
| **Active**         | 通常表示       | 一般的な通知             |
| **Passive**        | 控えめに表示   | 低優先度情報             |

---

## バナー通知レイアウト

### 標準バナー

```
┌────────────────────────────────────────────────┐
│                                                │
│  [App Icon]  アプリ名              今すぐ       │
│  32×32       (13pt Bold)                       │
│                                                │
│  タイトル (15pt Semibold)                      │
│                                                │
│  本文テキスト (15pt Regular)                   │
│  最大4行まで表示...                            │
│                                                │
│  [添付画像/メディア]                           │
│  (オプション)                                  │
│                                                │
└────────────────────────────────────────────────┘

サイズ:
├── 幅: デバイス幅 - 16pt (両端)
├── 高さ: コンテンツに応じて可変
├── 角丸: 14pt
└── パディング: 16pt
```

### 展開バナー

```
┌────────────────────────────────────────────────┐
│                                                │
│  [App Icon]  アプリ名              5分前       │
│                                                │
│  タイトル                                      │
│                                                │
│  本文テキスト（展開時は全文表示）               │
│                                                │
│  ┌──────────────────────────────────────────┐  │
│  │                                          │  │
│  │        画像/動画プレビュー               │  │
│  │        (最大幅、アスペクト比維持)         │  │
│  │                                          │  │
│  └──────────────────────────────────────────┘  │
│                                                │
│  ┌──────────────┐  ┌──────────────┐           │
│  │   アクション1  │  │   アクション2  │           │
│  └──────────────┘  └──────────────┘           │
│                                                │
└────────────────────────────────────────────────┘
```

---

## 通知コンテンツ

### テキスト制限

| 要素             | 最大長   | 推奨           |
| ---------------- | -------- | -------------- |
| **タイトル**     | 制限なし | 1行 (約40文字) |
| **サブタイトル** | 制限なし | 1行            |
| **本文**         | 制限なし | 2-4行          |
| **カテゴリID**   | 50文字   | 簡潔に         |

### コンテンツ優先度

```
1. タイトル: 最重要情報（必須）
   例: 「山田太郎からのメッセージ」

2. サブタイトル: 補足コンテキスト（オプション）
   例: 「プロジェクトAについて」

3. 本文: 詳細内容
   例: 「明日のミーティング、14時に変更でお願いします」

4. 添付: メディア/画像
   例: 送信された画像のサムネイル
```

---

## 添付メディア

### サポートフォーマット

| タイプ   | フォーマット   | 最大サイズ |
| -------- | -------------- | ---------- |
| **画像** | JPEG, PNG, GIF | 10MB       |
| **音声** | MP3, AAC, WAV  | 5MB        |
| **動画** | MPEG, MP4      | 50MB       |

### 画像サイズ

| 表示コンテキスト | 推奨サイズ                   |
| ---------------- | ---------------------------- |
| **サムネイル**   | 100×100 pt (@2x: 200×200 px) |
| **展開時**       | 幅: 最大通知幅               |
| **アスペクト比** | 維持（自動調整）             |

### 添付実装

```swift
// 画像添付
let imageAttachment = try UNNotificationAttachment(
    identifier: "image",
    url: imageURL,
    options: [
        UNNotificationAttachmentOptionsTypeHintKey: kUTTypeJPEG,
        UNNotificationAttachmentOptionsThumbnailClippingRectKey:
            CGRect(x: 0, y: 0, width: 1, height: 1)
    ]
)

content.attachments = [imageAttachment]
```

---

## アクションボタン

### アクションタイプ

| タイプ                     | 動作                      | 用途         |
| -------------------------- | ------------------------- | ------------ |
| **Default**                | アプリ起動                | 詳細表示     |
| **Foreground**             | アプリ起動                | 操作必要     |
| **Destructive**            | バックグラウンド + 赤表示 | 削除、拒否   |
| **AuthenticationRequired** | 認証後実行                | セキュア操作 |

### アクションレイアウト

```
最大4アクション:
┌────────────────────────────────────────────────┐
│                                                │
│  ┌──────────┐┌──────────┐┌──────────┐┌───────┐│
│  │ 返信     ││ 既読     ││ 後で     ││ 削除  ││
│  │ (青)    ││ (グレー) ││ (グレー) ││ (赤)  ││
│  └──────────┘└──────────┘└──────────┘└───────┘│
│                                                │
└────────────────────────────────────────────────┘

サイズ:
├── 高さ: 44pt
├── 角丸: 12pt
└── 間隔: 8pt
```

### テキスト入力アクション

```
┌────────────────────────────────────────────────┐
│                                                │
│  ┌──────────────────────────────────────────┐  │
│  │ 返信を入力...                   [送信]   │  │
│  └──────────────────────────────────────────┘  │
│                                                │
└────────────────────────────────────────────────┘
```

---

## 通知センター

### グループ化

```
┌────────────────────────────────────────────────┐
│                                                │
│  [App Icon] アプリ名                    2通   │
│                                                │
│  最新の通知タイトル                           │
│  本文プレビュー...                            │
│                                                │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─    │
│  2つ前の通知タイトル                          │
│                                                │
└────────────────────────────────────────────────┘

グループ基準:
├── threadIdentifier（スレッドID）
├── アプリ（デフォルト）
└── サマリー（カスタマイズ可能）
```

### サマリーテキスト

```swift
// グループサマリー
let summaryFormat = "%u 件の新しいメッセージ"
content.summaryArgument = "山田太郎"
content.summaryArgumentCount = 3

// 結果: 「山田太郎 からの 3 件の新しいメッセージ」
```

---

## ロック画面通知

### プライバシー設定

| 設定                 | 表示内容                    |
| -------------------- | --------------------------- |
| **常に表示**         | 全コンテンツ                |
| **ロック解除時のみ** | タイトルのみ / アプリ名のみ |
| **非表示**           | 「通知があります」のみ      |

### ロック画面レイアウト

```
┌────────────────────────────────────────────────┐
│                                                │
│              14:32                             │
│            月曜日、1月15日                      │
│                                                │
├────────────────────────────────────────────────┤
│                                                │
│  [Icon] メッセージ                    今       │
│  山田太郎                                      │
│  明日の会議について                            │
│                                                │
├────────────────────────────────────────────────┤
│                                                │
│  [Icon] カレンダー                  10分前     │
│  会議リマインダー                              │
│  14:00 プロジェクトMTG                         │
│                                                │
└────────────────────────────────────────────────┘
```

---

## Apple Watch 通知

### Short Look

```
┌─────────────────────┐
│                     │
│      [App Icon]     │
│                     │
│      アプリ名       │
│                     │
│      タイトル       │
│                     │
└─────────────────────┘

表示時間: 約2秒
タップ: Long Look へ遷移
```

### Long Look

```
┌─────────────────────┐
│                     │
│  [カスタムUI/画像]  │
│                     │
│  タイトル           │
│  本文テキスト       │
│                     │
├─────────────────────┤
│                     │
│  [アクション1]      │
│  [アクション2]      │
│  [閉じる]          │
│                     │
└─────────────────────┘
```

---

## macOS 通知

### バナースタイル

```
┌────────────────────────────────────────┐
│                                        │
│  [Icon]  アプリ名           [閉じる]   │
│          タイトル                      │
│          本文テキスト                  │
│                                        │
└────────────────────────────────────────┘

位置: 画面右上
サイズ: 幅 350pt、高さ可変
表示時間: 5秒
```

### 通知センター

```
macOS通知センター（サイドバー）:
├── 今日のウィジェット
├── 通知リスト（時系列）
└── グループ化（アプリ別）
```

---

## サウンドとバイブレーション

### システムサウンド

| サウンドID   | 説明         | 用途         |
| ------------ | ------------ | ------------ |
| **default**  | 標準通知音   | 一般通知     |
| **critical** | 緊急音       | 重要アラート |
| **カスタム** | 独自サウンド | ブランド識別 |

### カスタムサウンド要件

```
フォーマット: AIFF, WAV, CAF
長さ: 最大30秒
サイズ: 推奨 < 100KB
ビットレート: 44.1kHz または 22.05kHz
```

### 触覚フィードバック

```swift
// サウンド + 触覚
content.sound = UNNotificationSound.default

// カスタム触覚（watchOS）
WKInterfaceDevice.current().play(.notification)
```

---

## プッシュ通知ペイロード

### 標準ペイロード

```json
{
  "aps": {
    "alert": {
      "title": "通知タイトル",
      "subtitle": "サブタイトル",
      "body": "本文メッセージ"
    },
    "badge": 5,
    "sound": "default",
    "category": "MESSAGE_CATEGORY",
    "thread-id": "conversation-123",
    "mutable-content": 1,
    "interruption-level": "time-sensitive",
    "relevance-score": 0.8
  },
  "custom_data": {
    "conversation_id": "123",
    "sender_id": "user-456"
  }
}
```

### ペイロードサイズ制限

| タイプ       | 最大サイズ |
| ------------ | ---------- |
| **標準APNs** | 4KB        |
| **VoIP**     | 5KB        |

---

## 通知カテゴリ

### カテゴリ定義

```swift
let replyAction = UNTextInputNotificationAction(
    identifier: "REPLY",
    title: "返信",
    options: [],
    textInputButtonTitle: "送信",
    textInputPlaceholder: "メッセージを入力"
)

let markReadAction = UNNotificationAction(
    identifier: "MARK_READ",
    title: "既読にする",
    options: []
)

let deleteAction = UNNotificationAction(
    identifier: "DELETE",
    title: "削除",
    options: [.destructive]
)

let messageCategory = UNNotificationCategory(
    identifier: "MESSAGE",
    actions: [replyAction, markReadAction, deleteAction],
    intentIdentifiers: [],
    options: .customDismissAction
)
```

---

## アクセシビリティ

### VoiceOver対応

```swift
// 通知読み上げ
content.title = "山田太郎からのメッセージ"
content.body = "明日の会議について相談があります"

// VoiceOverは自動で読み上げ:
// 「山田太郎からのメッセージ、明日の会議について相談があります、
//   返信、既読にする、削除」
```

### 設定尊重

```
ユーザー設定を尊重:
├── 通知スタイル（バナー/アラート/なし）
├── サウンド（オン/オフ）
├── バッジ（表示/非表示）
├── ロック画面表示
└── 集中モード設定
```

---

## ベストプラクティス

### コンテンツガイドライン

```
✅ 明確で具体的なタイトル
✅ 必要な情報のみ含める
✅ パーソナライズされた内容
✅ 適切なタイミングで送信
✅ ユーザーの設定を尊重

❌ 広告・プロモーションの濫用
❌ 曖昧なメッセージ
❌ 過度な頻度
❌ 深夜の通知
❌ 緊急でないのに緊急レベル使用
```

### 頻度管理

| タイプ             | 推奨頻度           |
| ------------------ | ------------------ |
| **メッセージ**     | リアルタイム       |
| **ニュース**       | 1日1-3回           |
| **プロモーション** | 週1-2回            |
| **リマインダー**   | ユーザー設定に従う |

---

## チェックリスト

### 設計

- [ ] 明確なタイトルと本文
- [ ] 適切なカテゴリ設定
- [ ] アクションボタン定義（最大4つ）
- [ ] 添付メディア最適化
- [ ] グループ化設定

### 技術

- [ ] APNs設定完了
- [ ] ペイロードサイズ確認（≤4KB）
- [ ] カスタムサウンド設定
- [ ] 通知カテゴリ登録
- [ ] バックグラウンド更新対応

### ユーザー体験

- [ ] 適切なinterruption-level設定
- [ ] プライバシー配慮（ロック画面）
- [ ] アクセシビリティ対応
- [ ] 頻度管理
- [ ] オプトアウト提供

---

## 参考文献

- Apple Human Interface Guidelines - Notifications
- UserNotifications Framework
- APNs Documentation
- WWDC 2021: Send communication and Time Sensitive notifications
- WWDC 2020: The Push Notifications primer
