# DEEP原則詳細ガイド

## 概要

DEEP原則は、健全なプロダクトバックログを維持するための4つの基本原則です:
- **D**etailed appropriately（適切に詳細化）
- **E**stimated（見積もり済み）
- **E**mergent（創発的）
- **P**rioritized（優先順位付け）

このガイドでは、各原則の詳細な適用方法と実践例を提供します。

---

## D - Detailed Appropriately（適切に詳細化）

### 概念

バックログアイテムは、実装時期に応じて適切なレベルで詳細化すべきです。
近い将来のアイテムは詳細に、遠い将来のアイテムは概要レベルで十分です。

### 3つの詳細化レベル

#### レベル1: Now（次の1-2スプリント）

**詳細化の基準**:
- すべてのストーリーがDefinition of Ready（DoR）を満たす
- 受け入れ基準が Given-When-Then 形式で記述されている
- 技術的な考慮事項が明確
- 依存関係が解決済み
- ストーリーポイントが見積もられている
- 1スプリントで完了可能なサイズ（13ポイント以下）

**具体例**:

```markdown
## US-101: ユーザー登録機能

### ユーザーストーリー
As a 新規ユーザー
I want メールアドレスとパスワードでアカウントを作成できる
So that サービスを利用開始できる

### 受け入れ基準

**AC-101-1: 正常な登録フロー**
Given 登録画面が表示されている
When 有効なメールアドレスとパスワードを入力
And 「登録」ボタンをクリック
Then アカウントが作成される
And 確認メールが送信される
And ダッシュボード画面に遷移する

**AC-101-2: 重複メールアドレスのエラー**
Given 既に登録済みのメールアドレス
When 同じメールアドレスで登録を試みる
Then エラーメッセージ「このメールアドレスは既に使用されています」が表示される
And 登録画面に留まる

**AC-101-3: パスワード要件**
Given 登録画面が表示されている
When パスワードが要件（8文字以上、大文字、小文字、数字、記号を各1文字以上）を満たさない
Then エラーメッセージが表示される
And パスワード要件がツールチップで表示される

### 技術的考慮事項
- bcryptでパスワードをハッシュ化（cost factor=12）
- JWTトークンを生成（有効期限1時間）
- メール送信はSendGridを使用
- データベーストランザクションでアカウント作成とメール送信を保証

### 依存関係
- メール送信サービス（SendGrid）の設定完了
- ユーザーテーブルのマイグレーション完了

### 見積もり
ストーリーポイント: 8

### テスト計画
- ユニットテスト: パスワードバリデーション、ハッシュ化
- 統合テスト: データベース登録、メール送信
- E2Eテスト: Playwrightで登録フローをテスト
```

#### レベル2: Next（2-4スプリント先）

**詳細化の基準**:
- ユーザーストーリーの概要が明確
- 大まかな受け入れ基準（3-5個）
- T-Shirt Sizeまたは大まかなストーリーポイント（範囲で見積もり）
- 主要な依存関係が特定されている
- リファインメントセッションで詳細化予定

**具体例**:

```markdown
## US-105: プロフィール編集機能

### ユーザーストーリー
As a 登録済みユーザー
I want プロフィール情報を編集できる
So that 最新の情報を維持できる

### 受け入れ基準（概要）
1. ユーザーがプロフィール編集画面にアクセスできる
2. 名前、メールアドレス、プロフィール画像を編集できる
3. メールアドレス変更時は確認メールを送信
4. 編集内容がリアルタイムでプレビューされる
5. 変更を保存または破棄できる

### 技術的考慮事項（未確定）
- 画像アップロード機能が必要
- メールアドレス変更の検証フロー
- プレビュー機能のフロントエンド実装

### 依存関係
- ファイルアップロード機能（US-103）の完了後に実装

### 見積もり
T-Shirt Size: M（5-8ストーリーポイントと予想）

### 未解決の質問
- プロフィール画像の最大サイズは？
- メールアドレス変更の確認フローの詳細は？
- プレビュー機能はリアルタイムか？それとも「プレビュー」ボタンが必要か？
```

#### レベル3: Later（それ以降）

**詳細化の基準**:
- エピックまたは高レベルのユーザーストーリー
- ビジネス価値が明確
- T-Shirt Size（XL, L, M）
- 将来のリファインメントで詳細化予定
- アイデアレベルでも可

**具体例**:

```markdown
## Epic-10: 多言語対応

### 説明
サービスを日本語と英語の2言語で提供し、グローバル展開の基盤を作る。

### ビジネス価値
- グローバル市場への展開が可能になる
- 海外ユーザーの獲得による収益増加
- 競合他社との差別化

### 想定される機能
- UIの多言語化（日本語、英語）
- ユーザーが言語を選択できる
- システムメッセージ、エラーメッセージの多言語化
- 管理画面での翻訳管理

### 技術的な選択肢
- i18n ライブラリの選定（react-i18next、next-i18next等）
- 翻訳データの管理方法（JSONファイル、データベース、クラウドサービス）
- 自動翻訳APIの利用検討

### 見積もり
T-Shirt Size: XL（40-60ストーリーポイントと予想）

### リファインメント予定
3ヶ月後のQ3開始時にエピックを複数のユーザーストーリーに分割
```

### 詳細化のタイミング

```markdown
## リファインメントスケジュール

### Now（1-2スプリント先）
- **リファインメント**: 毎週のバックログリファインメントセッション
- **責任者**: プロダクトオーナー + 開発チーム全員
- **時間**: 2時間/週
- **成果物**: Definition of Ready を満たすストーリー

### Next（2-4スプリント先）
- **リファインメント**: 隔週のバックログリファインメントセッション
- **責任者**: プロダクトオーナー + 開発チーム代表
- **時間**: 1時間/隔週
- **成果物**: 概要レベルのストーリー、T-Shirt Size見積もり

### Later（それ以降）
- **リファインメント**: 四半期ごとのエピックレビュー
- **責任者**: プロダクトオーナー + ステークホルダー
- **時間**: 半日/四半期
- **成果物**: エピックの優先順位付け、ロードマップ更新
```

---

## E - Estimated（見積もり済み）

### 概念

すべてのバックログアイテムは、適切なレベルで見積もりされているべきです。
見積もりは、計画と優先順位付けの基礎となります。

### 見積もり手法の使い分け

#### T-Shirt Sizing（エピック、遠い将来のストーリー）

**サイズ定義**:
```markdown
| サイズ | ストーリーポイント範囲 | 期間目安 |
|--------|---------------------|---------|
| XS | 1-2 | 1-2日 |
| S | 3-5 | 3-5日 |
| M | 8-13 | 1-2週 |
| L | 21-34 | 2-4週 |
| XL | 40+ | 1ヶ月以上 |
```

**適用例**:
```markdown
## Epic-05: 高度な検索機能

### T-Shirt Size: L

### 理由
- 複数の検索条件（キーワード、日付範囲、カテゴリー）
- フィルタリング機能
- 検索結果のソート
- ページネーション
- 検索履歴の保存

推定ストーリーポイント: 25-30ポイント
期間: 3-4週間
```

#### ストーリーポイント（次の1-4スプリントのストーリー）

**フィボナッチ数列の使用**:
```
1, 2, 3, 5, 8, 13
```

**ストーリーポイントの基準**:

```markdown
## 1ストーリーポイント（基準ストーリー）
- シンプルな画面表示
- CRUD操作の一つ（CRUDのRのみ等）
- 既存パターンの踏襲
- 外部依存なし
- 1-2時間で完了

例: 「ユーザー一覧画面の表示」

## 3ストーリーポイント
- 基準ストーリーの3倍の複雑性
- 簡単なビジネスロジック
- 1つの外部サービス連携
- 半日-1日で完了

例: 「ユーザー検索機能（キーワード検索のみ）」

## 5ストーリーポイント
- 中程度の複雑性
- 複数のビジネスルール
- 複数の外部サービス連携
- 1-2日で完了

例: 「ユーザー登録機能（メール確認付き）」

## 8ストーリーポイント
- 高い複雑性
- 複雑なビジネスロジック
- 新しい技術の調査が必要
- 2-3日で完了

例: 「決済機能の実装（Stripe連携）」

## 13ストーリーポイント（分割候補）
- 非常に高い複雑性
- 1スプリントで完了ギリギリ
- 分割を検討すべき
- 3-5日で完了

例: 「レコメンデーション機能（機械学習アルゴリズム）」
```

#### プランニングポーカー

**プロセス**:
```markdown
1. プロダクトオーナーがストーリーを説明
2. 開発チームが質問（5分）
3. 各メンバーが独立して見積もり（カードを伏せる）
4. 全員が同時にカードを公開
5. 見積もりが一致しない場合、最高値と最低値の理由を聞く
6. 再度見積もり（2-3回で収束）
7. 合意されたストーリーポイントを記録

**収束しない場合**:
- ストーリーを分割する
- 技術的な調査スパイクを実施
- プロダクトオーナーに要件の明確化を依頼
```

### 見積もりの更新

```markdown
## 見積もり更新のタイミング

### リファインメント時
- 要件が変更された場合
- 新しい情報が得られた場合
- 依存関係が変化した場合

### スプリント中
- 見積もりが大幅に外れた場合（実績が見積もりの2倍以上）
- 技術的な問題が発覚した場合

### レトロスペクティブ後
- チームのベロシティが変化した場合
- 基準ストーリーの見直しが必要な場合
```

---

## E - Emergent（創発的）

### 概念

バックログは静的なドキュメントではなく、継続的に進化する生きた成果物です。
新しい学習、市場の変化、フィードバックに応じて、常に更新されるべきです。

### 創発的バックログの実践

#### 継続的な追加

**新規アイテムの追加トリガー**:
```markdown
## トリガー1: ステークホルダーからの要望
- 記録方法: Slackチャンネル、メール、ミーティング
- プロセス:
  1. プロダクトオーナーが要望を受け取る
  2. バックログアイテムとして記録
  3. ビジネス価値を評価
  4. 優先順位を仮決定
  5. 次回のリファインメントで議論

## トリガー2: ユーザーフィードバック
- ソース: カスタマーサポート、ユーザーインタビュー、アンケート
- プロセス:
  1. フィードバックを集約
  2. パターンを特定（複数のユーザーから同じ要望）
  3. バックログアイテムとして記録
  4. ユーザー数、頻度でビジネス価値を評価

## トリガー3: 技術的負債の発見
- ソース: コードレビュー、リファクタリング、バグ修正
- プロセス:
  1. 技術バックログに記録
  2. リスクと影響を評価
  3. 機能バックログとのバランスを考慮
  4. スプリントごとに20%の時間を割当

## トリガー4: 市場の変化
- ソース: 競合分析、業界トレンド、規制変更
- プロセス:
  1. 市場変化の影響を分析
  2. 戦略的なエピックとして記録
  3. 四半期ごとのロードマップで優先順位を検討
```

#### 継続的な更新

**更新のパターン**:
```markdown
## パターン1: 要件の明確化
Before:
- Epic-10: 多言語対応
- 説明: UIを多言語化する

After（学習後）:
- Epic-10: 多言語対応
- 説明: 日本語と英語の2言語でUIを提供
- 分割されたストーリー:
  - US-110: 言語選択機能
  - US-111: UIテキストの多言語化
  - US-112: エラーメッセージの多言語化
  - US-113: 翻訳管理画面

## パターン2: スコープの調整
Before:
- US-105: プロフィール編集機能
- 見積もり: 13ポイント

After（リファインメント後）:
- US-105a: プロフィール基本情報編集（名前、メール）
  - 見積もり: 5ポイント
- US-105b: プロフィール画像のアップロード
  - 見積もり: 5ポイント
- US-105c: プロフィールプレビュー機能
  - 見積もり: 3ポイント

## パターン3: 優先順位の変更
Before:
1. US-110: レポート機能（優先度: Should have）
2. US-111: データエクスポート（優先度: Could have）

After（顧客フィードバック後）:
1. US-111: データエクスポート（優先度: Must have）
   - 理由: 5社の顧客から強い要望あり
2. US-110: レポート機能（優先度: Should have）
```

#### 継続的な削除

**削除の判断基準**:
```markdown
## 削除基準1: 陳腐化
- 条件: 6ヶ月以上更新されていない
- プロセス:
  1. 四半期ごとのバックログレビューで特定
  2. プロダクトオーナーが「まだ必要か？」を判断
  3. 不要なら削除（またはアーカイブ）

## 削除基準2: ビジネス価値の喪失
- 条件: 市場の変化、戦略の変更で価値がなくなった
- プロセス:
  1. ステークホルダーと協議
  2. 代替案の検討
  3. 削除の合意

## 削除基準3: 技術的な陳腐化
- 条件: 使用予定の技術が廃止、またはより良い代替案が登場
- プロセス:
  1. 技術的な調査
  2. 代替案の評価
  3. 削除または新しいアイテムに置き換え

## 削除基準4: 重複
- 条件: 他のストーリーと重複している
- プロセス:
  1. 重複を特定
  2. 統合または一方を削除
  3. 依存関係の更新
```

---

## P - Prioritized（優先順位付け）

### 概念

バックログは常に価値順に並んでおり、次に何を実装すべきかが明確であるべきです。
優先順位は、ビジネス価値、リスク、依存関係、学習機会を考慮して決定されます。

### 優先順位付けのフレームワーク

#### WSJF（Weighted Shortest Job First）

**計算式**:
```
WSJF = CoD（Cost of Delay） / Job Size

CoD = ビジネス価値 + 時間的緊急性 + リスク削減 + 機会獲得
Job Size = ストーリーポイント
```

**具体例**:
```markdown
## US-120: 決済機能の実装

### CoD（Cost of Delay）
- ビジネス価値: 10（収益に直結）
- 時間的緊急性: 8（競合が実装済み）
- リスク削減: 5（既存の手動決済のミス削減）
- 機会獲得: 7（新規顧客の獲得）
- **CoD合計: 30**

### Job Size
- ストーリーポイント: 13

### WSJF
WSJF = 30 / 13 = **2.31**

## US-121: ダークモード対応

### CoD（Cost of Delay）
- ビジネス価値: 3（UX向上）
- 時間的緊急性: 2（急ぎではない）
- リスク削減: 1（リスクなし）
- 機会獲得: 2（一部ユーザーの満足度向上）
- **CoD合計: 8**

### Job Size
- ストーリーポイント: 5

### WSJF
WSJF = 8 / 5 = **1.60**

**結論**: US-120（決済機能）を優先
```

#### MoSCoW + リスク評価

**マトリクス**:
```markdown
| 優先度 | ビジネス価値 | リスク | 依存関係 | 実装順序 |
|--------|------------|--------|---------|---------|
| Must have | 高 | 低 | なし | 1 |
| Must have | 高 | 高 | なし | 2（リスク軽減後） |
| Should have | 中 | 低 | Must haveに依存 | 3 |
| Could have | 低 | 低 | なし | 4 |
| Won't have | - | - | - | 実装しない |
```

### 優先順位付けのベストプラクティス

#### ステークホルダーの巻き込み

```markdown
## 四半期ごとのロードマップレビュー

### 参加者
- プロダクトオーナー（ファシリテーター）
- ステークホルダー（経営陣、営業、カスタマーサポート）
- 開発チーム代表

### アジェンダ
1. 前四半期の振り返り（30分）
   - 完了したエピック
   - ビジネス成果

2. 次四半期のエピック優先順位付け（60分）
   - 各エピックのビジネス価値を議論
   - WSJF計算
   - 優先順位の仮決定

3. ロードマップの更新（30分）
   - エピックのタイムライン
   - リリース計画

### 成果物
- 更新されたロードマップ
- 優先順位付けされたエピックリスト
- 次四半期の目標
```

#### 継続的な優先順位の調整

```markdown
## 週次の優先順位レビュー

### タイミング
毎週のバックログリファインメントセッション

### プロセス
1. 新規アイテムの優先順位を決定
2. 既存アイテムの優先順位を再評価
   - 市場の変化はあったか？
   - 新しいフィードバックはあったか？
   - 依存関係に変化はあったか？
3. 次スプリントの候補を確認

### 判断基準
- Must haveが上位にあるか？
- 依存関係が考慮されているか？
- ベロシティに基づいて現実的な量か？
```

---

## DEEP原則の実践チェックリスト

バックログの健全性を定期的に評価:

```markdown
## DEEP健全性チェックリスト

### D - Detailed Appropriately
- [ ] 次の1-2スプリントのストーリーはすべてDefinition of Readyを満たしているか？
- [ ] 2-4スプリント先のストーリーは概要レベルで記述されているか？
- [ ] 遠い将来のアイテムはエピックまたは高レベルのストーリーか？
- [ ] 詳細化の程度が実装時期に適合しているか？

### E - Estimated
- [ ] すべてのアイテムが見積もられているか？
- [ ] 見積もり手法（T-Shirt Size、ストーリーポイント）が適切に使い分けられているか？
- [ ] 13ポイント超のストーリーは分割されているか？
- [ ] 基準ストーリーが定義され、チームで共有されているか？

### E - Emergent
- [ ] 新規アイテムが定期的に追加されているか？
- [ ] 既存アイテムが学習に基づいて更新されているか？
- [ ] 陳腐化したアイテムが削除されているか？
- [ ] バックログのサイズが管理可能な範囲（3-6ヶ月分）か？

### P - Prioritized
- [ ] バックログが価値順に並んでいるか？
- [ ] 優先順位の判断基準（WSJF、MoSCoW等）が明確か？
- [ ] 依存関係が優先順位に反映されているか？
- [ ] ステークホルダーが優先順位に合意しているか？
```

---

## まとめ

DEEP原則は、健全なバックログを維持するための実践的なフレームワークです:

- **D**: 実装時期に応じた適切な詳細化（Now/Next/Later）
- **E**: 適切な見積もり手法の使い分け（T-Shirt Size/ストーリーポイント）
- **E**: 継続的な追加、更新、削除による創発的な進化
- **P**: ビジネス価値、リスク、依存関係を考慮した優先順位付け

これらの原則を実践することで、チームが常に最も価値の高い作業に集中できる環境を構築できます。
