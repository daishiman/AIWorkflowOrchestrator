# プロンプトレベル防御

## 基本原則

プロンプトレベル防御は、AIに対して明確な制約と
要件を伝えることで、ハルシネーションを防ぐ最初の防衛線です。

## 防御パターン

### 1. 事実確認の義務付け

```markdown
## 出力ルール

1. 入力データに含まれる情報のみを使用してください
2. 入力に存在しない情報は絶対に生成しないでください
3. 各出力項目に対して、参照した入力箇所を示してください
```

**効果**: AIが入力範囲外の情報を生成することを防止

### 2. 情報源の引用義務

```markdown
## 引用要件

すべての主張に対して、以下の形式で情報源を示してください：

{
"claim": "主張内容",
"source": "入力データ内の該当箇所",
"confidence": 0.0-1.0の信頼度
}

情報源が特定できない場合は、その主張を出力しないでください。
```

**効果**: 検証可能な出力を強制

### 3. 不確実性の明示要求

```markdown
## 不確実性の表現

確信度に応じて以下のマーカーを使用してください：

- [確実] 入力に明示的に記載されている情報
- [推測] 入力から合理的に推論される情報
- [不明] 入力からは判断できない情報

[推測]と[不明]は必ず理由を付記してください。
```

**効果**: AIの確信度を可視化

### 4. 推測の制限

```markdown
## 推測に関するルール

1. 入力に明示されていない情報の推測は禁止
2. やむを得ず推測する場合は以下を遵守：
   - 「推測:」プレフィックスを付ける
   - 推測の根拠を明示する
   - 信頼度0.5以下として扱う
3. 推測の数は出力全体の10%以下に制限
```

**効果**: 推測の乱用を防止

### 5. 検証ステップの組み込み

```markdown
## 自己検証プロセス

出力前に以下を確認してください：

□ すべての情報は入力データに基づいているか？
□ 推測には明確な根拠があるか？
□ 矛盾する情報はないか？
□ 引用は正確か？

検証で問題が見つかった場合は、該当部分を修正してください。
```

**効果**: 出力前の品質チェック

## 実装テンプレート

### 高リスクタスク向けテンプレート

```markdown
# システムプロンプト

あなたは正確性を最優先するAIアシスタントです。

## 絶対ルール（違反禁止）

1. 入力データに含まれない情報は一切生成しない
2. 推測や仮定は行わない
3. 不確実な情報には必ずマークを付ける

## 出力形式

{
"result": "回答内容",
"sources": ["参照した入力箇所のリスト"],
"confidence": 0.0-1.0,
"warnings": ["不確実な点があれば記載"]
}

## 禁止事項

- 「一般的に」「通常は」などの曖昧な表現
- 入力にない背景知識の使用
- 未検証の推測

情報が不足している場合は、回答を拒否し、
必要な追加情報を明示してください。
```

### 中リスクタスク向けテンプレート

```markdown
# システムプロンプト

正確で信頼性の高い情報を提供してください。

## ルール

1. 入力データを主な情報源として使用
2. 推測する場合は「推測:」と明示
3. 確信度が低い場合は明記

## 出力形式

回答に続けて、以下を付記：

- 信頼度: 高/中/低
- 情報源: 入力データ内の参照箇所
- 注意点: 確認が必要な点
```

## 効果測定

### 検証指標

1. **幻覚率**: 入力にない情報の出現率
2. **引用精度**: 引用の正確性
3. **不確実性一致**: 表明された確信度と実際の正確性の一致

### 目標値

- 幻覚率: <5%
- 引用精度: >95%
- 不確実性一致: >80%
