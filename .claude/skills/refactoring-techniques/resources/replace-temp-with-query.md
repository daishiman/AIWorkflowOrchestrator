# Replace Temp with Query

## 概要

一時変数をメソッド呼び出しに置換するリファクタリング技法です。
計算ロジックを再利用可能にし、コードの意図を明確にします。

## 適用条件

- [ ] 一時変数が一度だけ代入される
- [ ] 計算ロジックが再利用可能
- [ ] 変数名で意図を伝えている
- [ ] 副作用がない純粋な計算

## 手順

### Step 1: 変数の分析

一時変数の特性を確認する。

**確認事項**:

- 代入が一度だけか？
- 代入後に変更されないか？
- 計算に副作用がないか？

### Step 2: 計算をメソッドに抽出

計算ロジックを新しいメソッドとして抽出する。

**メソッド設計**:

- 戻り値の型を明確に
- 副作用のない純粋関数に
- 変数名からメソッド名を導出

### Step 3: 変数をメソッド呼び出しに置換

すべての変数参照をメソッド呼び出しに置換する。

### Step 4: 変数宣言の削除

不要になった変数宣言を削除する。

### Step 5: テスト実行

振る舞いが変わっていないことを確認する。

## 適用判断

### 適用すべき場合

- 計算が他の場所でも必要になる可能性
- 変数名が計算の意図を表している
- 計算が純粋（副作用なし）

### 適用を避ける場合

- ループ内で同じ計算が繰り返される（パフォーマンス考慮）
- 計算コストが高い
- 副作用がある

## パフォーマンスの考慮

### 問題

メソッド呼び出しが複数回発生する可能性

### 対処法

1. **キャッシュの導入**: 必要に応じてメモ化
2. **コンパイラ最適化**: 多くの場合インライン化される
3. **測定優先**: 実際に問題になってから最適化

## 判断基準チェックリスト

### 適用すべきか？

- [ ] 変数への代入が一度だけか？
- [ ] 計算に副作用がないか？
- [ ] 計算が再利用される可能性があるか？
- [ ] パフォーマンスへの影響は許容範囲か？

### 実行後の確認

- [ ] テストが通るか？
- [ ] コードの意図がより明確になったか？
- [ ] 重複した計算が解消されたか？

## 関連リファクタリング

- **Extract Method**: 計算ロジックのメソッド抽出
- **Inline Variable**: 不要な変数の削除（逆操作）
- **Split Temporary Variable**: 複数回代入される変数の分割
