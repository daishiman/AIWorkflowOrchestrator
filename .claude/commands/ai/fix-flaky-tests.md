---
description: |
  ä¸å®‰å®šãªãƒ†ã‚¹ãƒˆï¼ˆãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆï¼‰ã®æ¤œå‡ºã¨ä¿®æ­£ã‚’è‡ªå‹•åŒ–ã™ã‚‹å°‚é–€ã‚³ãƒãƒ³ãƒ‰ã€‚

  éæ±ºå®šçš„è¦ç´ ï¼ˆæ™‚åˆ»ã€ãƒ©ãƒ³ãƒ€ãƒ ã€å¤–éƒ¨APIï¼‰ã®æ’é™¤ã€æ˜ç¤ºçš„å¾…æ©Ÿæˆ¦ç•¥ã®é©ç”¨ã€
  ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ã®æœ€é©åŒ–ã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆã®å®‰å®šæ€§ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

  ğŸ¤– èµ·å‹•ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ:
  - `.claude/agents/e2e-tester.md`: ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆé˜²æ­¢å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

  ğŸ“š åˆ©ç”¨å¯èƒ½ã‚¹ã‚­ãƒ«ï¼ˆe2e-testerã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå¿…è¦æ™‚ã«å‚ç…§ï¼‰:
  **Phase 1ï¼ˆãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼æ¤œå‡ºï¼‰:** flaky-test-preventionï¼ˆéæ±ºå®šæ€§ãƒ‘ã‚¿ãƒ¼ãƒ³ã€å®‰å®šæ€§ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼‰
  **Phase 2ï¼ˆä¿®æ­£å®Ÿè£…ï¼‰:** playwright-testingï¼ˆå¾…æ©Ÿæˆ¦ç•¥ï¼‰, flaky-test-preventionï¼ˆãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥ï¼‰
  **Phase 3ï¼ˆæ¤œè¨¼ï¼‰:** flaky-test-preventionï¼ˆé€£ç¶šå®Ÿè¡Œãƒ†ã‚¹ãƒˆã€ä¸¦åˆ—å®Ÿè¡Œç¢ºèªï¼‰

  ğŸ’¡ ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³:
  - ãƒ†ã‚¹ãƒˆãŒä¸å®‰å®šã§å¤±æ•—ã¨æˆåŠŸã‚’ç¹°ã‚Šè¿”ã™
  - CI/CDã§æ™‚ã€…å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆãŒã‚ã‚‹
  - å›ºå®šæ™‚é–“å¾…æ©Ÿï¼ˆsleepã€setTimeoutï¼‰ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹
  - å¤–éƒ¨APIã‚„ãƒ©ãƒ³ãƒ€ãƒ å€¤ã«ä¾å­˜ã—ã¦ã„ã‚‹

  âš™ï¸ ã“ã®ã‚³ãƒãƒ³ãƒ‰ã®è¨­å®š:
  - argument-hint: å¯¾è±¡ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆå¿…é ˆï¼‰
  - allowed-tools: ãƒ†ã‚¹ãƒˆä¿®æ­£ã¨å®Ÿè¡Œç”¨
    â€¢ Task: e2e-tester ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹•ç”¨
    â€¢ Read: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã€è¨ºæ–­æƒ…å ±ç¢ºèªç”¨
    â€¢ Edit: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£ç”¨
    â€¢ Bash(pnpm test*|playwright*): ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€é€£ç¶šå®Ÿè¡Œç¢ºèªç”¨
    â€¢ Grep: å›ºå®šæ™‚é–“å¾…æ©Ÿæ¤œå‡ºã€éæ±ºå®šæ€§ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œç´¢ç”¨
  - model: sonnetï¼ˆãƒ†ã‚¹ãƒˆå®‰å®šåŒ–ã‚¿ã‚¹ã‚¯ï¼‰

  ğŸ“Š æˆæœç‰©:
  - å®‰å®šåŒ–ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ï¼ˆéæ±ºå®šæ€§æ’é™¤æ¸ˆã¿ï¼‰
  - æ˜ç¤ºçš„å¾…æ©Ÿæˆ¦ç•¥é©ç”¨æ¸ˆã¿
  - ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯æœ€é©åŒ–æ¸ˆã¿
  - é€£ç¶šå®Ÿè¡Œãƒ†ã‚¹ãƒˆçµæœï¼ˆ10å›é€£ç¶šæˆåŠŸç¢ºèªï¼‰

  ãƒˆãƒªã‚¬ãƒ¼ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: flaky test, unstable test, ä¸å®‰å®šãªãƒ†ã‚¹ãƒˆ, ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼
argument-hint: "[test-file]"
allowed-tools:
  - Task
  - Read
  - Edit
  - Bash(pnpm test*|playwright*)
  - Grep
model: sonnet
---

# ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆä¿®æ­£

## ç›®çš„

`.claude/agents/e2e-tester.md` ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’èµ·å‹•ã—ã€ä¸å®‰å®šãªãƒ†ã‚¹ãƒˆã‚’æ¤œå‡ºãƒ»ä¿®æ­£ã—ã¦å®‰å®šæ€§ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹•ãƒ•ãƒ­ãƒ¼

### Phase 1: å¼•æ•°æ¤œè¨¼

```markdown
å¯¾è±¡ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: "$ARGUMENTS"

å¼•æ•°æœªæŒ‡å®šã®å ´åˆ:
ã‚¨ãƒ©ãƒ¼: ã€Œãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€
ä½¿ç”¨ä¾‹: `/ai:fix-flaky-tests tests/login-flow.spec.ts`
ä½¿ç”¨ä¾‹: `/ai:fix-flaky-tests src/features/auth/__tests__/executor.test.ts`
```

### Phase 2: e2e-tester ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹•

Task ãƒ„ãƒ¼ãƒ«ã§ `.claude/agents/e2e-tester.md` ã‚’èµ·å‹•:

```markdown
ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: .claude/agents/e2e-tester.md
ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: ${ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹}
ã‚¿ã‚¹ã‚¯: ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆé˜²æ­¢ã¨å®‰å®šåŒ–

ä¾é ¼å†…å®¹:

- ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆã®æ¤œå‡ºã¨åˆ†æ
- éæ±ºå®šçš„è¦ç´ ã®æ’é™¤ï¼ˆæ™‚åˆ»ã€ãƒ©ãƒ³ãƒ€ãƒ ã€å¤–éƒ¨APIï¼‰
- æ˜ç¤ºçš„å¾…æ©Ÿæˆ¦ç•¥ã®é©ç”¨
- ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ã®æœ€é©åŒ–
- é€£ç¶šå®Ÿè¡Œãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹å®‰å®šæ€§ç¢ºèª

å¿…é ˆè¦ä»¶:

1. Phase 1: ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼æ¤œå‡º
   - å›ºå®šæ™‚é–“å¾…æ©Ÿã®æ¤œå‡ºï¼ˆsleepã€setTimeoutï¼‰
   - éæ±ºå®šçš„è¦ç´ ã®ç‰¹å®šï¼ˆDate.now()ã€Math.random()ã€å¤–éƒ¨APIï¼‰
   - éæ±ºå®šæ€§ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚«ã‚¿ãƒ­ã‚°ç…§åˆ

2. Phase 2: ä¿®æ­£å®Ÿè£…
   - å›ºå®šæ™‚é–“å¾…æ©Ÿ â†’ æ˜ç¤ºçš„å¾…æ©Ÿã«å¤‰æ›´
   - æ™‚åˆ»ãƒ¢ãƒƒã‚¯åŒ–ï¼ˆvi.setSystemTime()ã€page.clock.setFixedTime()ï¼‰
   - ãƒ©ãƒ³ãƒ€ãƒ å€¤å›ºå®šåŒ–ï¼ˆMath.random() ãƒ¢ãƒƒã‚¯ï¼‰
   - å¤–éƒ¨APIãƒ¢ãƒƒã‚¯åŒ–ï¼ˆPlaywright Route Mockingã€MSWï¼‰

3. Phase 3: å®‰å®šæ€§æ¤œè¨¼
   - é€£ç¶šå®Ÿè¡Œãƒ†ã‚¹ãƒˆï¼ˆ10å›é€£ç¶šæˆåŠŸç¢ºèªï¼‰
   - ä¸¦åˆ—å®Ÿè¡Œãƒ†ã‚¹ãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿ç«¶åˆç¢ºèªï¼‰
   - è¨ºæ–­æƒ…å ±åé›†ï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€ãƒˆãƒ¬ãƒ¼ã‚¹ï¼‰

æœŸå¾…æˆæœç‰©:

- éæ±ºå®šæ€§æ’é™¤æ¸ˆã¿ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
- æ˜ç¤ºçš„å¾…æ©Ÿæˆ¦ç•¥é©ç”¨æ¸ˆã¿
- é€£ç¶šå®Ÿè¡Œãƒ†ã‚¹ãƒˆæˆåŠŸï¼ˆ10/10ï¼‰
```

**æœŸå¾…æˆæœç‰©:**

- å®‰å®šåŒ–ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
- ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼æ¤œå‡ºãƒ¬ãƒãƒ¼ãƒˆ
- é€£ç¶šå®Ÿè¡Œãƒ†ã‚¹ãƒˆçµæœ

### Phase 3: é€£ç¶šå®Ÿè¡Œæ¤œè¨¼ã¨å ±å‘Š

- é€£ç¶šå®Ÿè¡Œãƒ†ã‚¹ãƒˆï¼ˆ10å›ï¼‰
- ä¸¦åˆ—å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
- å®‰å®šæ€§ç¢ºèª
- ä¿®æ­£å†…å®¹ã‚µãƒãƒªãƒ¼

## ä½¿ç”¨ä¾‹

### åŸºæœ¬çš„ãªä½¿ç”¨

```bash
/ai:fix-flaky-tests tests/login-flow.spec.ts
```

### æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›

```markdown
âœ… ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆä¿®æ­£å®Œäº†

ğŸ“ å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«:

- tests/login-flow.spec.ts

ğŸ” æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ:

1. å›ºå®šæ™‚é–“å¾…æ©Ÿ: await page.waitForTimeout(3000) â†’ æ˜ç¤ºçš„å¾…æ©Ÿã«å¤‰æ›´
2. æ™‚åˆ»ä¾å­˜: new Date() â†’ page.clock.setFixedTime() ã§ãƒ¢ãƒƒã‚¯åŒ–
3. å¤–éƒ¨APIä¾å­˜: fetch('/api/login') â†’ Route Mocking ã§åˆ¶å¾¡

ğŸ› ï¸ é©ç”¨ã—ãŸä¿®æ­£:

1. âœ… waitForTimeout(3000) â†’ waitForSelector('[data-testid="success-message"]')
2. âœ… new Date() â†’ page.clock.setFixedTime(new Date('2025-01-01'))
3. âœ… å¤–éƒ¨API â†’ await page.route('/api/login', route => route.fulfill(...))

ğŸ“Š å®‰å®šæ€§æ¤œè¨¼:

- é€£ç¶šå®Ÿè¡Œãƒ†ã‚¹ãƒˆ: âœ… 10/10 æˆåŠŸ
- ä¸¦åˆ—å®Ÿè¡Œãƒ†ã‚¹ãƒˆ: âœ… æˆåŠŸï¼ˆãƒ‡ãƒ¼ã‚¿ç«¶åˆãªã—ï¼‰
- ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆ: 0ä»¶

âš¡ å¹³å‡å®Ÿè¡Œæ™‚é–“: 2.1ç§’ï¼ˆå®‰å®šï¼‰
```

## å‚ç…§

- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: `.claude/agents/e2e-tester.md`
- ã‚¹ã‚­ãƒ«: `.claude/skills/flaky-test-prevention/SKILL.md`
- ã‚¹ã‚­ãƒ«: `.claude/skills/playwright-testing/SKILL.md`
- ãƒªã‚½ãƒ¼ã‚¹: `.claude/skills/flaky-test-prevention/resources/non-determinism-patterns.md`
- ãƒªã‚½ãƒ¼ã‚¹: `.claude/skills/flaky-test-prevention/resources/retry-strategies.md`
